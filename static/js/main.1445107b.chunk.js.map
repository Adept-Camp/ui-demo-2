{"version":3,"sources":["config.js","translations/create-translation.js","translations/translations/en-us.js","translations/translations/es-mx.js","translations/translations/hu.js","translations/index.js","translations/language-code-provider.js","translations/use-translation.js","lib/utils/idb-lru/index.js","lib/sav3-ipfs/utils/webrtc.js","lib/sav3-ipfs/utils/bitswap.js","lib/sav3-ipfs/utils/create-window-sav3-ipfs-test-methods.js","lib/sav3-ipfs/utils/post-replies.js","lib/sav3-ipfs/utils/serialize.js","lib/sav3-ipfs/index.js","components/modal/index.js","hooks/use-user-ipns-content.js","hooks/use-user-profile.js","hooks/use-own-user-cid.js","components/publish-post/modal.js","components/menus/left/index.js","components/menus/bottom/index.js","themes/create-theme.js","themes/themes/sav3-dark.js","themes/index.js","themes/themes/light.js","themes/themes/dark.js","themes/themes/sav3-light.js","themes/theme-provider.js","components/theme-switcher/index.js","components/translation-switcher/index.js","components/top-bar/index.js","translations/use-language-code.js","lib/follow-manager/index.js","hooks/following/following-provider.js","hooks/following/use-is-following.js","components/post/more-menu.js","lib/utils/url.js","hooks/utils/use-interval.js","hooks/use-post-replies-cids.js","hooks/utils/use-copy-clipboard.js","themes/utils.js","components/post/index.js","components/feeds/posts/index.js","views/profile/components/description.js","views/profile/components/edit-profile-modal.js","views/profile/components/more-menu.js","hooks/utils/use-previous.js","hooks/use-user-post-cids.js","hooks/use-posts.js","views/profile/components/profile.js","views/profile/index.js","hooks/use-own-peer-cid.js","components/menus/drawer/index.js","components/menus/drawer/avatar-button.js","components/publish-post/form.js","hooks/following/use-following.js","lib/utils/local-storage-memoize.js","lib/sav3-ipfs/utils/bootstrap-users.js","hooks/following/use-bootstrap-users-cids.js","hooks/use-users-following.js","hooks/use-users-ipns-contents.js","hooks/use-users-post-cids.js","hooks/use-users-profiles.js","hooks/feed/feed-provider.js","hooks/feed/use-home-posts.js","views/home/index.js","hooks/following/use-following-once.js","hooks/feed/use-feed-posts.js","views/feed/index.js","views/search/index.js","hooks/use-peers-cids.js","hooks/use-users-posts.js","views/peers/index.js","lib/utils/ip.js","hooks/use-peers-stats.js","views/stats/components/peer.js","views/stats/index.js","components/feeds/users/user.js","components/feeds/users/index.js","views/following/index.js","views/export/components/form.js","views/export/index.js","hooks/use-post-with-replies.js","views/post/index.js","app.js","report-web-vitals.js","index.js","lib/sav3-ipfs/ipns-client/index.js"],"names":["config","bootstrapUsersGoogleSheetId","starServers","ipnsServer","urlTimeToLive","window","createTranslation","_translation","merge","defaultTranslation","translation","Follow","Unfollow","Description","Home","Profile","Search","Peers","Stats","Following","Export","Import","Feed","Post","Share","registerTimeAgo","number","index","totalSec","translations","enUs","esMx","hu","Object","freeze","LanguageCodeContext","createContext","languageCode","setLanguageCode","LanguageCodeProvider","props","defaultLanguageCode","preferredLanguageCode","navigator","language","localStorageLanguageCode","localStorage","getItem","console","warn","useState","_setLanguageCode","contextValue","setItem","children","Provider","value","useTranslation","useContext","IdbLru","cache","_cache","size","name","maxSize","assert","ready","init","a","cache1","localForage","cache2","length","cache1Size","cache2Size","waitForReady","delay","update","key","setValue","_CacheTemp","clear","has","_value","undefined","remove","removeItem","get","v","set","sdpCache","debug","Debug","webRtcStarConnectWithSdpCache","webRtcStarConnect","multiaddress","options","simplePeer","cid","getPeerId","_pc","remoteDescription","sdp","webRtcStarUpgradeInboundWithSdpCache","webRtcStarUpgradeInbound","maConn","connection","remotePeer","toB58String","conn","getWebRtcPeerConnectionInfo","peerId","sdpString","sdpTransform","webRtcPeerConnectionInfo","ip","media","port","protocol","withWebRtcSdpCache","ipfs","libp2p","transportManager","_transports","_connect","bind","_upgrader","upgradeInbound","blockReceivedPeerCidCache","QuickLRU","bitswapUpdateReceiveCountersWithBlockReceivedPeerCidCache","bitswapUpdateReceiveCounters","block","exists","peerCid","blockCid","toString","ipld","bs","_bitswap","_updateReceiveCounters","thumbnailUrls","bannerUrls","mediaUrls","displayNames","descriptions","descriptionUrls","contents","randomIndex","getRandomItemFromArray","array","Math","floor","random","createWindowSav3IpfsTestMethods","sav3Ipfs","sav3IpfsTest","add","data","content","res","log","file","path","chunk","push","addresses","swarm","addrs","i","addr","string","peers","peer","addrString","editProfile","descriptionUrl","editUserProfile","displayName","description","substring","thumbnailUrl","bannerUrl","publishPosts","amount","mediaUrl","publishPost","editProfileAndPublishPosts","importExport","_newPrivateKey","id","oldId","oldCid","oldPublicKey","publicKey","getOwnPeerCid","oldPeerCid","getPrivateKey","oldPrivateKey","setPrivateKey","newId","newCid","newPublicKey","newPeerCid","newPrivateKey","getPreviousPostCids","lastPostCids","lastPostCid","postCid","postRepliesCache","cachePostReplyCid","parentPostCid","postRepliesCids","JSON","parse","stringify","getPostRepliesCids","keys","validateData","toObject","e","Error","message","deserializePost","usr","cnt","tmp","userCid","contentCid","timestamp","par","previousPostCid","pre","deserializeProfile","diplayNameCid","nam","descriptionCid","des","thumbnailUrlCid","thu","bannerUrlCid","ban","deserializeUserIpnsContent","profileCid","pro","las","followingCid","fol","serializePost","post","serializedPost","serializeProfile","profile","serializedProfile","serializeUserIpnsContent","userIpnsContent","serializedUserIpnsContent","ipnsClient","_initIpfs","catch","error","privateKey","ipfsOptions","preload","enabled","Bootstrap","Addresses","Delegates","Swarm","Identity","PrivKey","Ipfs","create","this","webRtcUtils","bitswapUtils","IpnsClient","on","ipnsPath","ipnsValue","emit","then","setMaxListeners","peersStats","getPeersCids","peerCids","getPeerStats","metrics","connectionInfo","peerMetrics","forPeer","PeerId","createFromCID","toJSON","dataReceived","Number","dataSent","peerStats","peerCidsSet","Set","export","encryptedPrivateKeyString","crypto","import","uint8ArrayToString","bytes","base64PrivateKey","stop","ownCid","datastore","ipns","getLocalKey","datastoreValue","ipnsRecord","unmarshal","sequence","startsWith","validity","marshalledIpnsRecord","marshal","put","resolve","next","userIpnsContentCid","serialize","getIpfsContent","getOwnIpnsRecord","record","ownIpfsValue","lastIpnsContent","subscribe","ipnsValues","ipnsPaths","Array","isArray","getOwnUserIpnsContent","ipnsContent","newPost","round","Date","now","newPostCid","newIpnsContent","newIpnsContentCid","publishIpnsRecord","postRepliesUtils","userCids","sort","following","getUserIpnsContent","getOwnIpnsRecordSequence","publish","setOwnIpnsRecord","profileCids","getRecords","remoteIpnsRecord","remoteSequence","posts","maxPostCount","getPost","postCount","repliesCids","EventEmitter","useStyles","makeStyles","theme","paddingTop","paddingBottom","overflow","Modal","open","onClose","actions","classes","useTheme","fullScreen","useMediaQuery","breakpoints","down","Dialog","fullWidth","maxWidth","Box","alignItems","display","px","height","sav3","topBar","flexGrow","IconButton","onClick","Divider","DialogContent","className","useUserIpnsContent","setUserIpnsContent","useEffect","onPublish","newIpnsPath","subscribeToIpnsPath","off","useUserProfile","defaultUserProfile","userProfile","setUserProfile","getUserProfile","useOwnUserCid","ownUserCid","setOwnUserCid","getOwnUserCid","errorMessage","border","marginBottom","spacing","avatar","marginTop","width","borderWidth","borderStyle","borderColor","wordBreak","ParentPost","parentPost","pr","py","Avatar","src","pt","pl","Typography","variant","color","PublishPostModal","t","setContent","setErrorMessage","handleChange","event","target","subtring","handlePublish","modalContent","TextField","autoFocus","onChange","margin","placeholder","multiline","rows","Alert","severity","modalActions","Button","disableElevation","logo","logoButton","createTextButtonBox","createIconButtonBox","up","createIconButton","boxShadow","text","root","position","paddingLeft","paddingRight","PublishPostButton","openPublishPostModal","setOpenPublishPostModal","my","mx","Fab","LeftMenu","List","ListItem","button","component","RouterLink","to","ListItemIcon","fontSize","ListItemText","primary","menu","bottom","right","BottomMenu","route","useRouteMatch","activeMenu","params","BottomNavigation","BottomNavigationAction","icon","baseMuiThemeOptions","values","xs","sm","md","lg","xl","layout","columns","left","middle","drawerMenu","popoverMenu","borderRadius","palette","divider","shape","overrides","MuiToolbar","minHeight","MuiDialog","paper","paperFullWidth","MuiSvgIcon","fontSizeLarge","MuiFab","MuiButton","outlined","fontWeight","createTheme","muiThemeOptions","createMuiTheme","responsiveFontSizes","lightPrimary","themes","Light","Dark","type","light","main","dark","secondary","MuiTypography","colorPrimary","outlinedPrimary","ThemeContext","setTheme","ThemeProvider","defaultThemeName","localStorageThemeName","themeName","_setThemeName","ThemeSwitcher","themeMenuItems","MenuItem","Select","label","TranslationSwitcher","translationMenuItems","translationName","appBar","backgroundColor","background","default","appBarSticky","appBarStickyAfter","TopBar","elevation","positionSticky","Toolbar","disableGutters","useLanguageCode","followManager","followingCache","blockedCache","deleteBlocked","getAllFollowing","setFollowing","addFollowing","deleteFollowing","addBlocked","FollowingContext","FollowingProvider","blocked","setBlocked","getAllBlocked","followingObject","blockedObject","prevFollowing","setAllFollowing","userCidsObject","prevBlocked","setAllBlocked","useIsFollowing","isFollowing","setIsFollowing","useCallback","menuItemIcon","minWidth","moreIconButton","padding","FollowMenuItem","followButton","propTypes","PropTypes","isRequired","PostMoreMenu","anchorEl","setAnchorEl","handleClick","currentTarget","handleClose","stopPropagation","Menu","anchorOrigin","vertical","horizontal","transformOrigin","keepMounted","Boolean","timeToLive","decodeCid","encodedCid","expireTimestamp","object","atob","c","btoa","replace","noop","useInterval","callback","immediate","savedCallback","useRef","current","setInterval","clearInterval","usePostRepliesCids","setRepliesCids","useCopyClipboard","timeout","isCopied","setIsCopied","staticCopy","didCopy","copy","hide","setTimeout","clearTimeout","rgbaString","scaleFactor","match","r","g","b","toFixed","imgMedia","textDecoration","contentLink","marginLeft","actionIconButton","cursor","themesUtils","action","hover","tapHighlightColor","userSelect","ReplyIconButton","ShareButton","setCopied","getUrl","encodedPostCid","urlUtils","location","origin","Tooltip","title","enterDelay","leaveDelay","PostContent","contentComponents","link","getPostContentLink","split","contentPart1","contentPart2","href","Link","rel","cardMedia","mediaSrc","getPostContentMediaSrc","CardMedia","image","linkIsVideo","controls","autoPlay","muted","Card","links","urlRegex","strict","forceHttps","linkIsMedia","trim","useDate","date","setDate","formatDate","postTimestamp","day","toLocaleString","month","year","formatTimeAgo","useLocation","history","useHistory","encodedUserCid","userProfileUrl","postUrl","navigateToPostUrl","tagName","pathname","pb","justifyContent","style","transform","PostsFeed","hasMore","postComponents","dataLength","loader","p","CircularProgress","getContentLink","descriptionComponents","descriptionPart1","descriptionPart2","opacity","EditProfileModal","previousProfile","setProfile","newProfile","ShareMenuItem","ProfileMoreMenu","usePrevious","ref","useUserPostCids","userPostCids","setUserPostCids","previousUserCid","userCidChanged","limit","isMounted","includes","previousUserPostCids","usePosts","postCids","defaultPosts","setPosts","previousPosts","emptyImage","banner","EditProfileButton","openEditProfileModal","setOpenEditProfileModal","FollowButton","follow","loadedPostCount","setLoadedPostCount","postsObject","loadedPosts","flexDirection","CardHeader","subheader","urlUserCid","useParams","urlIsExpired","isOwnProfile","goBack","noWrap","useOwnPeerCid","ownPeerCid","setOwnPeerCid","HomeMenu","AvatarDrawerMenuButton","drawerOpen","setDrawerOpen","disableRipple","disableFocusRipple","Drawer","achor","contentInput","PublishPostForm","useFollowing","filter","createLocalStorageCache","func","localStorageKey","delete","localStorageMemoize","memoize","getBootstrapUsersCids","fetchBootstrapUsersCidsFromGoogleSheet","cids","googleSheetId","bootstrapUsers","fetch","isIpfs","maxAge","useBootstrapUsersCids","bootstrapUsersCids","setBootstrapUsersCids","bootstrapUsersUtils","usersFollowingCache","addNewUsersFollowing","previousUsersFollowing","newUsersFollowing","useUsersFollowing","uniqueUserCids","userCidsString","usersFollowing","setUsersFollowing","userFollowing","getUserFollowing","getDefaultUsersIpnsContents","defaultUsersIpnsContents","useUsersIpnsContents","usersIpnsContents","setUsersIpnsContents","uniqueIpnsPaths","previousUniqueIpnsPaths","unsubscribedIpnsPaths","newEmptyIpnsContents","removedIpnsContents","previousUsersIpnsContents","newUsersIpnsContents","missingDefaultIpnsContent","updateIpnsContents","subscribeToIpnsPaths","entries","getDefaultUsersPostCids","defaultUsersPostCids","useUsersPostCids","usersPostCids","setUsersPostCids","newEmptyPostCids","removedPostCids","previousUsersPostCids","newUsersPostCids","updatePostCids","previousLastPostCid","useUsersProfiles","usersProfiles","setUsersProfiles","previousProfileCids","getUserProfileIsPending","previousUsersProfiles","FeedContext","getFeedCids","feedCids","usersPostCidsToUniquePostCids","uniquePostCids","FeedProvider","followingCids","followingOfFollowingCids","previousUniquePostCids","usersPostCidsString","profiles","feedPostCids","homePostCids","getAndSetPost","useHomePosts","setPostCount","homePosts","setHomePosts","allHomePosts","homePostCid","postsNotAddedYetSortedByTimestamp","previousHomePosts","nextHomePosts","nextHomePost","previousPostCount","reset","feed","useFollowingOnce","useFeedPosts","feedPosts","setFeedPosts","allFeedPosts","feedPostCid","previousFeedPosts","nextFeedPosts","nextFeedPost","search","setUserCid","InputProps","spellCheck","startAdornment","InputAdornment","usePeersCids","setPeersCids","pollCount","setPollCount","useUsersPosts","usersPosts","setUsersPosts","getUserPostsFromLastPostCid","userPosts","userPost","previousUsersPosts","peersCids","getIsoCountryCodeFromIpAttempts","ipIsoCountryCodeCache","getIsoCountryCodeFromIpCached","isoCountryCode","getIsoCountryCodeFromIp","apiUrl","toUpperCase","assertIsIsoCountryCode","isoCountryCodeType","test","getIsoCountryCodesFromIps","ips","promises","Promise","all","isoCountryCodeToCountryFlagEmoji","chars","map","charCodeAt","String","fromCodePoint","usePeersStats","setPeersStats","getPeersStats","peersStat","ipUtils","countryFlagEmoji","Peer","prettyBytes","peerComponents","User","user","UsersFeed","users","userComponents","fontFamily","maxHeight","overflowY","ImportForm","setData","successMessage","setSuccessMessage","handleFocus","setSelectionRange","handleExport","handleImport","dataObject","confirmMessage","onFocus","usePostWithReplies","setParentPost","replies","replyCid","postWithReplies","leftColumn","middleColumn","rightColumn","bottomMenu","App","Grid","container","justify","item","exact","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","CssBaseline","document","getElementById","webSocketClient","url","subscriptionIpnsValueCache","start","WebSocketClient","getIpnsValueFromIpnsRecord","close","isReady","validateIpnsPaths","allResultsAreCached","cachedIpnsValues","cachedIpnsValue","ipnsRecords","getIpnsValuesFromIpnsRecords","getUnmarshalledIpnsRecords","unmarshalled","embedPublicKey","public","marshalledRecord","Buffer","from","Uint8Array","extractPublicKey","validate","createFromPubKey","equals","createFromB58String","getUnmarshalledIpnsRecord","args"],"mappings":"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","file":"static/js/main.1445107b.chunk.js","sourcesContent":["const config = {\n  bootstrapUsersGoogleSheetId: '1O4Wutfc34QeBEKIP5X4XtwpmRLOt5ytoDc1qv4nSHIg',\n  starServers: ['/dns4/star.sav3.org/tcp/443/wss/p2p-webrtc-star/'],\n  ipnsServer: 'https://ipns.sav3.org',\n  urlTimeToLive: 1000 * 60 * 60 * 24\n}\n\nif (process.env.NODE_ENV === 'development' && process.env.REACT_APP_IS_DOCKER) {\n  config.starServers = ['/dns4/localhost/tcp/13579/wss/p2p-webrtc-star/']\n  config.ipnsServer = 'https://localhost:9545'\n}\n\nwindow.config = config\n\nexport default config\n","import merge from 'lodash.merge'\nimport defaultTranslation from './translations/en-us'\n\nconst createTranslation = (_translation) => {\n  const translation = merge({}, defaultTranslation, _translation)\n  return translation\n}\n\nexport default createTranslation\n","import createTranslation from '../create-translation'\n\nconst translation = createTranslation({\n  // profile\n  Follow: () => 'Follow',\n  Unfollow: () => 'Unfollow',\n  'Edit profile': () => 'Edit profile',\n  'Display name': () => 'Display name',\n  Description: () => 'Description',\n  'Thumbnail URL': () => 'Thumbnail URL',\n  'Banner URL': () => 'Banner URL',\n\n  // menu\n  Home: () => 'Home',\n  Profile: () => 'Profile',\n  Search: () => 'Search',\n  'Search user ID': () => 'Search user ID',\n  Peers: () => 'Peers',\n  'Connected peers posts': () => 'Connected peers posts',\n  Stats: () => 'Stats',\n  'Connected peers stats': () => 'Connected peers stats',\n  'Connecting to peers': () => 'Connecting to peers',\n  Following: () => 'Following',\n  'Not following anyone': () => 'Not following anyone',\n  Export: () => 'Export',\n  Import: () => 'Import',\n  Feed: () => 'Feed',\n\n  // post\n  'Uncensorable content': () => 'Uncensorable content',\n  Post: () => 'Post',\n  'Copied to clipboard': () => 'Copied to clipboard',\n  Share: () => 'Share',\n\n  // global\n  'URL expired': () => 'URL expired'\n})\n\nexport default translation\n","import createTranslation from '../create-translation'\nimport {register as registerTimeAgo} from 'timeago.js'\n\nconst timeAgo = (number, index, totalSec) => {\n  // copy paste timeAgo locale from https://github.com/hustcc/timeago.js/tree/master/src/lang\n  return [\n    ['justo ahora', 'en un rato'],\n    ['hace %s segundos', 'en %s segundos'],\n    ['hace 1 minuto', 'en 1 minuto'],\n    ['hace %s minutos', 'en %s minutos'],\n    ['hace 1 hora', 'en 1 hora'],\n    ['hace %s horas', 'en %s horas'],\n    ['hace 1 día', 'en 1 día'],\n    ['hace %s días', 'en %s días'],\n    ['hace 1 semana', 'en 1 semana'],\n    ['hace %s semanas', 'en %s semanas'],\n    ['hace 1 mes', 'en 1 mes'],\n    ['hace %s meses', 'en %s meses'],\n    ['hace 1 año', 'en 1 año'],\n    ['hace %s años', 'en %s años']\n  ][index]\n}\nregisterTimeAgo('es-MX', timeAgo)\n\nconst translation = createTranslation({\n  // profile\n  Follow: () => 'Seguir',\n  Unfollow: () => 'Dejar de seguir',\n  'Edit profile': () => 'Editar perfil',\n  'Display name': () => 'Nombre para mostrar',\n  Description: () => 'Descripción',\n  'Thumbnail URL': () => 'URL de miniatura',\n  'Banner URL': () => 'URL del banner',\n\n  // menu\n  Home: () => 'Casa',\n  Profile: () => 'Perfil',\n  Search: () => 'Buscar',\n  'Search user ID': () => 'Buscar ID de usuario',\n  Peers: () => 'Compañeros',\n  'Connected peers posts': () => 'Publicaciones de compañeros conectados',\n  Stats: () => 'Estadisticas',\n  'Connected peers stats': () => 'Estadísticas de compañeros conectados',\n  'Connecting to peers': () => 'Conectando con sus compañeros',\n  Following: () => 'Siguiendo',\n  'Not following anyone': () => 'No seguir a nadie',\n  Export: () => 'Exportar',\n  Import: () => 'Importar',\n\n  // post\n  'Uncensorable content': () => 'Contenido sin censura',\n  Post: () => 'Publicación'\n})\n\nexport default translation\n","// credits: telegram @harq72\n\nimport createTranslation from '../create-translation'\nimport {register as registerTimeAgo} from 'timeago.js'\n\nconst timeAgo = (number, index, totalSec) => {\n  // copy paste timeAgo locale from https://github.com/hustcc/timeago.js/tree/master/src/lang\n  return [\n    ['éppen most', 'éppen most'],\n    ['%s másodperce', '%s másodpercen belül'],\n    ['1 perce', '1 percen belül'],\n    ['%s perce', '%s percen belül'],\n    ['1 órája', '1 órán belül'],\n    ['%s órája', '%s órán belül'],\n    ['1 napja', '1 napon belül'],\n    ['%s napja', '%s napon belül'],\n    ['1 hete', '1 héten belül'],\n    ['%s hete', '%s héten belül'],\n    ['1 hónapja', '1 hónapon belül'],\n    ['%s hónapja', '%s hónapon belül'],\n    ['1 éve', '1 éven belül'],\n    ['%s éve', '%s éven belül']\n  ][index]\n}\n\nregisterTimeAgo('hu', timeAgo)\n\nconst translation = createTranslation({\n  // profile\n  Follow: () => 'Követés',\n  Unfollow: () => 'Követés megszüntetése',\n  'Edit profile': () => 'Profil szerkesztése',\n  'Display name': () => 'Látható név',\n  Description: () => 'Leírás',\n  'Thumbnail URL': () => 'Profilkép URL',\n  'Banner URL': () => 'Banner URL',\n\n  // menu\n  Home: () => 'Home',\n  Profile: () => 'Profil',\n  Search: () => 'Keresés',\n  'Search user ID': () => 'Felhasználó ID keresése',\n  Peers: () => 'Kapcsolatok',\n  'Connected peers posts': () => 'Kapcsolatok üzenetei',\n  Stats: () => 'Statisztikák',\n  'Connected peers stats': () => 'Kapcsolatok statisztikái',\n  'Connecting to peers': () => 'Kapcsolódás',\n  Following: () => 'Követések',\n  'Not following anyone': () => 'Nem követ senkit',\n  Export: () => 'Exportálás',\n  Import: () => 'Importálás',\n\n  // post\n  'Uncensorable content': () => 'Cenzúrázhatatlan tartalom'\n})\n\nexport default translation\n","import enUs from './translations/en-us'\nimport esMx from './translations/es-mx'\nimport hu from './translations/hu'\n\n/* list of language codes\n\naf, sq, ar-SA, ar-IQ, ar-EG, ar-LY, ar-DZ, ar-MA, ar-TN, ar-OM,\nar-YE, ar-SY, ar-JO, ar-LB, ar-KW, ar-AE, ar-BH, ar-QA, eu, bg,\nbe, ca, zh-TW, zh-CN, zh-HK, zh-SG, hr, cs, da, nl, nl-BE, en,\nen-US, en-EG, en-AU, en-GB, en-CA, en-NZ, en-IE, en-ZA, en-JM,\nen-BZ, en-TT, et, fo, fa, fi, fr, fr-BE, fr-CA, fr-CH, fr-LU,\ngd, gd-IE, de, de-CH, de-AT, de-LU, de-LI, el, he, hi, hu,\nis, id, it, it-CH, ja, ko, lv, lt, mk, mt, no, pl,\npt-BR, pt, rm, ro, ro-MO, ru, ru-MI, sz, sr, sk, sl, sb,\nes, es-AR, es-GT, es-CR, es-PA, es-DO, es-MX, es-VE, es-CO,\nes-PE, es-EC, es-CL, es-UY, es-PY, es-BO, es-SV, es-HN, es-NI,\nes-PR, sx, sv, sv-FI, th, ts, tn, tr, uk, ur, ve, vi, xh,\nji, zu\n\n*/\n\nconst translations = {\n  'en-US': enUs,\n  'es-MX': esMx,\n  hu: hu\n}\nObject.freeze(translations)\n\nexport default translations\n","import {useState, createContext} from 'react'\nimport translations from './index'\n\nexport const LanguageCodeContext = createContext({\n  languageCode: 'en-US',\n  setLanguageCode: null\n})\n\nconst LanguageCodeProvider = (props) => {\n  const defaultLanguageCode = 'en-US'\n  const preferredLanguageCode = window.navigator.language\n  let localStorageLanguageCode = localStorage.getItem('languageCode') || preferredLanguageCode || defaultLanguageCode\n  if (!translations[localStorageLanguageCode]) {\n    console.warn(`no available translation for '${localStorageLanguageCode}'`)\n    localStorageLanguageCode = defaultLanguageCode\n  }\n\n  const [languageCode, _setLanguageCode] = useState(localStorageLanguageCode)\n\n  const setLanguageCode = (languageCode) => {\n    if (!translations[languageCode]) {\n      console.warn(`no available translation for '${languageCode}'`)\n      return\n    }\n    localStorage.setItem('languageCode', languageCode)\n    _setLanguageCode(languageCode)\n  }\n\n  const contextValue = {\n    languageCode,\n    setLanguageCode\n  }\n\n  const {children} = props\n  return <LanguageCodeContext.Provider value={contextValue}>{children}</LanguageCodeContext.Provider>\n}\n\nexport default LanguageCodeProvider\n","import {useContext} from 'react'\nimport {LanguageCodeContext} from './language-code-provider'\nimport translations from './index'\n\nconst useTranslation = () => {\n  const {languageCode} = useContext(LanguageCodeContext)\n  return translations[languageCode]\n}\n\nexport default useTranslation\n","// forked from https://www.npmjs.com/package/hashlru and replaced cache with localforage (indexeddb key value store)\n// TODO: needs to fork the unit tests, no clue if it works properly or has performance issues\n\nimport * as localForage from 'localforage'\nimport assert from 'assert'\nimport delay from 'delay'\n\nconst IdbLru = ({name, maxSize} = {}) => {\n  assert(typeof name === 'string', `invalid idb lru cache '${name}' not a string`)\n  assert(typeof maxSize === 'number', `invalid idb lru maxSize '${maxSize}' not a number`)\n\n  let cache, _cache, size\n  // init asynchronously because it makes a nice api\n  // and should not cause any problem\n  let ready = false\n  const init = async () => {\n    const cache1 = localForage.createInstance({name})\n    const cache2 = localForage.createInstance({name: `_${name}`})\n    const cache1Size = await cache1.length()\n    const cache2Size = await cache2.length()\n    // the bigger cache should become _cache\n    if (cache1Size > cache2Size) {\n      _cache = cache1\n      cache = cache2\n      size = cache1Size\n    }\n    else {\n      _cache = cache2\n      cache = cache1\n      size = cache2Size\n    }\n    ready = true\n  }\n  init()\n\n  const waitForReady = async () => {\n    if (ready) {\n      return\n    }\n    await delay(10)\n    await waitForReady()\n  }\n\n  /**\n   * @param {string} key\n   * @param {*} setValue\n   */\n  async function update (key, setValue) {\n    await cache.setItem(key, setValue)\n    size++\n    if (size >= maxSize) {\n      size = 0\n      const cacheTemp = cache\n      const _CacheTemp = _cache\n      _cache = cacheTemp\n      cache = _CacheTemp\n      await cache.clear()\n    }\n  }\n\n  return {\n    has: async function (key) {\n      await waitForReady()\n      const value = await cache.getItem(key)\n      const _value = await _cache.getItem(key)\n      return (value !== null && value !== undefined) || (_value !== null && _value !== undefined)\n    },\n    remove: async function (key) {\n      await waitForReady()\n      await cache.removeItem(key)\n      await _cache.removeItem(key)\n    },\n    get: async function (key) {\n      await waitForReady()\n      const value = await cache.getItem(key)\n      const _value = await _cache.getItem(key)\n\n      let v = value\n      if (v !== null && value !== undefined) return v\n      if ((v = _value) !== null && (v = _value) !== undefined) {\n        await update(key, v)\n        return v\n      }\n    },\n    set: async function (key, setValue) {\n      await waitForReady()\n      const value = await cache.getItem(key)\n      if (value !== null && value !== undefined) {\n        await cache.setItem(key, setValue)\n      }\n      else {\n        await update(key, setValue)\n      }\n    },\n    clear: async function () {\n      await waitForReady()\n      await cache.clear()\n      await _cache.clear()\n    }\n  }\n}\n\nwindow.IdbLru = IdbLru\n\nexport default IdbLru\n","/*\nhow to find connection info from sdp\n\nthe ip address, port and protocol are found in c= and m=, e.g.:\n\no=- 5426292242984389744 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\nm=application 64656 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 31.220.1.161\nb=AS:30\na=candidate:970568614 1 udp 2113937151 f6bd80ff-8fef-4b18-b97e-5d6317873c95.local 64656 typ host generation 0 network-cost 999\na=candidate:842163049 1 udp 1677729535 31.220.1.161 64656 typ srflx raddr 0.0.0.0 rport 0 generation 0 network-cost 999\na=ice-ufrag:9nHb\na=ice-pwd:BBIh/kIoQ58WUUj9GxikRqZN\n...\n*/\n\nimport * as sdpTransform from 'sdp-transform'\nimport assert from 'assert'\n\nimport IdbLru from 'src/lib/utils/idb-lru'\n\nimport Debug from 'debug'\nexport const sdpCache = IdbLru({\n  name: 'sdpCache',\n  maxSize: 2000\n})\nconst debug = Debug('sav3:sav3-ipfs:utils:webrtc')\n\n/**\n * cache webrtc sdp of each peer to get their ip addresses later\n *\n * @param {IPFS} ipfs\n * @returns {IPFS}\n */\nexport const withWebRtcSdpCache = (ipfs) => {\n  // outbound webrtc connections\n  let webRtcStarConnect = ipfs.libp2p.transportManager._transports.get('WebRTCStar')._connect\n  webRtcStarConnect = webRtcStarConnect.bind(ipfs.libp2p.transportManager._transports.get('WebRTCStar'))\n  ipfs.libp2p.transportManager._transports.get('WebRTCStar')._connect = webRtcStarConnectWithSdpCache(webRtcStarConnect)\n\n  // inbound webrtc connections\n  let webRtcStarUpgradeInbound = ipfs.libp2p.transportManager._transports.get('WebRTCStar')._upgrader.upgradeInbound\n  webRtcStarUpgradeInbound = webRtcStarUpgradeInbound.bind(ipfs.libp2p.transportManager._transports.get('WebRTCStar')._upgrader)\n  ipfs.libp2p.transportManager._transports.get('WebRTCStar')._upgrader.upgradeInbound = webRtcStarUpgradeInboundWithSdpCache(webRtcStarUpgradeInbound)\n\n  return ipfs\n}\n\n/**\n * wrap WebRTCStar._connect function to cache each peer sdp\n *\n * @param {Function} webRtcStarConnect - get it from ipfs.libp2p.transportManager._transports.get('WebRTCStar')._connect\n * @returns {Function} a wrapped WebRTCStar._connect function\n */\nconst webRtcStarConnectWithSdpCache = (webRtcStarConnect) => async (multiaddress, options) => {\n  const simplePeer = await webRtcStarConnect(multiaddress, options)\n  const cid = multiaddress.getPeerId()\n  sdpCache.set(cid, simplePeer._pc.remoteDescription.sdp)\n  debug('outbound webrtc connection', cid, simplePeer._pc.remoteDescription.sdp)\n  return simplePeer\n}\n\n/**\n * wrap WebRTCStar._upgrader.upgradeInbound function to cache each peer sdp\n *\n * @param {Function} webRtcStarUpgradeInbound - get it from ipfs.libp2p.transportManager._transports.get('WebRTCStar')._upgrader.upgradeInbound\n * @returns {Function} a wrapped WebRTCStar._upgrader.upgradeInbound function\n */\nconst webRtcStarUpgradeInboundWithSdpCache = (webRtcStarUpgradeInbound) => async (maConn) => {\n  const connection = await webRtcStarUpgradeInbound(maConn)\n  const cid = connection.remotePeer.toB58String()\n  sdpCache.set(cid, maConn.conn._pc.remoteDescription.sdp)\n  debug('inbound webrtc connection', cid, maConn.conn._pc.remoteDescription.sdp)\n  return connection\n}\n\n/**\n * get ip, port and protocol of a webrtc peer\n *\n * @param {string} peerId\n * @returns {{ip: string, port: number, protocol: string}}\n */\nexport const getWebRtcPeerConnectionInfo = async (peerId) => {\n  assert(peerId && typeof peerId === 'string', `invalid peer id ${peerId}`)\n  const sdpString = await sdpCache.get(peerId)\n  assert(sdpString, `no sdp cache for peer id '${peerId}'`)\n\n  const sdp = sdpTransform.parse(sdpString)\n  const webRtcPeerConnectionInfo = {\n    ip: sdp.media[0].connection.ip,\n    port: sdp.media[0].port,\n    protocol: sdp.media[0].protocol\n  }\n  return webRtcPeerConnectionInfo\n}\n\nexport default {\n  withWebRtcSdpCache,\n  sdpCache,\n  getWebRtcPeerConnectionInfo\n}\n","import QuickLRU from 'quick-lru'\nimport Debug from 'debug'\nexport const blockReceivedPeerCidCache = new QuickLRU({maxSize: 1000})\nconst debug = Debug('sav3:sav3-ipfs:utils:bitswap')\n\n/**\n * cache the peer cids of senders of blocks/files received\n *\n * @param {IPFS} ipfs\n * @returns {IPFS}\n */\nexport const withBlockReceivedPeerCidCache = (ipfs) => {\n  let bitswapUpdateReceiveCounters = ipfs.ipld.bs._bitswap._updateReceiveCounters\n  bitswapUpdateReceiveCounters = bitswapUpdateReceiveCounters.bind(ipfs.ipld.bs._bitswap)\n  ipfs.ipld.bs._bitswap._updateReceiveCounters = bitswapUpdateReceiveCountersWithBlockReceivedPeerCidCache(bitswapUpdateReceiveCounters)\n\n  return ipfs\n}\n\n/**\n * wrap Bitswap._updateReceiveCounters function to cache the peer cid of the sender of every block\n *\n * @param {Function} bitswapUpdateReceiveCounters - get it from ipfs.ipld.bs._bitswap._updateReceiveCounters\n * @returns {Function} a wrapped Bitswap._updateReceiveCounters function\n */\nconst bitswapUpdateReceiveCountersWithBlockReceivedPeerCidCache = (bitswapUpdateReceiveCounters) => (peerId, block, exists) => {\n  // first time we see this block/file\n  if (exists === false) {\n    const peerCid = peerId\n    const blockCid = block.cid.toString()\n    blockReceivedPeerCidCache.set(peerCid, blockCid)\n    debug('bitswapUpdateReceiveCounters', {peerCid, blockCid})\n  }\n  return bitswapUpdateReceiveCounters(peerId, block, exists)\n}\n\nexport default {\n  withBlockReceivedPeerCidCache,\n  blockReceivedPeerCidCache\n}\n","const thumbnailUrls = [\n  'https://i.imgur.com/iKxWt1c.jpg',\n  'https://i.imgur.com/iD4bp6Mb.jpg',\n  'https://i.imgur.com/65kSbHTb.jpg',\n  'https://i.imgur.com/tNsOG3Bb.jpg',\n  'https://i.imgur.com/qiQHwHbb.jpg',\n  'https://i.imgur.com/txRRZpd.jpeg'\n]\n\nconst bannerUrls = ['https://i.imgur.com/ImQWjja.jpeg', 'https://i.imgur.com/txRRZpd.jpeg', 'https://i.imgur.com/2LwSsSu.gif', 'https://i.imgur.com/gpKZaRK.jpeg']\n\nconst mediaUrls = ['https://i.imgur.com/qiQHwHb.mp4', 'i.imgur.com/ImQWjja.jpeg', 'http://i.imgur.com/txRRZpd.jpeg', 'https://i.imgur.com/2LwSsSu.gif', 'i.imgur.com/gpKZaRK.jpeg']\n\nconst displayNames = ['Jimmy Nguyen', 'Shadders', 'WallStreet5', 'Joshua Henslee', 'John M']\n\nconst descriptions = [\n  'Founder and CEO of XYZ.  Architect of the XYZ Protocol',\n  'I like Networks & Social Paradigm Shifts.',\n  'Spanish IT Raspberry Pi 4 + Python #BigData #Hacking #Cybersecurity #IoT #IPv6',\n  'U mad bro?',\n  'Praesentpellentesquetellussitametnuncfaucibus,sitametconvallissemporta.Sedmetudui,luctusavolutpatid,malesuadaadui.'\n]\n\nconst descriptionUrls = ['https://mystartup.com', 'mystartup.com', 'https://twitter.com/crypto', 'https://t.me/sav3org']\n\nconst contents = [\n  'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',\n  'Duis turpis nibh, feugiat gravida venenatis vitae, eleifend eu enim. Ut in luctus lorem. Vivamus lectus nunc, cursus eget eleifend ut, luctus et nibh.',\n  'Suspendisse',\n  'Praesent pellentesque tellus sit amet nunc faucibus, sit amet convallis sem porta. Sed metus dui, luctus a volutpat id, malesuada a dui.',\n  'https://verylonglink.com/veryveryveryveryveryveryveryveryveryvery-long-link Praesent pellentesque tellus sit amet nunc faucibus, sit amet convallis sem porta. Sed metus dui, luctus a volutpat id, malesuada a dui',\n  'Nullam egestas eget augue id dapibus',\n  'Praesentpellentesquetellussitametnuncfaucibus,sitametconvallissemporta.Sedmetudui,luctusavolutpatid,malesuadaadui.'\n]\n\nlet randomIndex = 0\nconst getRandomItemFromArray = (array) => {\n  let index = Math.floor(Math.random() * array.length)\n  index += randomIndex++\n  index = index % array.length\n  return array[index]\n}\n\nconst createWindowSav3IpfsTestMethods = (sav3Ipfs) => {\n  window.sav3IpfsTest = {}\n\n  window.sav3IpfsTest.add = async () => {\n    const data = {\n      content: 'hello world ' + Math.random()\n    }\n    const res = await sav3Ipfs.ipfs.add(data)\n    console.log(res)\n    // for await (const res of ipfs.add(data)) {\n    //   console.log(res)\n    // }\n  }\n\n  window.sav3IpfsTest.get = async (cid) => {\n    for await (const file of sav3Ipfs.ipfs.get(cid)) {\n      console.log(file.path)\n\n      if (!file.content) continue\n\n      const content = []\n\n      for await (const chunk of file.content) {\n        content.push(chunk)\n      }\n\n      console.log(content.toString())\n    }\n  }\n\n  window.sav3IpfsTest.addresses = async () => {\n    const res = await sav3Ipfs.ipfs.swarm.addrs()\n    for (const i in res) {\n      for (const addr of res[i].addrs) {\n        addr.string = addr.toString()\n      }\n    }\n    console.log(res)\n  }\n\n  window.sav3IpfsTest.peers = async () => {\n    const res = await sav3Ipfs.ipfs.swarm.peers()\n    for (const peer of res) {\n      peer.addrString = peer.addr.toString()\n    }\n    console.log(res)\n  }\n\n  window.sav3IpfsTest.editProfile = async () => {\n    const descriptionUrl = Math.random() > 0.5 ? getRandomItemFromArray(descriptionUrls) : ''\n    await sav3Ipfs.editUserProfile({\n      displayName: getRandomItemFromArray(displayNames),\n      description: `${getRandomItemFromArray(descriptions).substring(0, 100)} ${descriptionUrl}`,\n      thumbnailUrl: getRandomItemFromArray(thumbnailUrls),\n      bannerUrl: getRandomItemFromArray(bannerUrls)\n    })\n  }\n\n  window.sav3IpfsTest.publishPosts = async (amount = 5) => {\n    while (amount--) {\n      const mediaUrl = Math.random() > 0.5 ? getRandomItemFromArray(mediaUrls) : ''\n      await sav3Ipfs.publishPost({content: `${getRandomItemFromArray(contents).substring(0, 100)} ${mediaUrl}`})\n    }\n  }\n\n  window.sav3IpfsTest.editProfileAndPublishPosts = async (amount) => {\n    await window.sav3IpfsTest.editProfile()\n    await window.sav3IpfsTest.publishPosts(amount)\n  }\n\n  window.sav3IpfsTest.importExport = async (_newPrivateKey) => {\n    await sav3Ipfs.waitForReady()\n    const oldId = await sav3Ipfs.ipfs.id()\n    const oldCid = oldId.id\n    const oldPublicKey = oldId.publicKey\n    const oldPeerCid = await sav3Ipfs.getOwnPeerCid()\n    const oldPrivateKey = await sav3Ipfs.getPrivateKey()\n\n    await sav3Ipfs.setPrivateKey(_newPrivateKey || oldPrivateKey)\n    await sav3Ipfs.waitForReady()\n    const newId = await sav3Ipfs.ipfs.id()\n    const newCid = newId.id\n    const newPublicKey = newId.publicKey\n    const newPeerCid = await sav3Ipfs.getOwnPeerCid()\n    const newPrivateKey = await sav3Ipfs.getPrivateKey()\n\n    console.log('oldCid', oldCid)\n    console.log('newCid', newCid)\n    console.log('oldPeerCid', oldPeerCid)\n    console.log('newPeerCid', newPeerCid)\n    console.log('oldPublicKey', oldPublicKey)\n    console.log('newPublicKey', newPublicKey)\n    console.log('oldPrivateKey', oldPrivateKey)\n    console.log('newPrivateKey', newPrivateKey)\n  }\n\n  window.sav3IpfsTest.getPreviousPostCids = (...lastPostCids) => {\n    for (const lastPostCid of lastPostCids) {\n      ;(async () => {\n        let index = 1\n        for await (const postCid of sav3Ipfs.getPreviousPostCids(lastPostCid)) {\n          console.log('getPreviousPostCids', lastPostCid, index++, postCid)\n        }\n      })()\n    }\n  }\n}\n\nexport default createWindowSav3IpfsTestMethods\n","import assert from 'assert'\nimport Debug from 'debug'\n\nimport IdbLru from 'src/lib/utils/idb-lru'\nconst debug = Debug('sav3:sav3-ipfs:utils:post-replies')\nexport const postRepliesCache = IdbLru({\n  name: 'postRepliesCache',\n  maxSize: 2000\n})\n\nexport const cachePostReplyCid = async ({cid, parentPostCid} = {}) => {\n  assert(cid && typeof cid === 'string', `postRepliesUtils.cachePostReplyCid cid '${cid}' not a string`)\n  assert(parentPostCid && typeof parentPostCid === 'string', `postRepliesUtils.cachePostReplyCid parentPostCid '${parentPostCid}' not a string`)\n  const res = await postRepliesCache.get(parentPostCid)\n  let postRepliesCids = {}\n  if (res) {\n    postRepliesCids = JSON.parse(res)\n  }\n  postRepliesCids[cid] = true\n  debug('cachePostReplyCid', {cid, parentPostCid, postRepliesCids, res})\n  await postRepliesCache.set(parentPostCid, JSON.stringify(postRepliesCids))\n}\n\nexport const getPostRepliesCids = async (postCid) => {\n  assert(postCid && typeof postCid === 'string', `postRepliesUtils.getPostRepliesCids postCid '${postCid}' not a string`)\n  const res = await postRepliesCache.get(postCid)\n  let postRepliesCids = []\n  if (res) {\n    postRepliesCids = Object.keys(JSON.parse(res))\n  }\n\n  debug('getPostRepliesCids', {postCid, postRepliesCids, res})\n  return postRepliesCids\n}\n\nexport default {\n  postRepliesCache,\n  cachePostReplyCid,\n  getPostRepliesCids\n}\n","/*\n\ndata in sav3\n----\npost: a post or reply to a post\npost.cid\npost.par (post.parentPostCid): cid of post replying to\npost.pre (post.previousPostCid): cid of previous post (to be able to iterate through all)\npost.usr (post.userCid): cid of publisher (to be able to get profile)\npost.cnt (post.contentCid): cid of content (max 140 chars)\npost.tmp (post.timestamp): seconds\n\nprofile: the profile of a user\nprofile.nam (profile.diplayNameCid)\nprofile.des (profile.descriptionCid)\nprofile.thu (profile.thumbnailUrlCid)\nprofile.ban (profile.bannerUrlCid)\n\nsaves?\narray of user and post cids saved?\n\nfollowing: array of user cids that a user is following\n\nuserUserIpnsContent: latest ipns record of a user, contains pointers to a user's latest data\nuserUserIpnsContent.pro (userUserIpnsContent.profileCid)\nuserUserIpnsContent.las (userUserIpnsContent.lastPostCid)\nuserUserIpnsContent.fol (userUserIpnsContent.followingCid)\nuserUserIpnsContent.terminated? (possibly use ethereum for this so that it never gets unterminated)\n\n*/\n\nimport assert from 'assert'\n\nconst validateData = (data) => {\n  assert(data && (typeof data === 'string' || typeof data === 'object'), `invalid data to serialize '${data}' not a string or object`)\n}\n\nconst toObject = (data) => {\n  if (typeof data === 'string') {\n    try {\n      data = JSON.parse(data)\n    }\n    catch (e) {\n      throw Error(`invalid data to serialize '${data}' not valid json: ${e.message}`)\n    }\n  }\n  return data\n}\n\nexport const deserializePost = (data) => {\n  validateData(data)\n  data = toObject(data)\n\n  // validate mandatory post fields\n  assert(data.usr && typeof data.usr === 'string', `invalid post '${JSON.stringify(data)}' post.usr not a string`)\n  assert(data.cnt && typeof data.cnt === 'string', `invalid post '${JSON.stringify(data)}' post.cnt not a string`)\n  assert(data.tmp && typeof data.tmp === 'number', `invalid post '${JSON.stringify(data)}' post.tmp not a number`)\n\n  const post = {\n    userCid: data.usr,\n    contentCid: data.cnt,\n    timestamp: data.tmp,\n    parentPostCid: data.par,\n    previousPostCid: data.pre\n  }\n  return post\n}\n\nexport const deserializeProfile = (data) => {\n  validateData(data)\n  data = toObject(data)\n  const profile = {\n    diplayNameCid: data.nam,\n    descriptionCid: data.des,\n    thumbnailUrlCid: data.thu,\n    bannerUrlCid: data.ban\n  }\n  return profile\n}\n\nexport const deserializeUserIpnsContent = (data) => {\n  validateData(data)\n  data = toObject(data)\n  const userIpnsContent = {\n    profileCid: data.pro,\n    lastPostCid: data.las,\n    followingCid: data.fol\n  }\n  return userIpnsContent\n}\n\nexport const serializePost = (post) => {\n  // validate mandatory post fields\n  assert(post && typeof post === 'object', `invalid post '${JSON.stringify(post)}' post not an object`)\n  assert(post.userCid && typeof post.userCid === 'string', `invalid post '${JSON.stringify(post)}' post.userCid not a string`)\n  assert(post.contentCid && typeof post.contentCid === 'string', `invalid post '${JSON.stringify(post)}' post.contentCid not a string`)\n  assert(post.timestamp && typeof post.timestamp === 'number', `invalid post '${JSON.stringify(post)}' post.timestamp not a number`)\n  // validate optional post fields\n  assert(post.parentPostCid === undefined || (post.parentPostCid && typeof post.parentPostCid === 'string'), `invalid post '${JSON.stringify(post)}' post.parentPostCid not a string`)\n  assert(post.previousPostCid === undefined || (post.previousPostCid && typeof post.previousPostCid === 'string'), `invalid post '${JSON.stringify(post)}' post.previousPostCid not a string`)\n\n  const serializedPost = {\n    usr: post.userCid,\n    cnt: post.contentCid,\n    tmp: post.timestamp\n  }\n  if (post.parentPostCid) {\n    serializedPost.par = post.parentPostCid\n  }\n  if (post.previousPostCid) {\n    serializedPost.pre = post.previousPostCid\n  }\n  return JSON.stringify(serializedPost)\n}\n\nexport const serializeProfile = (profile) => {\n  assert(profile && typeof profile === 'object', `invalid profile '${JSON.stringify(profile)}' profile not an object`)\n\n  const serializedProfile = {}\n  if (profile.diplayNameCid) {\n    serializedProfile.nam = profile.diplayNameCid\n  }\n  if (profile.descriptionCid) {\n    serializedProfile.des = profile.descriptionCid\n  }\n  if (profile.thumbnailUrlCid) {\n    serializedProfile.thu = profile.thumbnailUrlCid\n  }\n  if (profile.bannerUrlCid) {\n    serializedProfile.ban = profile.bannerUrlCid\n  }\n  return JSON.stringify(serializedProfile)\n}\n\nexport const serializeUserIpnsContent = (userIpnsContent) => {\n  assert(userIpnsContent && typeof userIpnsContent === 'object', `invalid userIpnsContent '${JSON.stringify(userIpnsContent)}' userIpnsContent not an object`)\n\n  const serializedUserIpnsContent = {}\n  if (userIpnsContent.profileCid) {\n    serializedUserIpnsContent.pro = userIpnsContent.profileCid\n  }\n  if (userIpnsContent.lastPostCid) {\n    serializedUserIpnsContent.las = userIpnsContent.lastPostCid\n  }\n  if (userIpnsContent.followingCid) {\n    serializedUserIpnsContent.fol = userIpnsContent.followingCid\n  }\n  return JSON.stringify(serializedUserIpnsContent)\n}\n\nexport default {\n  deserializePost,\n  deserializeProfile,\n  deserializeUserIpnsContent,\n  serializePost,\n  serializeProfile,\n  serializeUserIpnsContent\n}\n","import Ipfs from 'ipfs'\nimport webRtcUtils from './utils/webrtc'\nimport bitswapUtils from './utils/bitswap'\nimport PeerId from 'peer-id'\nimport delay from 'delay'\nimport assert from 'assert'\nimport IpnsClient from './ipns-client'\nimport EventEmitter from 'events'\nimport ipns from 'ipns'\nimport crypto from 'libp2p-crypto'\nimport createWindowSav3IpfsTestMethods from './utils/create-window-sav3-ipfs-test-methods'\nimport uint8ArrayToString from 'uint8arrays/to-string'\nimport config from 'src/config'\nimport postRepliesUtils from './utils/post-replies'\nimport serialize from './utils/serialize'\nimport Debug from 'debug'\nconst debug = Debug('sav3:sav3-ipfs:index')\n\nclass Sav3Ipfs extends EventEmitter {\n  constructor () {\n    super()\n    this.ipfs = null\n    this.ipnsClient = null\n    this._initIpfs().catch(console.error)\n  }\n\n  async _initIpfs ({privateKey} = {}) {\n    const ipfsOptions = {\n      preload: {enabled: false},\n      config: {\n        Bootstrap: [],\n        Addresses: {\n          Delegates: [],\n          Swarm: config.starServers\n        }\n      }\n      // libp2p: {\n      //   config: {\n      //     dht: {\n      //       enabled: true\n      //     }\n      //   }\n      // }\n    }\n\n    // a random repo allows multiple tabs to have different peers\n    // which is good for testing\n    if (!privateKey && process.env.NODE_ENV === 'development') {\n      ipfsOptions.repo = Math.random().toString(36).substring(7)\n    }\n\n    // init ipfs with a specified private key\n    if (privateKey) {\n      ipfsOptions.config.Identity = {PrivKey: privateKey}\n    }\n\n    debug('_initIpfs', {ipfsOptions})\n\n    const ipfs = await Ipfs.create(ipfsOptions)\n    this.ipfs = webRtcUtils.withWebRtcSdpCache(ipfs)\n    this.ipfs = bitswapUtils.withBlockReceivedPeerCidCache(ipfs)\n\n    // init ipns client\n    this.ipnsClient = IpnsClient({ipfs})\n    // subscribe to new publishes\n    this.ipnsClient.on('publish', (ipnsPath, ipnsValue) => {\n      this.emit('publish', ipnsPath, ipnsValue)\n    })\n\n    // add to window for testing and debugging in console\n    window.ipfs = this.ipfs\n\n    this.ipfs.libp2p.on('peer:discovery', (peer) => {\n      debug('discovered', peer)\n    })\n\n    this.ipfs.libp2p.on('peer:connect', (peer) => {\n      debug('connected', peer)\n      this.ipfs.swarm.peers().then((peers) => debug('current peers connected: ', peers))\n    })\n\n    // silence listener memory leak warning\n    this.setMaxListeners(100)\n  }\n\n  /**\n   * get information and stats about all connected peers\n   *\n   * @returns {Promise<{peerCid: string, ip: string | undefined, port: number | undefined, protocol: string | undefined, dataReceived: number, dataSent: number}>}\n   */\n  async getPeersStats () {\n    await this.waitForReady()\n\n    const peersStats = []\n    const peerCids = await this.getPeersCids()\n    for (const peerCid of peerCids) {\n      peersStats.push(await this.getPeerStats(peerCid))\n    }\n    debug('getPeersStats', {peersStats})\n    return peersStats\n  }\n\n  async getPeerStats (peerCid) {\n    await this.waitForReady()\n    assert(typeof peerCid === 'string', `sav3Ipfs.getPeerStats peerId '${peerCid}' not a string`)\n\n    const metrics = this.ipfs.libp2p.metrics\n\n    let ip, port, protocol\n    try {\n      const connectionInfo = await webRtcUtils.getWebRtcPeerConnectionInfo(peerCid)\n      ip = connectionInfo.ip\n      port = connectionInfo.port\n      protocol = connectionInfo.protocol\n    }\n    catch (e) {}\n\n    const peerMetrics = metrics.forPeer(PeerId.createFromCID(peerCid)).toJSON()\n    const dataReceived = Number(peerMetrics.dataReceived)\n    const dataSent = Number(peerMetrics.dataSent)\n\n    const peerStats = {peerCid, ip, port, protocol, dataReceived, dataSent}\n    return peerStats\n  }\n\n  async getPeersCids () {\n    await this.waitForReady()\n    const peers = await this.ipfs.swarm.peers()\n    const peerCidsSet = new Set()\n    const peerCids = []\n    for (const peer of peers) {\n      const peerCid = peer.peer\n      // finds duplicate peers sometimes for unknown reason\n      if (peerCidsSet.has(peerCid)) {\n        continue\n      }\n      peerCidsSet.add(peerCid)\n      peerCids.push(peerCid)\n    }\n    return peerCids\n  }\n\n  async getPrivateKey () {\n    await this.waitForReady()\n    const encryptedPrivateKeyString = await this.ipfs.key.export('self', 'password')\n    const privateKey = await crypto.keys.import(encryptedPrivateKeyString, 'password')\n    return uint8ArrayToString(privateKey.bytes, 'base64')\n  }\n\n  async setPrivateKey (base64PrivateKey) {\n    assert(base64PrivateKey && typeof base64PrivateKey === 'string', `sav3Ipfs.setPrivateKey base64PrivateKey '${base64PrivateKey}' not a string`)\n    const ipfs = this.ipfs\n    delete this.ipfs\n    await ipfs.stop()\n    await this._initIpfs({privateKey: base64PrivateKey})\n  }\n\n  async getOwnPeerCid () {\n    await this.waitForReady()\n    return (await sav3Ipfs.ipfs.id()).id\n  }\n\n  async getOwnUserCid () {\n    await this.waitForReady()\n    // currently same as peer cid, but eventually should\n    // be different for privacy\n    return (await sav3Ipfs.ipfs.id()).id\n  }\n\n  async getOwnIpnsRecord () {\n    await this.waitForReady()\n    const ownCid = await sav3Ipfs.getOwnPeerCid()\n    const peerId = PeerId.createFromCID(ownCid)\n    const datastoreValue = await this.ipfs.libp2p.datastore.get(ipns.getLocalKey(peerId.id))\n    const ipnsRecord = ipns.unmarshal(datastoreValue)\n    return ipnsRecord\n  }\n\n  async setOwnIpnsRecord ({value, sequence} = {}) {\n    await this.waitForReady()\n    assert(value && typeof value === 'string', `sav3Ipfs.setOwnIpnsRecord value '${value}' not a string`)\n    assert(typeof sequence === 'number', `sav3Ipfs.setOwnIpnsRecord sequence '${sequence}' not a number`)\n\n    // needs /ipfs/ prefix to ipfs.name.resolve correctly\n    if (!value.startsWith('/ipfs/')) {\n      value = `/ipfs/${value}`\n    }\n\n    const validity = 1000 * 60 * 60 * 24 * 365 * 10 // 10 years\n    const encryptedPrivateKeyString = await this.ipfs.key.export('self', 'password')\n    const privateKey = await crypto.keys.import(encryptedPrivateKeyString, 'password')\n    const ipnsRecord = await ipns.create(privateKey, value, sequence, validity)\n    const marshalledIpnsRecord = ipns.marshal(ipnsRecord)\n\n    const ownCid = await sav3Ipfs.getOwnPeerCid()\n    const peerId = PeerId.createFromCID(ownCid)\n    await this.ipfs.libp2p.datastore.put(ipns.getLocalKey(peerId.id), marshalledIpnsRecord)\n\n    // resolve name right away or won't be available right away putting it\n    await this.ipfs.name.resolve(ownCid)\n    return ipnsRecord\n  }\n\n  async getIpfsContent (cid) {\n    await this.waitForReady()\n    assert(cid && typeof cid === 'string', `sav3Ipfs.getIpfsContent cid '${cid}' not a string`)\n    const file = (await this.ipfs.get(cid).next()).value\n    let content\n    if (file.content) {\n      const res = await file.content.next()\n      content = res && res.value && res.value.toString()\n    }\n    debug('getIpfsContent', {cid, file, content})\n    return content\n  }\n\n  async getUserIpnsContent (userIpnsContentCid) {\n    await this.waitForReady()\n    assert(userIpnsContentCid && typeof userIpnsContentCid === 'string', `sav3Ipfs.getUserIpnsContent userIpnsContentCid '${userIpnsContentCid}' not a string`)\n    return serialize.deserializeUserIpnsContent(await this.getIpfsContent(userIpnsContentCid))\n  }\n\n  async getOwnUserIpnsContent () {\n    await this.waitForReady()\n    const record = await this.getOwnIpnsRecord()\n    const ownIpfsValue = record.value.toString()\n    const lastIpnsContent = await this.getIpfsContent(ownIpfsValue)\n    debug('getOwnUserIpnsContent', {ownIpfsValue, lastIpnsContent})\n    if (!lastIpnsContent) {\n      return {}\n    }\n    return serialize.deserializeUserIpnsContent(lastIpnsContent)\n  }\n\n  async subscribeToIpnsPath (ipnsPath) {\n    assert(ipnsPath && typeof ipnsPath === 'string', `sav3Ipfs.subscribeToIpnsPath ipnsPath '${ipnsPath}' not a string`)\n    await this.waitForReady()\n    const ipnsValues = await this.ipnsClient.subscribe([ipnsPath])\n    return ipnsValues[0]\n  }\n\n  async subscribeToIpnsPaths (ipnsPaths) {\n    assert(Array.isArray(ipnsPaths), `sav3Ipfs.subscribeToIpnsPaths ipnsPaths '${ipnsPaths}' not an array`)\n    for (const ipnsPath of ipnsPaths) {\n      assert(ipnsPath && typeof ipnsPath === 'string', `sav3Ipfs.subscribeToIpnsPaths ipnsPaths '${JSON.stringify(ipnsPaths)}' contains non string`)\n    }\n    await this.waitForReady()\n    const ipnsValues = await this.ipnsClient.subscribe(ipnsPaths)\n    return ipnsValues\n  }\n\n  async publishPost ({content, parentPostCid} = {}) {\n    await this.waitForReady()\n    assert(content && typeof content === 'string', `sav3Ipfs.publishPost content '${content}' not a string`)\n    assert(content.length <= 140, `sav3Ipfs.publishPost content '${content}' longer than 140 chars`)\n    assert(!parentPostCid || typeof parentPostCid === 'string', `sav3Ipfs.publishPost parentPostCid '${parentPostCid}' not a string`)\n\n    const ipnsContent = await this.getOwnUserIpnsContent()\n    const newPost = {}\n    newPost.previousPostCid = ipnsContent.lastPostCid\n    newPost.timestamp = Math.round(Date.now() / 1000)\n    newPost.userCid = (await this.ipfs.id()).id\n    newPost.contentCid = (await this.ipfs.add(content)).cid.toString()\n\n    const newPostCid = (await this.ipfs.add(serialize.serializePost(newPost))).cid.toString()\n    const newIpnsContent = {...ipnsContent, lastPostCid: newPostCid}\n    const newIpnsContentCid = (await this.ipfs.add(serialize.serializeUserIpnsContent(newIpnsContent))).cid.toString()\n\n    await this.publishIpnsRecord(newIpnsContentCid)\n    debug('publishPost', {newIpnsContentCid, newPost, newIpnsContent, ipnsContent, newPostCid, parentPostCid})\n\n    if (parentPostCid) {\n      await postRepliesUtils.cachePostReplyCid({cid: newPostCid, parentPostCid})\n    }\n\n    return newPostCid\n  }\n\n  async setFollowing (userCids) {\n    await this.waitForReady()\n    assert(Array.isArray(userCids), `sav3Ipfs.setFollowing userCids '${userCids}' not an array`)\n\n    // sort to avoid creating cids if unnecessary\n    userCids = [...userCids].sort()\n\n    const ipnsContent = await this.getOwnUserIpnsContent()\n    const followingCid = (await this.ipfs.add(JSON.stringify(userCids))).cid.toString()\n    if (ipnsContent.followingCid === followingCid) {\n      debug('setFollowing duplicate following cid', {userCids})\n      return\n    }\n    const newIpnsContent = {...ipnsContent, followingCid}\n    const newIpnsContentCid = (await this.ipfs.add(serialize.serializeUserIpnsContent(newIpnsContent))).cid.toString()\n\n    await this.publishIpnsRecord(newIpnsContentCid)\n    debug('setFollowing', {newIpnsContentCid, userCids, followingCid, newIpnsContent, ipnsContent})\n\n    return followingCid\n  }\n\n  async getUserFollowing (userCid) {\n    await this.waitForReady()\n    assert(userCid && typeof userCid === 'string', `sav3Ipfs.getUserFollowing userCid '${userCid}' not a string`)\n    let following = []\n\n    const [ipnsValue] = await this.ipnsClient.subscribe([userCid])\n    if (ipnsValue) {\n      const ipnsContent = await this.getUserIpnsContent(ipnsValue)\n      if (ipnsContent.followingCid) {\n        following = JSON.parse(await this.getIpfsContent(ipnsContent.followingCid))\n      }\n    }\n\n    debug('getUserFollowing', {userCid, following, ipnsValue})\n    return following\n  }\n\n  async publishIpnsRecord (newIpnsContentCid) {\n    await this.waitForReady()\n    assert(typeof newIpnsContentCid === 'string', `sav3Ipfs.publishIpnsRecord '${newIpnsContentCid}' not a string`)\n    // use the ipns server and this.setOwnIpnsRecord until ipfs.name.publish is implemented in browser\n    const sequence = (await this.getOwnIpnsRecordSequence()) + 1\n    await this.ipnsClient.publish({value: newIpnsContentCid, sequence})\n    await this.setOwnIpnsRecord({value: newIpnsContentCid, sequence})\n    debug('publishIpnsRecord', {newIpnsContentCid, sequence})\n  }\n\n  async editUserProfile ({displayName, description, thumbnailUrl, bannerUrl} = {}) {\n    await this.waitForReady()\n    const profile = {}\n\n    if (displayName) {\n      assert(typeof displayName === 'string', 'display name not a string')\n      assert(displayName.length <= 50, `display name '${displayName}' longer than 50 chars`)\n      profile.diplayNameCid = (await this.ipfs.add(displayName)).cid.toString()\n    }\n    if (description) {\n      assert(typeof description === 'string', 'description not a string')\n      assert(description.length <= 140, `description '${description}' longer than 140 chars`)\n      profile.descriptionCid = (await this.ipfs.add(description)).cid.toString()\n    }\n    if (thumbnailUrl) {\n      assert(typeof thumbnailUrl === 'string', 'thumbnail url not a string')\n      assert(thumbnailUrl.startsWith('https://'), `thumbnail url '${thumbnailUrl}' does not start with https://`)\n      assert(thumbnailUrl.length <= 140, `thumbnail url '${thumbnailUrl}' longer than 140 chars`)\n      profile.thumbnailUrlCid = (await this.ipfs.add(thumbnailUrl)).cid.toString()\n    }\n    if (bannerUrl) {\n      assert(typeof bannerUrl === 'string', 'banner url not a string')\n      assert(bannerUrl.startsWith('https://'), `banner url '${bannerUrl}' does not start with https://`)\n      assert(bannerUrl.length <= 140, `banner url '${thumbnailUrl}' longer than 140 chars`)\n      profile.bannerUrlCid = (await this.ipfs.add(bannerUrl)).cid.toString()\n    }\n\n    const profileCid = (await this.ipfs.add(serialize.serializeProfile(profile))).cid.toString()\n\n    const ipnsContent = await this.getOwnUserIpnsContent()\n    ipnsContent.profileCid = profileCid\n    const newIpnsContentCid = (await this.ipfs.add(serialize.serializeUserIpnsContent(ipnsContent))).cid.toString()\n    await this.publishIpnsRecord(newIpnsContentCid)\n    debug('editProfile', {displayName, description, thumbnailUrl, bannerUrl, ipnsContent, profile, profileCid, newIpnsContentCid})\n\n    return profileCid\n  }\n\n  async getUserProfile (profileCid) {\n    await this.waitForReady()\n    assert(typeof profileCid === 'string', `sav3Ipfs.getUserProfile profileCid '${profileCid}' not a string`)\n    const profileCids = serialize.deserializeProfile(await this.getIpfsContent(profileCid))\n    const profile = {}\n    if (profileCids.diplayNameCid) {\n      profile.displayName = await this.getIpfsContent(profileCids.diplayNameCid)\n    }\n    if (profileCids.descriptionCid) {\n      profile.description = await this.getIpfsContent(profileCids.descriptionCid)\n    }\n    if (profileCids.thumbnailUrlCid) {\n      profile.thumbnailUrl = await this.getIpfsContent(profileCids.thumbnailUrlCid)\n    }\n    if (profileCids.bannerUrlCid) {\n      profile.bannerUrl = await this.getIpfsContent(profileCids.bannerUrlCid)\n    }\n\n    debug('getUserProfile', {profileCid, profileCids, profile})\n    return profile\n  }\n\n  async getOwnIpnsRecordSequence () {\n    await this.waitForReady()\n    const ipnsRecord = await this.getOwnIpnsRecord()\n    const sequence = ipnsRecord\n    const ownCid = await sav3Ipfs.getOwnPeerCid()\n    const [remoteIpnsRecord] = await this.ipnsClient.getRecords([ownCid])\n    const remoteSequence = (remoteIpnsRecord && remoteIpnsRecord.sequence) || 0\n    if (sequence > remoteSequence) {\n      return sequence\n    }\n    else {\n      return remoteSequence\n    }\n  }\n\n  // don't use this anywhere because it's synchronous and slow\n  async getUserPostsFromLastPostCid (lastPostCid) {\n    await this.waitForReady()\n    assert(lastPostCid && typeof lastPostCid === 'string', `sav3Ipfs.getUserPostsFromLastPostCid lastPostCid '${lastPostCid}' not a string`)\n    const posts = []\n\n    const maxPostCount = 5\n\n    while (true) {\n      // no more last post id so reached the first post by that user\n      if (!lastPostCid) {\n        break\n      }\n      if (posts.length >= maxPostCount) {\n        break\n      }\n\n      const post = await this.getPost(lastPostCid)\n      lastPostCid = post.previousPostCid\n      posts.push(post)\n    }\n\n    debug('getUserPostsFromLastPostCid', {lastPostCid, posts})\n    return posts\n  }\n\n  async * getPreviousPostCids (lastPostCid) {\n    await this.waitForReady()\n    assert(lastPostCid && typeof lastPostCid === 'string', `sav3Ipfs.getPostCidsFromLastPostCid lastPostCid '${lastPostCid}' not a string`)\n\n    let previousPostCid = lastPostCid\n    let postCount = 0\n\n    // loop over every post and yield\n    while (true) {\n      postCount++\n      yield previousPostCid\n      const post = serialize.deserializePost(await this.getIpfsContent(previousPostCid))\n      debug('getPreviousPostCids', {lastPostCid, previousPostCid, post, postCount})\n      if (!post.previousPostCid) {\n        return\n      }\n      previousPostCid = post.previousPostCid\n    }\n  }\n\n  async getPost (postCid) {\n    await this.waitForReady()\n    assert(postCid && typeof postCid === 'string', `sav3Ipfs.getPost postCid '${postCid}' not a string`)\n    debug('getPost', {postCid})\n\n    const post = serialize.deserializePost(await this.getIpfsContent(postCid))\n    post.cid = postCid\n\n    if (post.parentPostCid) {\n      await postRepliesUtils.cachePostReplyCid({cid: post.cid, parentPostCid: post.parentPostCid})\n    }\n\n    post.content = await this.getIpfsContent(post.contentCid)\n    debug('getPost returns', {postCid, post})\n    return post\n  }\n\n  async getPostRepliesCids (postCid) {\n    await this.waitForReady()\n    assert(postCid && typeof postCid === 'string', `sav3Ipfs.getPostRepliesCids postCid '${postCid}' not a string`)\n    const repliesCids = await postRepliesUtils.getPostRepliesCids(postCid)\n    return repliesCids\n  }\n\n  /**\n   * ipfs has finished initializing and its methods are ready to use\n   *\n   * @returns {boolean}\n   */\n  isReady () {\n    return !!this.ipfs\n  }\n\n  async waitForReady () {\n    if (this.ipfs) {\n      return\n    }\n    await delay(10)\n    await this.waitForReady()\n  }\n}\n\nconst sav3Ipfs = new Sav3Ipfs()\n\n// for testing\nwindow.sav3Ipfs = sav3Ipfs\nwindow.Ipfs = Ipfs\ncreateWindowSav3IpfsTestMethods(sav3Ipfs)\n\n// export a singleton to be used throughout the app\nexport default sav3Ipfs\n","import Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport PropTypes from 'prop-types'\nimport {makeStyles, useTheme} from '@material-ui/core/styles'\nimport CloseIcon from '@material-ui/icons/Close'\nimport IconButton from '@material-ui/core/IconButton'\nimport Box from '@material-ui/core/Box'\nimport Divider from '@material-ui/core/Divider'\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\n\nconst useStyles = makeStyles((theme) => ({\n  content: {\n    paddingTop: 0,\n    paddingBottom: 0,\n    overflow: 'hidden'\n  }\n}))\n\nfunction Modal ({open, onClose, content, actions} = {}) {\n  const classes = useStyles()\n  const theme = useTheme()\n  const fullScreen = useMediaQuery(theme.breakpoints.down('xs'))\n\n  return (\n    <Dialog fullScreen={fullScreen} fullWidth={true} maxWidth='xs' open={open} onClose={onClose}>\n      <Box alignItems='center' display='flex' px={2} height={theme.sav3.topBar.height}>\n        <Box flexGrow={1}>\n          <IconButton onClick={onClose}>\n            <CloseIcon />\n          </IconButton>\n        </Box>\n        {fullScreen && <Box px={1}>{actions}</Box>}\n      </Box>\n      <Divider />\n      <DialogContent className={classes.content}>{content}</DialogContent>\n      {!fullScreen && (\n        <div>\n          <Divider />\n          <Box alignItems='center' display='flex' px={3} height={theme.sav3.topBar.height}>\n            <Box flexGrow={1}></Box>\n            <Box>{actions}</Box>\n          </Box>\n        </div>\n      )}\n    </Dialog>\n  )\n}\n\nModal.propTypes = {\n  open: PropTypes.bool.isRequired,\n  onClose: PropTypes.func.isRequired,\n  content: PropTypes.element.isRequired,\n  actions: PropTypes.element.isRequired\n}\n\nexport default Modal\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-user-ipns-content')\n\nconst useUserIpnsContent = (ipnsPath) => {\n  assert(!ipnsPath || typeof ipnsPath === 'string', `invalid ipnsPath '${JSON.stringify(ipnsPath)}'`)\n  const [userIpnsContent, setUserIpnsContent] = useState()\n  debug({ipnsPath, userIpnsContent})\n\n  useEffect(() => {\n    // reset content on ipns path change\n    if (userIpnsContent) {\n      setUserIpnsContent()\n    }\n    if (!ipnsPath) {\n      return\n    }\n\n    // subscribe to future published ipns paths\n    const onPublish = async (newIpnsPath, ipnsValue) => {\n      if (ipnsPath !== newIpnsPath) {\n        // publish event is a different user\n        return\n      }\n      const ipnsContent = await sav3Ipfs.getUserIpnsContent(ipnsValue)\n      setUserIpnsContent(ipnsContent)\n    }\n    sav3Ipfs.on('publish', onPublish)\n\n    // get the current ipns path\n    ;(async () => {\n      const ipnsValue = await sav3Ipfs.subscribeToIpnsPath(ipnsPath)\n      if (!ipnsValue) {\n        // user has not published anything yet\n        setUserIpnsContent()\n        return\n      }\n      const ipnsContent = await sav3Ipfs.getUserIpnsContent(ipnsValue)\n      setUserIpnsContent(ipnsContent)\n    })()\n\n    // unsubscribe after component unmounts\n    return () => {\n      sav3Ipfs.off('publish', onPublish)\n    }\n  }, [ipnsPath])\n\n  return userIpnsContent\n}\n\nexport default useUserIpnsContent\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport useUserIpnsContent from 'src/hooks/use-user-ipns-content'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-user-profile')\n\nconst useUserProfile = (userCid) => {\n  assert(!userCid || typeof userCid === 'string', `invalid userCid '${JSON.stringify(userCid)}'`)\n  const defaultUserProfile = {}\n  const [userProfile, setUserProfile] = useState(defaultUserProfile)\n  const userIpnsContent = useUserIpnsContent(userCid)\n  const profileCid = userIpnsContent && userIpnsContent.profileCid\n  debug({userIpnsContent, userCid, profileCid, userProfile})\n\n  useEffect(() => {\n    // set profile to default on profile change\n    if (JSON.stringify(userProfile) !== JSON.stringify(defaultUserProfile)) {\n      setUserProfile(defaultUserProfile)\n    }\n    if (!profileCid || typeof profileCid !== 'string') {\n      return\n    }\n    ;(async () => {\n      const userProfile = await sav3Ipfs.getUserProfile(profileCid)\n      setUserProfile(userProfile)\n    })()\n  }, [profileCid])\n\n  return userProfile\n}\n\nexport default useUserProfile\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\n\nconst useOwnUserCid = () => {\n  const [ownUserCid, setOwnUserCid] = useState()\n\n  useEffect(() => {\n    ;(async () => {\n      const ownUserCid = await sav3Ipfs.getOwnUserCid()\n      setOwnUserCid(ownUserCid)\n    })()\n  }, [])\n\n  return ownUserCid\n}\n\nexport default useOwnUserCid\n","import {useState, Fragment} from 'react'\nimport Button from '@material-ui/core/Button'\nimport TextField from '@material-ui/core/TextField'\nimport useTranslation from 'src/translations/use-translation'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport PropTypes from 'prop-types'\nimport Alert from '@material-ui/lab/Alert'\nimport {makeStyles} from '@material-ui/core/styles'\nimport Modal from 'src/components/modal'\nimport useUserProfile from 'src/hooks/use-user-profile'\nimport useOwnUserCid from 'src/hooks/use-own-user-cid'\nimport Avatar from '@material-ui/core/Avatar'\nimport Box from '@material-ui/core/Box'\nimport Typography from '@material-ui/core/Typography'\n\nconst useStyles = makeStyles((theme) => ({\n  errorMessage: {\n    overflow: 'hidden'\n  },\n  content: {\n    '& textarea': {\n      overflow: 'hidden'\n    },\n    // remove text input variant borders\n    '& fieldset': {\n      border: 'none'\n    },\n    marginBottom: theme.spacing(1)\n  },\n  avatar: {\n    // slightly higher placement than the user name seems more pleasing\n    marginTop: theme.spacing(-0.25),\n    width: theme.spacing(6),\n    height: theme.spacing(6),\n    // borders\n    borderWidth: theme.sav3.borderWidth,\n    borderStyle: 'solid',\n    borderColor: theme.sav3.borderColor\n  },\n  userCid: {\n    wordBreak: 'break-all'\n  }\n}))\n\nfunction PublishPostModal ({open, onClose, parentPost} = {}) {\n  const t = useTranslation()\n  const classes = useStyles()\n  const [content, setContent] = useState('')\n  const [errorMessage, setErrorMessage] = useState()\n\n  const userCid = useOwnUserCid()\n  const profile = useUserProfile(userCid)\n\n  const handleChange = (event) => {\n    let content = event.target.value\n    try {\n      if (content.length > 140) {\n        content = content.subtring(0, 140)\n      }\n      setContent(content)\n    }\n    catch (e) {}\n  }\n\n  const handlePublish = async () => {\n    const parentPostCid = parentPost && parentPost.cid\n\n    try {\n      await sav3Ipfs.publishPost({content, parentPostCid})\n      setErrorMessage(null)\n      setContent('')\n      onClose()\n    }\n    catch (e) {\n      setErrorMessage(e.message)\n    }\n  }\n\n  const modalContent = (\n    <Fragment>\n      {parentPost && <ParentPost parentPost={parentPost} />}\n      <Box display='flex'>\n        <Box pr={1} py={1.5}>\n          <Avatar src={profile.thumbnailUrl} className={classes.avatar} />\n        </Box>\n        <TextField\n          autoFocus\n          className={classes.content}\n          onChange={handleChange}\n          margin='dense'\n          id='content'\n          placeholder={t['Uncensorable content']()}\n          fullWidth\n          multiline\n          rows={4}\n          variant='outlined'\n          value={content}\n        />\n        {errorMessage && (\n          <Alert classes={{message: classes.errorMessage}} severity='error'>\n            {errorMessage}\n          </Alert>\n        )}\n      </Box>\n    </Fragment>\n  )\n\n  const modalActions = (\n    <div>\n      <Button disableElevation variant='contained' onClick={handlePublish} color='primary'>\n        SAV3\n      </Button>\n    </div>\n  )\n\n  return <Modal onClose={onClose} open={open} content={modalContent} actions={modalActions} />\n}\n\nPublishPostModal.propTypes = {\n  open: PropTypes.bool.isRequired,\n  onClose: PropTypes.func.isRequired,\n  parentPost: PropTypes.object\n}\n\nfunction ParentPost ({parentPost} = {}) {\n  const classes = useStyles()\n  return (\n    <Box display='flex'>\n      <Box pr={1} py={1.5}>\n        <Avatar src={parentPost.profile.thumbnailUrl} className={classes.avatar} />\n      </Box>\n      <Box pt={1.5} pl={0.5} flexGrow={1}>\n        {parentPost.profile.displayName && <Typography variant='subtitle2'>{parentPost.profile.displayName}</Typography>}\n        <Typography variant='caption' color='textSecondary' className={classes.userCid}>\n          {parentPost.userCid}\n        </Typography>\n        <Typography variant='body2'>{parentPost.content}</Typography>\n      </Box>\n    </Box>\n  )\n}\n\nexport default PublishPostModal\n","import {useState} from 'react'\nimport {makeStyles} from '@material-ui/core/styles'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport HomeIcon from '@material-ui/icons/Home'\nimport AccountCircle from '@material-ui/icons/AccountCircle'\nimport SearchIcon from '@material-ui/icons/Search'\nimport GroupIcon from '@material-ui/icons/Group'\nimport BarChartIcon from '@material-ui/icons/BarChart'\nimport PeersIcon from '@material-ui/icons/Wifi'\nimport FeedIcon from '@material-ui/icons/Forum'\nimport Button from '@material-ui/core/Button'\nimport Box from '@material-ui/core/Box'\nimport CreateIcon from '@material-ui/icons/Create'\nimport Fab from '@material-ui/core/Fab'\nimport {Link as RouterLink} from 'react-router-dom'\nimport useTranslation from 'src/translations/use-translation'\nimport PublishPostModal from 'src/components/publish-post/modal'\n\nconst useStyles = makeStyles((theme) => ({\n  logo: {\n    height: '1.1em'\n  },\n  logoButton: {\n    height: '2.2em',\n    width: '2.2em'\n  },\n  createTextButtonBox: {\n    [theme.breakpoints.down('md')]: {\n      display: 'none'\n    }\n  },\n  createIconButtonBox: {\n    [theme.breakpoints.up('lg')]: {\n      display: 'none'\n    }\n  },\n  createIconButton: {\n    boxShadow: 'none'\n  },\n  text: {\n    [theme.breakpoints.down('md')]: {\n      display: 'none'\n    }\n  },\n  root: {\n    position: 'fixed',\n    width: 'inherit', // makes width 100% with position fixed\n    [theme.breakpoints.up('lg')]: {\n      paddingLeft: theme.spacing(2),\n      paddingRight: theme.spacing(2)\n    }\n  }\n}))\n\nfunction LeftMenu () {\n  const classes = useStyles()\n  const t = useTranslation()\n\n  return (\n    <div className={classes.root}>\n      <List>\n        <ListItem button component={RouterLink} to='/'>\n          <ListItemIcon>\n            <HomeIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Home()} className={classes.text} />\n        </ListItem>\n        <ListItem button component={RouterLink} to='/feed'>\n          <ListItemIcon>\n            <FeedIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Feed()} className={classes.text} />\n        </ListItem>\n        <ListItem button component={RouterLink} to='/search'>\n          <ListItemIcon>\n            <SearchIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Search()} className={classes.text} />\n        </ListItem>\n        <ListItem button component={RouterLink} to='/following'>\n          <ListItemIcon>\n            <GroupIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Following()} className={classes.text} />\n        </ListItem>\n        <ListItem button component={RouterLink} to='/peers'>\n          <ListItemIcon>\n            <PeersIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Peers()} className={classes.text} />\n        </ListItem>\n        <ListItem button component={RouterLink} to='/stats'>\n          <ListItemIcon>\n            <BarChartIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Stats()} className={classes.text} />\n        </ListItem>\n        <ListItem button component={RouterLink} to='/profile'>\n          <ListItemIcon>\n            <AccountCircle fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Profile()} className={classes.text} />\n        </ListItem>\n        <PublishPostButton />\n      </List>\n    </div>\n  )\n}\n\nfunction PublishPostButton () {\n  const classes = useStyles()\n\n  const [openPublishPostModal, setOpenPublishPostModal] = useState(false)\n  return (\n    <div>\n      <Box my={2} mx={1} alignItems='center' display='flex' className={classes.createTextButtonBox} onClick={() => setOpenPublishPostModal(true)}>\n        <Button color='primary' fullWidth variant='contained' size='large' disableElevation>\n          SAV3\n        </Button>\n      </Box>\n\n      <Box my={2} pl={1} alignItems='center' display='flex' className={classes.createIconButtonBox} onClick={() => setOpenPublishPostModal(true)}>\n        <Fab color='primary' className={classes.createIconButton} size='medium'>\n          <CreateIcon />\n        </Fab>\n      </Box>\n\n      <PublishPostModal open={openPublishPostModal} onClose={() => setOpenPublishPostModal(false)} />\n    </div>\n  )\n}\n\nexport default LeftMenu\n","import {useState} from 'react'\nimport {makeStyles} from '@material-ui/core/styles'\nimport BottomNavigation from '@material-ui/core/BottomNavigation'\nimport Box from '@material-ui/core/Box'\nimport Fab from '@material-ui/core/Fab'\nimport BottomNavigationAction from '@material-ui/core/BottomNavigationAction'\nimport CreateIcon from '@material-ui/icons/Create'\nimport HomeIcon from '@material-ui/icons/Home'\nimport SearchIcon from '@material-ui/icons/Search'\nimport {Link as RouterLink, useRouteMatch} from 'react-router-dom'\nimport PublishPostModal from 'src/components/publish-post/modal'\nimport PeersIcon from '@material-ui/icons/Wifi'\nimport FeedIcon from '@material-ui/icons/Forum'\n\nconst useStyles = makeStyles((theme) => ({\n  menu: {\n    // stick to bottom\n    width: '100%',\n    position: 'fixed',\n    bottom: 0\n  },\n  createIconButtonBox: {\n    right: theme.spacing(4),\n    bottom: theme.spacing(8)\n  },\n  createIconButton: {\n    // boxShadow: 'none'\n  }\n}))\n\nfunction BottomMenu ({className} = {}) {\n  const classes = useStyles()\n  const route = useRouteMatch('/:route')\n  const activeMenu = route && route.params && route.params.route ? route.params.route : 'home'\n\n  return (\n    <Box className={className}>\n      <BottomNavigation value={activeMenu} className={classes.menu}>\n        <PublishPostButton />\n        <BottomNavigationAction component={RouterLink} to='/' value='home' icon={<HomeIcon />} />\n        <BottomNavigationAction component={RouterLink} to='/search' value='search' icon={<SearchIcon />} />\n        <BottomNavigationAction component={RouterLink} to='/feed' value='feed' icon={<FeedIcon />} />\n        <BottomNavigationAction component={RouterLink} to='/peers' value='peers' icon={<PeersIcon />} />\n      </BottomNavigation>\n      {/* give real height to fixed bottom nav */}\n      <Box width={0} className='MuiBottomNavigation-root' />\n    </Box>\n  )\n}\n\nfunction PublishPostButton () {\n  const classes = useStyles()\n\n  const [openPublishPostModal, setOpenPublishPostModal] = useState(false)\n  return (\n    <Box position='absolute' className={classes.createIconButtonBox}>\n      <Box my={2} pl={1} alignItems='center' display='flex' className={classes.createIconButton} onClick={() => setOpenPublishPostModal(true)}>\n        <Fab color='primary' className={classes.createIconButton} size='large'>\n          <CreateIcon />\n        </Fab>\n      </Box>\n\n      <PublishPostModal open={openPublishPostModal} onClose={() => setOpenPublishPostModal(false)} />\n    </Box>\n  )\n}\n\nexport default BottomMenu\n","import merge from 'lodash.merge'\nimport {createMuiTheme, responsiveFontSizes} from '@material-ui/core/styles'\n\n// use neutral grey border color so it looks OK on\n// both light and dark theme\n// default borders and dividers are too opaque\nconst borderColor = 'rgb(127, 127, 127, 0.05)'\n\n// regular top bar is too big\nconst topBarHeight = 54\n\nconst baseMuiThemeOptions = {\n  breakpoints: {\n    values: {\n      xs: 0,\n      sm: 682,\n      md: 960,\n      lg: 1280,\n      xl: 1920\n    }\n  },\n  sav3: {\n    layout: {\n      columns: {\n        left: {\n          width: {\n            md: 275,\n            // sm width is never used but might be useful someday\n            sm: 88,\n            xs: 68\n          }\n        },\n        middle: {\n          width: {\n            md: 600\n          }\n        },\n        right: {\n          width: {\n            lg: 350,\n            md: 290\n          }\n        }\n      }\n    },\n    borderWidth: 1,\n    borderColor,\n    topBar: {\n      height: topBarHeight\n    },\n    drawerMenu: {\n      width: 280\n    },\n    popoverMenu: {\n      // small popover menus are too rounded\n      borderRadius: 4\n    }\n  },\n  palette: {\n    divider: borderColor\n  },\n  shape: {\n    // buttons are not rounded enough\n    borderRadius: 24\n  },\n  overrides: {\n    MuiToolbar: {\n      root: {\n        // top bar is too wide\n        minHeight: `${topBarHeight}px!important`\n      }\n    },\n    MuiDialog: {\n      paper: {\n        margin: 0\n      },\n      paperFullWidth: {\n        // regular full width has padding on mobile\n        width: '100%'\n      }\n    },\n    MuiSvgIcon: {\n      fontSizeLarge: {\n        // left menu icons are too big\n        fontSize: '1.8rem'\n      }\n    },\n    MuiFab: {\n      root: {\n        // default box shadow is too intense\n        boxShadow: 'rgba(101, 119, 134, 0.2) 0px 0px 8px, rgba(101, 119, 134, 0.25) 0px 1px 3px 1px'\n      }\n    },\n    MuiButton: {\n      outlined: {\n        fontWeight: 900\n      }\n    }\n  }\n}\n\nconst createTheme = (muiThemeOptions) => {\n  let theme = createMuiTheme(merge({}, baseMuiThemeOptions, muiThemeOptions))\n  theme = responsiveFontSizes(theme)\n  return theme\n}\n\nexport default createTheme\n","import createTheme from '../create-theme'\n\nconst lightPrimary = '#857990'\n\nconst theme = createTheme({\n  palette: {\n    type: 'dark',\n    primary: {\n      light: '#7a7380',\n      main: '#4e4854',\n      dark: '#26212b'\n    },\n    secondary: {\n      // grey\n      // main: '#a9a7a8',\n      // blue\n      main: '#484854'\n    }\n  },\n  overrides: {\n    MuiTypography: {\n      colorPrimary: {\n        // link colors are too dark\n        color: lightPrimary\n      }\n    },\n    MuiButton: {\n      outlinedPrimary: {\n        // outline buttons are too dark\n        color: lightPrimary\n      }\n    }\n  }\n})\n\nexport default theme\n","import light from './themes/light'\nimport dark from './themes/dark'\nimport sav3Light from './themes/sav3-light'\nimport sav3Dark from './themes/sav3-dark'\n\nconst themes = {\n  Light: light,\n  Dark: dark,\n  'SAV3 Light': sav3Light,\n  'SAV3 Dark': sav3Dark\n}\nObject.freeze(themes)\n\nexport default themes\n","import createTheme from '../create-theme'\n\nconst theme = createTheme()\n\nexport default theme\n","import createTheme from '../create-theme'\n\nconst theme = createTheme({\n  palette: {\n    type: 'dark'\n  }\n})\n\nexport default theme\n","import createTheme from '../create-theme'\n\nconst theme = createTheme({\n  palette: {\n    primary: {\n      light: '#7a7380',\n      main: '#4e4854',\n      dark: '#26212b'\n    },\n    secondary: {\n      // grey\n      // main: '#a9a7a8',\n      // blue\n      main: '#484854'\n    }\n  }\n})\n\nexport default theme\n","import {useState, createContext} from 'react'\nimport {ThemeProvider as MuiThemeProvider} from '@material-ui/core/styles'\nimport themes from './index'\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\n\nexport const ThemeContext = createContext({\n  theme: 'Light',\n  setTheme: null\n})\n\nconst ThemeProvider = (props) => {\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)')\n  const defaultThemeName = prefersDarkMode ? 'Dark' : 'Light'\n  let localStorageThemeName = localStorage.getItem('muiTheme') || defaultThemeName\n  if (!themes[localStorageThemeName]) {\n    console.warn(`no available theme for '${localStorageThemeName}'`)\n    localStorageThemeName = defaultThemeName\n  }\n\n  // State to hold the selected theme name\n  const [themeName, _setThemeName] = useState(localStorageThemeName)\n\n  // Retrieve the theme object by theme name\n  const theme = themes[themeName]\n\n  // Wrap _setThemeName to store new theme names in localStorage\n  const setThemeName = (themeName) => {\n    if (!themes[themeName]) {\n      console.warn(`no available theme for '${themeName}'`)\n      return\n    }\n    localStorage.setItem('muiTheme', themeName)\n    _setThemeName(themeName)\n  }\n\n  const contextValue = {\n    theme: themeName,\n    setTheme: setThemeName\n  }\n\n  const {children} = props\n  return (\n    <ThemeContext.Provider value={contextValue}>\n      <MuiThemeProvider theme={theme}>{children}</MuiThemeProvider>\n    </ThemeContext.Provider>\n  )\n}\n\nexport default ThemeProvider\n","import {ThemeContext} from 'src/themes/theme-provider'\nimport {useContext} from 'react'\nimport Select from '@material-ui/core/Select'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport themes from 'src/themes'\n\nfunction ThemeSwitcher () {\n  const {theme, setTheme} = useContext(ThemeContext)\n  const handleThemeChange = (event) => {\n    setTheme(event.target.value)\n  }\n  const themeMenuItems = []\n  for (const themeName in themes) {\n    themeMenuItems.push(\n      <MenuItem key={themeName} value={themeName}>\n        {themeName}\n      </MenuItem>\n    )\n  }\n\n  return (\n    <Select value={theme} onChange={handleThemeChange} label='Theme' variant='outlined'>\n      {themeMenuItems}\n    </Select>\n  )\n}\n\nexport default ThemeSwitcher\n","import {LanguageCodeContext} from 'src/translations/language-code-provider'\nimport {useContext} from 'react'\nimport Select from '@material-ui/core/Select'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport translations from 'src/translations'\n\nfunction TranslationSwitcher () {\n  const {languageCode, setLanguageCode} = useContext(LanguageCodeContext)\n  const handleTranslationChange = (event) => {\n    setLanguageCode(event.target.value)\n  }\n  const translationMenuItems = []\n  for (const translationName in translations) {\n    translationMenuItems.push(\n      <MenuItem key={translationName} value={translationName}>\n        {translationName}\n      </MenuItem>\n    )\n  }\n\n  return (\n    <Select value={languageCode} onChange={handleTranslationChange} label='Translation' variant='outlined'>\n      {translationMenuItems}\n    </Select>\n  )\n}\n\nexport default TranslationSwitcher\n","import {makeStyles} from '@material-ui/core/styles'\nimport Divider from '@material-ui/core/Divider'\nimport MuiAppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\n\nconst useStyles = makeStyles((theme) => ({\n  appBar: {\n    backgroundColor: theme.palette.background.default\n  },\n  // default material ui sticky app bar doesn't stick unless it's at the top of dom\n  // and has a weird shaking bug when scrolling in chrome\n  appBarSticky: {\n    position: 'fixed',\n    left: 'auto',\n    right: 'auto',\n    [theme.breakpoints.up('xs')]: {\n      width: theme.sav3.layout.columns.middle.width.md - theme.sav3.borderWidth * 2\n    },\n    [theme.breakpoints.down('xs')]: {\n      width: `calc(100% - ${theme.sav3.borderWidth * 2}px)`\n    }\n  },\n  // position fixed makes the height 0\n  appBarStickyAfter: {\n    height: theme.sav3.topBar.height + theme.sav3.borderWidth\n  }\n}))\n\nfunction TopBar ({children}) {\n  const classes = useStyles()\n  return (\n    <div>\n      <MuiAppBar position='sticky' color='transparent' elevation={0} classes={{positionSticky: classes.appBarSticky}} className={classes.appBar}>\n        <Toolbar disableGutters>{children}</Toolbar>\n        <Divider />\n      </MuiAppBar>\n      <div className={classes.appBarStickyAfter}></div>\n    </div>\n  )\n}\n\nexport default TopBar\n","import {useContext} from 'react'\nimport {LanguageCodeContext} from './language-code-provider'\n\nconst useLanguageCode = () => {\n  const {languageCode} = useContext(LanguageCodeContext)\n  return languageCode\n}\n\nexport default useLanguageCode\n","import * as localForage from 'localforage'\nimport assert from 'assert'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\n\nclass FollowManager {\n  constructor () {\n    this.followingCache = localForage.createInstance({\n      name: 'followingCache'\n    })\n    this.blockedCache = localForage.createInstance({\n      name: 'blockedCache'\n    })\n  }\n\n  async addFollowing (userCid) {\n    assert(typeof userCid === 'string', `FollowManager.addFollowing invalid userCid '${userCid}'`)\n    await this.deleteBlocked(userCid)\n    await this.followingCache.setItem(userCid, true)\n    sav3Ipfs.setFollowing(await this.getAllFollowing())\n  }\n\n  async isFollowing (userCid) {\n    assert(typeof userCid === 'string', `FollowManager.isFollowing invalid userCid '${userCid}'`)\n    const res = await this.followingCache.getItem(userCid)\n    return !!res\n  }\n\n  async deleteFollowing (userCid) {\n    assert(typeof userCid === 'string', `FollowManager.deleteFollowing invalid userCid '${userCid}'`)\n    await this.followingCache.removeItem(userCid)\n    sav3Ipfs.setFollowing(await this.getAllFollowing())\n  }\n\n  getAllFollowing () {\n    return this.followingCache.keys()\n  }\n\n  async setAllFollowing (userCids) {\n    assert(Array.isArray(userCids), `FollowManager.setAllFollowing invalid userCids '${userCids}'`)\n    await this.followingCache.clear()\n    for (const userCid of userCids) {\n      await this.addFollowing(userCid)\n    }\n    sav3Ipfs.setFollowing(await this.getAllFollowing())\n  }\n\n  async addBlocked (userCid) {\n    assert(typeof userCid === 'string', `FollowManager.addBlocked invalid userCid '${userCid}'`)\n    await this.deleteFollowing(userCid)\n    await this.blockedCache.setItem(userCid, true)\n  }\n\n  async isBlocked (userCid) {\n    assert(typeof userCid === 'string', `FollowManager.isBlocked invalid userCid '${userCid}'`)\n    const res = await this.blockedCache.getItem(userCid)\n    return !!res\n  }\n\n  async deleteBlocked (userCid) {\n    assert(typeof userCid === 'string', `FollowManager.deleteBlocked invalid userCid '${userCid}'`)\n    await this.blockedCache.removeItem(userCid)\n  }\n\n  getAllBlocked () {\n    return this.blockedCache.keys()\n  }\n\n  async setAllBlocked (userCids) {\n    assert(Array.isArray(userCids), `FollowManager.setAllBlocked invalid userCids '${userCids}'`)\n    await this.blockedCache.clear()\n    for (const userCid of userCids) {\n      await this.addBlocked(userCid)\n    }\n  }\n}\n\n// export a singleton to be used throughout the app\nconst followManager = new FollowManager()\nexport default followManager\n\n// for testing\nwindow.followManager = followManager\n","import {createContext, useState, useEffect} from 'react'\nimport followManager from 'src/lib/follow-manager'\nimport assert from 'assert'\n\nexport const FollowingContext = createContext()\n\nconst FollowingProvider = (props) => {\n  // get initial following/blocked cids from cache\n  const [following, setFollowing] = useState({})\n  const [blocked, setBlocked] = useState({})\n  useEffect(() => {\n    ;(async () => {\n      const following = await followManager.getAllFollowing()\n      const blocked = await followManager.getAllBlocked()\n      const followingObject = {}\n      for (const userCid of following) {\n        followingObject[userCid] = true\n      }\n      setFollowing(followingObject)\n      const blockedObject = {}\n      for (const userCid of blocked) {\n        blockedObject[userCid] = true\n      }\n      setBlocked(blockedObject)\n    })()\n  }, [])\n\n  const addFollowing = (userCid) => {\n    assert(typeof userCid === 'string', `FollowingProvider.addFollowing invalid userCid '${userCid}'`)\n    followManager.addFollowing(userCid)\n    setFollowing((prevFollowing) => ({\n      ...prevFollowing,\n      [userCid]: true\n    }))\n  }\n\n  const deleteFollowing = (userCid) => {\n    assert(typeof userCid === 'string', `FollowingProvider.deleteFollowing invalid userCid '${userCid}'`)\n    followManager.deleteFollowing(userCid)\n    setFollowing((prevFollowing) => ({\n      ...prevFollowing,\n      [userCid]: false\n    }))\n  }\n\n  const setAllFollowing = (userCids) => {\n    assert(Array.isArray(userCids), `FollowingProvider.setAllFollowing invalid userCids '${userCids}'`)\n    followManager.setAllFollowing(userCids)\n    const userCidsObject = {}\n    for (const userCid of userCids) {\n      userCidsObject[userCid] = true\n    }\n    setFollowing(userCidsObject)\n  }\n\n  const addBlocked = (userCid) => {\n    assert(typeof userCid === 'string', `FollowingProvider.addBlocked invalid userCid '${userCid}'`)\n    followManager.addBlocked(userCid)\n    setBlocked((prevBlocked) => ({\n      ...prevBlocked,\n      [userCid]: true\n    }))\n  }\n\n  const deleteBlocked = (userCid) => {\n    assert(typeof userCid === 'string', `FollowingProvider.deleteBlocked invalid userCid '${userCid}'`)\n    followManager.deleteBlocked(userCid)\n    setBlocked((prevBlocked) => ({\n      ...prevBlocked,\n      [userCid]: false\n    }))\n  }\n\n  const setAllBlocked = (userCids) => {\n    assert(Array.isArray(userCids), `FollowingProvider.setAllBlocked invalid userCids '${userCids}'`)\n    followManager.setAllBlocked(userCids)\n    const userCidsObject = {}\n    for (const userCid of userCids) {\n      userCidsObject[userCid] = true\n    }\n    setBlocked(userCidsObject)\n  }\n\n  const contextValue = {\n    following,\n    addFollowing,\n    deleteFollowing,\n    setAllFollowing,\n    blocked,\n    addBlocked,\n    deleteBlocked,\n    setAllBlocked\n  }\n\n  const {children} = props\n  return <FollowingContext.Provider value={contextValue}>{children}</FollowingContext.Provider>\n}\n\nexport default FollowingProvider\n","import {useContext, useCallback} from 'react'\nimport {FollowingContext} from './following-provider'\nimport assert from 'assert'\n\nconst useIsFollowing = (userCid) => {\n  assert(!userCid || typeof userCid === 'string', `useIsFollowing invalid userCid '${userCid}'`)\n  const {following, addFollowing, deleteFollowing} = useContext(FollowingContext)\n  const isFollowing = !!following[userCid]\n\n  const setIsFollowing = useCallback(\n    (value) => {\n      if (!userCid) {\n        return\n      }\n      assert(typeof value === 'boolean', `setIsFollowing invalid value '${value}' not a boolean`)\n      if (value === true) {\n        addFollowing(userCid)\n      }\n      if (value === false) {\n        deleteFollowing(userCid)\n      }\n    },\n    [userCid]\n  )\n\n  if (!userCid) {\n    return [undefined, setIsFollowing]\n  }\n  return [isFollowing, setIsFollowing]\n}\n\nexport default useIsFollowing\n","import {useState} from 'react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport PersonAdd from '@material-ui/icons/PersonAdd'\nimport PersonAddDisabled from '@material-ui/icons/PersonAddDisabled'\nimport {makeStyles} from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport PropTypes from 'prop-types'\nimport useIsFollowing from 'src/hooks/following/use-is-following'\nimport useTranslation from 'src/translations/use-translation'\nimport Box from '@material-ui/core/Box'\nimport useOwnUserCid from 'src/hooks/use-own-user-cid'\n\nconst useStyles = makeStyles((theme) => ({\n  menu: {\n    '& .MuiPaper-rounded': {\n      borderRadius: theme.sav3.popoverMenu.borderRadius\n    }\n  },\n  menuItemIcon: {\n    minWidth: 28\n  },\n  moreIconButton: {\n    padding: theme.spacing(0.5),\n    '& .MuiSvgIcon-root': {\n      fontSize: '1.2rem'\n    }\n  }\n}))\n\nfunction PostMoreMenu ({post} = {}) {\n  const classes = useStyles()\n  const [anchorEl, setAnchorEl] = useState(null)\n  const ownCid = useOwnUserCid()\n\n  if (post.userCid === ownCid) {\n    // currently no more menu for own posts\n    // return empty element same size as more button\n    return <Box height={48} width={48} />\n  }\n\n  const handleClick = (event) => {\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleClose = () => {\n    setAnchorEl(null)\n  }\n\n  return (\n    <div onClick={(event) => event.stopPropagation()}>\n      <IconButton className={classes.moreIconButton} onClick={handleClick}>\n        <MoreVertIcon />\n      </IconButton>\n      <Menu\n        className={classes.menu}\n        elevation={4}\n        anchorOrigin={{\n          vertical: 'top',\n          horizontal: 'right'\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'right'\n        }}\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={handleClose}\n      >\n        <FollowMenuItem userCid={post.userCid} />\n      </Menu>\n    </div>\n  )\n}\n\nPostMoreMenu.propTypes = {\n  post: PropTypes.object.isRequired\n}\n\nfunction FollowMenuItem ({userCid} = {}) {\n  const classes = useStyles()\n  const t = useTranslation()\n  const [isFollowing, setIsFollowing] = useIsFollowing(userCid)\n\n  let followButton = (\n    <MenuItem onClick={() => setIsFollowing(true)}>\n      <ListItemIcon className={classes.menuItemIcon}>\n        <PersonAdd fontSize='small' />\n      </ListItemIcon>\n      <Typography>{t.Follow()}</Typography>\n    </MenuItem>\n  )\n  if (isFollowing) {\n    followButton = (\n      <MenuItem onClick={() => setIsFollowing(false)}>\n        <ListItemIcon className={classes.menuItemIcon}>\n          <PersonAddDisabled fontSize='small' />\n        </ListItemIcon>\n        <Typography>{t.Unfollow()}</Typography>\n      </MenuItem>\n    )\n  }\n  return followButton\n}\n\nFollowMenuItem.propTypes = {\n  userCid: PropTypes.string.isRequired\n}\n\nexport default PostMoreMenu\n","import assert from 'assert'\nimport config from 'src/config'\n\nconst timeToLive = config.urlTimeToLive\nassert(typeof timeToLive === 'number', `invalid permalink time to live '${timeToLive}'`)\n\nexport const decodeCid = (encodedCid) => {\n  assert(encodedCid && typeof encodedCid === 'string', `utils.url.decodeCid encodedCid '${encodedCid}' not a string`)\n  let cid, expireTimestamp\n  try {\n    const object = JSON.parse(window.atob(encodedCid))\n    cid = object.c\n    expireTimestamp = object.e\n  }\n  catch (e) {\n    throw Error(`failed decoding cid: ${e.message}`)\n  }\n\n  if (expireTimestamp * 1000 < Date.now()) {\n    throw Error(`encoded cid '${cid}' expired ${new Date(expireTimestamp * 1000)}`)\n  }\n  if (expireTimestamp * 1000 - timeToLive >= Date.now()) {\n    throw Error(`encoded cid '${cid}' too early '${new Date(expireTimestamp * 1000)}' '${new Date()}'`)\n  }\n  return cid\n}\n\nexport const encodeCid = (cid) => {\n  assert(cid && typeof cid === 'string', `utils.url.encodeCid cid '${cid}' not a string`)\n  const expireTimestamp = Math.round((Date.now() + timeToLive) / 1000)\n  return window.btoa(JSON.stringify({c: cid, e: expireTimestamp})).replace(/=/g, '')\n}\n\nexport const encodedCidIsExpired = (encodedCid) => {\n  try {\n    decodeCid(encodedCid)\n    return false\n  }\n  catch (e) {\n    return true\n  }\n}\n\nexport default {\n  decodeCid,\n  encodeCid,\n  encodedCidIsExpired\n}\n","import {useEffect, useRef} from 'react'\n\nconst noop = () => {}\n\nexport function useInterval (callback, delay, immediate = true) {\n  const savedCallback = useRef(noop)\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback\n  })\n\n  // Execute callback if immediate is set.\n  useEffect(() => {\n    if (!immediate) return\n    if (delay === null || delay === false) return\n    savedCallback.current()\n  }, [immediate])\n\n  // Set up the interval.\n  useEffect(() => {\n    if (delay === null || delay === false) return undefined\n    const tick = () => savedCallback.current()\n    const id = setInterval(tick, delay)\n    return () => clearInterval(id)\n  }, [delay])\n}\n\nexport default useInterval\n","import {useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport useInterval from 'src/hooks/utils/use-interval'\n\nconst usePostRepliesCids = (postCid) => {\n  assert(!postCid || typeof postCid === 'string', `invalid postCid '${JSON.stringify(postCid)}'`)\n  const [repliesCids, setRepliesCids] = useState([])\n\n  useInterval(() => {\n    if (!postCid) {\n      // don't trigger rerender if already empty\n      if (repliesCids.length !== 0) {\n        setRepliesCids([])\n      }\n      return\n    }\n    ;(async () => {\n      const res = await sav3Ipfs.getPostRepliesCids(postCid)\n      // don't trigger rerender if is same array\n      if (JSON.stringify(res) === JSON.stringify(repliesCids)) {\n        return\n      }\n      setRepliesCids(res)\n    })()\n  }, 1000)\n\n  return repliesCids\n}\n\nexport default usePostRepliesCids\n","import copy from 'copy-to-clipboard'\nimport {useCallback, useEffect, useState} from 'react'\n\nexport default function useCopyClipboard (timeout = 500) {\n  const [isCopied, setIsCopied] = useState(false)\n\n  const staticCopy = useCallback((text) => {\n    const didCopy = copy(text)\n    setIsCopied(didCopy)\n  }, [])\n\n  useEffect(() => {\n    if (isCopied) {\n      const hide = setTimeout(() => {\n        setIsCopied(false)\n      }, timeout)\n\n      return () => {\n        clearTimeout(hide)\n      }\n    }\n    return undefined\n  }, [isCopied, setIsCopied, timeout])\n\n  return [isCopied, staticCopy]\n}\n","import assert from 'assert'\n\nexport const setRgbaAlpha = (rgbaString, alpha) => {\n  assert(typeof rgbaString === 'string', `themesUtils.setRgbaAlpha invalid rgbaString '${rgbaString}'`)\n  assert(typeof alpha === 'string' || typeof alpha === 'number', `themesUtils.setRgbaAlpha invalid alpha '${alpha}'`)\n  const [r, g, b] = rgbaString.match(/[\\d.]+/g)\n  return `rgba(${r}, ${g}, ${b}, ${alpha.toFixed(3)})`\n}\n\nexport const scaleRgbaAlpha = (rgbaString, scaleFactor) => {\n  assert(typeof rgbaString === 'string', `themesUtils.scaleRgbaAlpha invalid rgbaString '${rgbaString}'`)\n  assert(typeof scaleFactor === 'string' || typeof scaleFactor === 'number', `themesUtils.scaleRgbaAlpha invalid alpha '${scaleFactor}'`)\n  const [r, g, b, a] = rgbaString.match(/[\\d.]+/g)\n  return `rgba(${r}, ${g}, ${b}, ${(a * scaleFactor).toFixed(3)})`\n}\n\nexport default {\n  setRgbaAlpha,\n  scaleRgbaAlpha\n}\n","import {Fragment, useEffect, useState} from 'react'\nimport {makeStyles} from '@material-ui/core/styles'\nimport Card from '@material-ui/core/Card'\nimport CardMedia from '@material-ui/core/CardMedia'\nimport Avatar from '@material-ui/core/Avatar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\nimport FavoriteIcon from '@material-ui/icons/FavoriteBorderOutlined'\nimport ShareIcon from '@material-ui/icons/ShareOutlined'\nimport RepeatIcon from '@material-ui/icons/Repeat'\nimport CommentIcon from '@material-ui/icons/ModeCommentOutlined'\nimport Link from '@material-ui/core/Link'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Box from '@material-ui/core/Box'\nimport {format as formatTimeAgo} from 'timeago.js'\nimport useLanguageCode from 'src/translations/use-language-code'\nimport assert from 'assert'\nimport urlRegex from 'url-regex'\nimport PostMoreMenu from './more-menu'\nimport {Link as RouterLink, useHistory, useLocation} from 'react-router-dom'\nimport PublishPostModal from 'src/components/publish-post/modal'\nimport PropTypes from 'prop-types'\nimport urlUtils from 'src/lib/utils/url'\nimport usePostRepliesCids from 'src/hooks/use-post-replies-cids'\nimport useCopyClipboard from 'src/hooks/utils/use-copy-clipboard'\nimport useTranslation from 'src/translations/use-translation'\nimport themesUtils from 'src/themes/utils'\n\nconst useStyles = makeStyles((theme) => ({\n  imgMedia: {\n    height: 0,\n    paddingTop: '56.25%' // 16:9\n  },\n  avatar: {\n    // slightly higher placement than the user name seems more pleasing\n    marginTop: theme.spacing(-0.25),\n    width: theme.spacing(6),\n    height: theme.spacing(6),\n    // borders\n    borderWidth: theme.sav3.borderWidth,\n    borderStyle: 'solid',\n    borderColor: theme.sav3.borderColor\n  },\n  userCid: {\n    wordBreak: 'break-all',\n    // remove added styles from link component\n    textDecoration: 'inherit'\n  },\n  displayName: {\n    // remove added styles from link component\n    color: 'inherit',\n    textDecoration: 'inherit'\n  },\n  contentLink: {\n    wordBreak: 'break-all'\n  },\n  actions: {\n    paddingTop: theme.spacing(0.5),\n    maxWidth: theme.sav3.layout.columns.middle.width.md * 0.75,\n    marginLeft: theme.spacing(-1)\n  },\n  actionIconButton: {\n    padding: theme.spacing(1),\n    '& .MuiSvgIcon-root': {\n      fontSize: '1rem',\n      color: theme.palette.text.secondary\n    }\n  },\n  post: {\n    cursor: 'pointer',\n    '&:hover': {\n      backgroundColor: themesUtils.scaleRgbaAlpha(theme.palette.action.hover, 0.4)\n    },\n    // prevent mobile highlight entire post when clicking inner elements\n    tapHighlightColor: 'rgba(0, 0, 0, 0)',\n    userSelect: 'none'\n  }\n}))\n\nfunction Post ({post} = {}) {\n  const location = useLocation()\n  const history = useHistory()\n  const languageCode = useLanguageCode()\n  const classes = useStyles()\n  const date = useDate(post.timestamp, languageCode)\n\n  const encodedUserCid = urlUtils.encodeCid(post.userCid)\n  const userProfileUrl = `/profile/${encodedUserCid}`\n\n  const encodedPostCid = urlUtils.encodeCid(post.cid)\n  const postUrl = `/post/${encodedPostCid}`\n  const navigateToPostUrl = (event) => {\n    // don't handle buttons and links\n    if (!event.target.tagName.match(/DIV|P/)) {\n      return\n    }\n\n    // dont click if already on the same post cid\n    const [, route, encodedCid] = location.pathname.split('/')\n    if (route === 'post') {\n      try {\n        const currentUrlPostCid = urlUtils.decodeCid(encodedCid)\n        if (currentUrlPostCid === post.cid) {\n          return\n        }\n      }\n      catch (e) {}\n    }\n\n    history.push(postUrl)\n  }\n\n  return (\n    <Box px={2} pt={1.5} pb={0.5} display='flex' className={classes.post} onClick={navigateToPostUrl}>\n      {/* left col avatar */}\n      <Box pr={1.5}>\n        <Avatar component={RouterLink} to={userProfileUrl} src={post.profile.thumbnailUrl && forceHttps(post.profile.thumbnailUrl)} className={classes.avatar} />\n      </Box>\n\n      {/* right col header + content + bottom actions */}\n      <Box width='100%'>\n        {/* header */}\n        <Box display='flex'>\n          <Box flexGrow={1}>\n            <Box display='flex'>\n              {post.profile.displayName && (\n                <Fragment>\n                  <Typography className={classes.displayName} component={RouterLink} to={userProfileUrl} variant='subtitle2'>\n                    {post.profile.displayName}\n                  </Typography>\n                  &nbsp;\n                  <Typography variant='subtitle2'>·</Typography>\n                  &nbsp;\n                </Fragment>\n              )}\n              <Typography variant='subtitle2'>{date}</Typography>\n            </Box>\n            <Box>\n              <Typography component={RouterLink} to={userProfileUrl} variant='caption' color='textSecondary' className={classes.userCid}>\n                {post.userCid}\n              </Typography>\n            </Box>\n          </Box>\n          <Box>\n            <PostMoreMenu post={post} />\n          </Box>\n        </Box>\n\n        {/* content */}\n        <PostContent content={post.content} />\n\n        {/* actions */}\n        <Box display='flex' justifyContent='space-between' className={classes.actions}>\n          <ReplyIconButton parentPost={post} />\n          <IconButton className={classes.actionIconButton}>\n            <RepeatIcon style={{transform: 'rotate(90deg)'}} />\n          </IconButton>\n          <IconButton className={classes.actionIconButton}>\n            <FavoriteIcon />\n          </IconButton>\n          <ShareButton postCid={post.cid} />\n        </Box>\n      </Box>\n    </Box>\n  )\n}\n\nfunction ReplyIconButton ({parentPost} = {}) {\n  const classes = useStyles()\n  const postRepliesCids = usePostRepliesCids(parentPost.cid)\n\n  const [openPublishPostModal, setOpenPublishPostModal] = useState(false)\n  return (\n    <Box display='flex' alignItems='center' onClick={(event) => event.stopPropagation()}>\n      <IconButton className={classes.actionIconButton} onClick={() => setOpenPublishPostModal(true)}>\n        <CommentIcon />\n      </IconButton>\n      {postRepliesCids.length !== 0 && <Typography variant='caption'>{postRepliesCids.length}</Typography>}\n      <PublishPostModal parentPost={parentPost} open={openPublishPostModal} onClose={() => setOpenPublishPostModal(false)} />\n    </Box>\n  )\n}\nReplyIconButton.propTypes = {parentPost: PropTypes.object.isRequired}\n\nfunction ShareButton ({postCid} = {}) {\n  const classes = useStyles()\n  const t = useTranslation()\n  const [isCopied, setCopied] = useCopyClipboard(1100)\n  const getUrl = () => {\n    const encodedPostCid = urlUtils.encodeCid(postCid)\n    return `${window.location.origin}/#/post/${encodedPostCid}`\n  }\n  return (\n    <Tooltip title={t['Copied to clipboard']()} open={isCopied} enterDelay={500} leaveDelay={200}>\n      <IconButton onClick={() => setCopied(getUrl())} className={classes.actionIconButton}>\n        <ShareIcon />\n      </IconButton>\n    </Tooltip>\n  )\n}\nShareButton.propTypes = {postCid: PropTypes.string.isRequired}\n\nfunction PostContent ({content} = {}) {\n  const classes = useStyles()\n  let contentComponents = [content]\n\n  const link = getPostContentLink(content)\n  if (link) {\n    const [contentPart1, contentPart2] = content.split(link)\n    let href = link\n    if (!link.match(/^https?:\\/\\//)) {\n      href = `https://${link}`\n    }\n    contentComponents = []\n    if (contentPart1) {\n      contentComponents.push(contentPart1)\n    }\n    contentComponents.push(\n      <Link className={classes.contentLink} key='content link' variant='body2' href={href} target='_blank' rel='noopener'>\n        {link}\n      </Link>\n    )\n    if (contentPart2) {\n      contentComponents.push(contentPart2)\n    }\n  }\n\n  const mediaSrc = getPostContentMediaSrc(content)\n  let cardMedia\n  if (mediaSrc) {\n    cardMedia = <CardMedia className={classes.imgMedia} image={mediaSrc} />\n    if (linkIsVideo(mediaSrc)) {\n      cardMedia = <CardMedia controls autoPlay muted component='video' image={mediaSrc} />\n    }\n  }\n\n  const media = mediaSrc && (\n    <Box pt={1}>\n      <Card variant='outlined'>{cardMedia}</Card>\n    </Box>\n  )\n\n  return (\n    <Box>\n      <Typography variant='body2'>{contentComponents}</Typography>\n      {media}\n    </Box>\n  )\n}\nPostContent.propTypes = {content: PropTypes.string.isRequired}\n\n// only use the first link in a post\nconst getPostContentLink = (content) => {\n  if (!content) {\n    return\n  }\n  assert(typeof content === 'string', `post content '${content}' is not a string`)\n  const links = content.match(urlRegex({strict: false}))\n  return links && links[0]\n}\n\nconst getPostContentMediaSrc = (content) => {\n  if (!content) {\n    return\n  }\n  assert(typeof content === 'string', `post content '${content}' is not a string`)\n  const links = content.match(urlRegex({strict: false}))\n  let link = links && links[0]\n  if (!link) {\n    return\n  }\n  link = forceHttps(link)\n  if (linkIsMedia(link)) {\n    // add protocol if missing\n    if (!link.match(/^https?:\\/\\//)) {\n      link = `https://${link}`\n    }\n    return link\n  }\n}\n\nconst forceHttps = (link) => {\n  assert(typeof link === 'string', `forceHttps link '${link}' not a string`)\n  link = link.trim()\n  link = link.replace(/^http:\\/\\//, 'https://')\n  return link\n}\n\nconst linkIsVideo = (link) => {\n  // remove query string and match extension\n  return link.replace(/[#?].*/).match(/\\.(mp4|webm)$/)\n}\n\nconst linkIsMedia = (link) => {\n  // remove query string and match extension\n  return link.replace(/[#?].*/).match(/\\.(jpeg|jpg|png|gif|mp4|webm)$/)\n}\n\nconst useDate = (timestamp, languageCode) => {\n  const [date, setDate] = useState()\n  useEffect(() => {\n    const date = formatDate(timestamp, languageCode)\n    setDate(date)\n  }, [timestamp, languageCode])\n\n  return date\n}\n\nconst formatDate = (postTimestamp, languageCode) => {\n  const day = 1000 * 60 * 60 * 24\n  const year = 365 * day\n  const timestamp = postTimestamp * 1000\n  let date = new Date(timestamp).toLocaleString(languageCode, {month: 'short', day: 'numeric'})\n  if (Date.now() > timestamp + year) {\n    date = new Date(timestamp).toLocaleString(languageCode, {year: 'numeric', month: 'short', day: 'numeric'})\n  }\n  if (Date.now() < timestamp + day) {\n    date = formatTimeAgo(timestamp, languageCode)\n  }\n  return date\n}\n\nexport default Post\n","import React from 'react'\nimport Post from 'src/components/post'\nimport Divider from '@material-ui/core/Divider'\nimport PropTypes from 'prop-types'\nimport InfiniteScroll from 'react-infinite-scroll-component'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport Box from '@material-ui/core/Box'\n\nfunction PostsFeed ({posts, next, hasMore} = {}) {\n  const postComponents = []\n\n  for (const post of posts) {\n    postComponents.push(\n      <div key={post.contentCid + post.timestamp}>\n        <Post post={post} />\n        <Divider />\n      </div>\n    )\n  }\n\n  return (\n    <InfiniteScroll\n      dataLength={postComponents.length}\n      // scrollThreshold='400px'\n      next={next}\n      hasMore={hasMore}\n      loader={\n        <Box width='100%' p={2} justifyContent='center' display='flex' style={{overflow: 'hidden'}}>\n          <CircularProgress size={24} />\n        </Box>\n      }\n    >\n      {postComponents}\n    </InfiniteScroll>\n  )\n}\n\nPostsFeed.propTypes = {\n  posts: PropTypes.array.isRequired,\n  next: PropTypes.func.isRequired,\n  hasMore: PropTypes.bool.isRequired\n}\n\nexport default PostsFeed\n","import Typography from '@material-ui/core/Typography'\nimport Link from '@material-ui/core/Link'\nimport assert from 'assert'\nimport urlRegex from 'url-regex'\nimport PropTypes from 'prop-types'\n\nfunction Description ({description} = {}) {\n  let descriptionComponents = [description]\n\n  const link = getContentLink(description)\n  if (link) {\n    const [descriptionPart1, descriptionPart2] = description.split(link)\n    let href = link\n    if (!link.match(/$https?:\\/\\//)) {\n      href = `https://${link}`\n    }\n    descriptionComponents = []\n    if (descriptionPart1) {\n      descriptionComponents.push(descriptionPart1)\n    }\n    descriptionComponents.push(\n      <Link variant='body2' href={href} target='_blank' rel='noopener'>\n        {link}\n      </Link>\n    )\n    if (descriptionPart2) {\n      descriptionComponents.push(descriptionPart2)\n    }\n  }\n\n  return <Typography variant='body2'>{descriptionComponents}</Typography>\n}\n\nDescription.propTypes = {\n  description: PropTypes.string.isRequired\n}\n\n// only use the first link in a description\nconst getContentLink = (description) => {\n  if (!description) {\n    return\n  }\n  assert(typeof description === 'string', `user description '${description}' is not a string`)\n  const links = description.match(urlRegex({strict: false}))\n  return links && links[0]\n}\n\nexport default Description\n","import {useState, useEffect} from 'react'\nimport Button from '@material-ui/core/Button'\nimport TextField from '@material-ui/core/TextField'\nimport Box from '@material-ui/core/Box'\nimport useTranslation from 'src/translations/use-translation'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport PropTypes from 'prop-types'\nimport Alert from '@material-ui/lab/Alert'\nimport {makeStyles} from '@material-ui/core/styles'\nimport Modal from 'src/components/modal'\n\nconst useStyles = makeStyles((theme) => ({\n  errorMessage: {\n    overflow: 'hidden'\n  },\n  description: {\n    '& textarea': {\n      overflow: 'hidden'\n    }\n  },\n  content: {\n    '& input': {\n      padding: theme.spacing(2),\n      paddingLeft: theme.spacing(2.5),\n      paddingRight: theme.spacing(2.5)\n    },\n    '& label[data-shrink=\"false\"]': {\n      transform: 'translate(20px, 18px) scale(1)'\n    },\n    '& textarea': {\n      paddingTop: theme.spacing(1),\n      paddingBottom: theme.spacing(1),\n      paddingLeft: theme.spacing(0.5),\n      paddingRight: theme.spacing(0.5)\n    },\n    // text fields borders are too opaque\n    '& fieldset': {\n      opacity: 0.25\n    },\n    '& .Mui-focused fieldset': {\n      opacity: 1\n    }\n  }\n}))\n\nfunction EditProfileModal ({open, onClose, previousProfile}) {\n  const t = useTranslation()\n  const classes = useStyles()\n  const [profile, setProfile] = useState(previousProfile)\n  const [errorMessage, setErrorMessage] = useState()\n\n  // set previous profile once\n  useEffect(() => {\n    setProfile(previousProfile)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [JSON.stringify(previousProfile)])\n\n  const handleChange = (event) => {\n    const {id, value} = event.target\n    const newProfile = {...profile, [id]: value}\n    setProfile(newProfile)\n  }\n\n  const handlePublish = async () => {\n    try {\n      await sav3Ipfs.editUserProfile(profile)\n      setErrorMessage(null)\n      onClose()\n    }\n    catch (e) {\n      setErrorMessage(e.message)\n    }\n  }\n\n  const content = (\n    <Box pt={1} pb={1.5} className={classes.content}>\n      <TextField onChange={handleChange} autoFocus margin='dense' id='displayName' label={t['Display name']()} fullWidth variant='outlined' value={profile.displayName || ''} />\n      <TextField onChange={handleChange} margin='dense' id='thumbnailUrl' label={t['Thumbnail URL']()} fullWidth variant='outlined' value={profile.thumbnailUrl || ''} />\n      <TextField onChange={handleChange} margin='dense' id='bannerUrl' label={t['Banner URL']()} fullWidth variant='outlined' value={profile.bannerUrl || ''} />\n      <TextField\n        className={classes.description}\n        onChange={handleChange}\n        margin='dense'\n        id='description'\n        label={t.Description()}\n        fullWidth\n        multiline\n        rows={4}\n        variant='outlined'\n        value={profile.description || ''}\n      />\n      {errorMessage && (\n        <Alert classes={{message: classes.errorMessage}} severity='error'>\n          {errorMessage}\n        </Alert>\n      )}\n    </Box>\n  )\n\n  const actions = (\n    <div>\n      <Button disableElevation variant='contained' onClick={handlePublish} color='primary'>\n        SAV3\n      </Button>\n    </div>\n  )\n\n  return <Modal open={open} onClose={onClose} content={content} actions={actions} />\n}\n\nEditProfileModal.propTypes = {\n  open: PropTypes.bool.isRequired,\n  onClose: PropTypes.func.isRequired,\n  previousProfile: PropTypes.object.isRequired\n}\n\nexport default EditProfileModal\n","import {useState} from 'react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport {makeStyles} from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport PropTypes from 'prop-types'\nimport useTranslation from 'src/translations/use-translation'\nimport ShareIcon from '@material-ui/icons/ShareOutlined'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport urlUtils from 'src/lib/utils/url'\nimport useCopyClipboard from 'src/hooks/utils/use-copy-clipboard'\n\nconst useStyles = makeStyles((theme) => ({\n  menu: {\n    '& .MuiPaper-rounded': {\n      borderRadius: theme.sav3.popoverMenu.borderRadius\n    }\n  },\n  menuItemIcon: {\n    minWidth: 28\n  },\n  moreIconButton: {\n    padding: theme.spacing(1.25)\n  }\n}))\n\nfunction ProfileMoreMenu ({userCid} = {}) {\n  const classes = useStyles()\n  const [anchorEl, setAnchorEl] = useState(null)\n\n  const handleClick = (event) => {\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleClose = () => {\n    setAnchorEl(null)\n  }\n\n  return (\n    <div>\n      <IconButton className={classes.moreIconButton} onClick={handleClick}>\n        <MoreVertIcon />\n      </IconButton>\n      <Menu\n        className={classes.menu}\n        elevation={4}\n        anchorOrigin={{\n          vertical: 'top',\n          horizontal: 'right'\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'right'\n        }}\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={handleClose}\n      >\n        <ShareMenuItem userCid={userCid} onClose={handleClose} />\n      </Menu>\n    </div>\n  )\n}\n\nProfileMoreMenu.propTypes = {\n  userCid: PropTypes.string.isRequired\n}\n\nfunction ShareMenuItem ({userCid, onClose} = {}) {\n  const classes = useStyles()\n  const t = useTranslation()\n\n  const [isCopied, setCopied] = useCopyClipboard(1100)\n  const getUrl = () => {\n    const encodedPostCid = urlUtils.encodeCid(userCid)\n    return `${window.location.origin}/#/profile/${encodedPostCid}`\n  }\n\n  const handleClick = () => {\n    setCopied(getUrl())\n    if (onClose) {\n      onClose()\n    }\n  }\n\n  return (\n    <Tooltip title={t['Copied to clipboard']()} open={isCopied} enterDelay={500} leaveDelay={200}>\n      <MenuItem onClick={handleClick}>\n        <ListItemIcon className={classes.menuItemIcon}>\n          <ShareIcon fontSize='small' />\n        </ListItemIcon>\n        <Typography>{t.Share()}</Typography>\n      </MenuItem>\n    </Tooltip>\n  )\n}\n\nShareMenuItem.propTypes = {\n  userCid: PropTypes.string.isRequired,\n  onClose: PropTypes.func\n}\n\nexport default ProfileMoreMenu\n","import {useEffect, useRef} from 'react'\n\nfunction usePrevious (value) {\n  // The ref object is a generic container whose current property is mutable ...\n  // ... and can hold any value, similar to an instance property on a class\n  const ref = useRef()\n\n  // Store current value in ref\n  useEffect(() => {\n    ref.current = value\n  }, [value]) // Only re-run if value changes\n\n  // Return previous value (happens before update in useEffect above)\n  return ref.current\n}\n\nexport default usePrevious\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport useUserIpnsContent from 'src/hooks/use-user-ipns-content'\nimport usePrevious from 'src/hooks/utils/use-previous'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-user-post-cids')\n\nconst useUserPostCids = (userCid) => {\n  assert(!userCid || typeof userCid === 'string', `invalid userCid '${JSON.stringify(userCid)}'`)\n  const userIpnsContent = useUserIpnsContent(userCid)\n  const lastPostCid = userIpnsContent && userIpnsContent.lastPostCid\n\n  const [userPostCids, setUserPostCids] = useState([])\n\n  debug({userIpnsContent, lastPostCid, userPostCids})\n\n  const previousUserCid = usePrevious(userCid)\n  const userCidChanged = previousUserCid && previousUserCid !== userCid\n\n  useEffect(() => {\n    if (!lastPostCid || userCidChanged) {\n      if (userPostCids.length) {\n        setUserPostCids([])\n      }\n      return\n    }\n\n    let limit = 100\n    let isMounted = true\n    ;(async () => {\n      for await (const postCid of sav3Ipfs.getPreviousPostCids(lastPostCid)) {\n        if (!isMounted) {\n          return\n        }\n\n        // if lastPostCid changes and triggers refresh\n        if (userPostCids.includes(postCid)) {\n          continue\n        }\n\n        setUserPostCids((previousUserPostCids) => [...previousUserPostCids, postCid])\n\n        if (!limit--) {\n          return\n        }\n      }\n    })()\n\n    return () => {\n      isMounted = false\n    }\n  }, [lastPostCid, userCid])\n\n  return userPostCids\n}\n\nexport default useUserPostCids\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-posts')\n\nconst usePosts = (postCids) => {\n  assert(Array.isArray(postCids), `invalid postCids '${JSON.stringify(postCids)}'`)\n  const defaultPosts = {}\n  const [posts, setPosts] = useState(defaultPosts)\n  debug({postCids, posts})\n\n  useEffect(() => {\n    // dont reset to default on profile cids change because\n    // even if extra profiles are kept it doesn't affect\n    // any functionalities yet\n\n    if (!postCids.length) {\n      if (JSON.stringify(posts) !== JSON.stringify(defaultPosts)) {\n        setPosts(defaultPosts)\n      }\n      return\n    }\n    for (const postCid of postCids) {\n      if (!postCid || typeof postCid !== 'string') {\n        continue\n      }\n\n      sav3Ipfs.getPost(postCid).then((post) => {\n        setPosts((previousPosts) => ({\n          ...previousPosts,\n          [postCid]: post\n        }))\n      })\n    }\n  }, [JSON.stringify(postCids)])\n\n  return posts\n}\n\nexport default usePosts\n","import {useState} from 'react'\nimport {makeStyles} from '@material-ui/core/styles'\nimport CardHeader from '@material-ui/core/CardHeader'\nimport CardMedia from '@material-ui/core/CardMedia'\nimport Avatar from '@material-ui/core/Avatar'\nimport useTranslation from 'src/translations/use-translation'\nimport Button from '@material-ui/core/Button'\nimport Box from '@material-ui/core/Box'\nimport PostsFeed from 'src/components/feeds/posts'\nimport useOwnUserCid from 'src/hooks/use-own-user-cid'\nimport useUserProfile from 'src/hooks/use-user-profile'\nimport PropTypes from 'prop-types'\nimport Description from './description'\nimport EditProfileModal from './edit-profile-modal'\nimport assert from 'assert'\nimport Divider from '@material-ui/core/Divider'\nimport useIsFollowing from 'src/hooks/following/use-is-following'\nimport MoreMenuButton from './more-menu'\nimport useUserPostCids from 'src/hooks/use-user-post-cids'\nimport usePosts from 'src/hooks/use-posts'\nimport Debug from 'debug'\nconst debug = Debug('sav3:views:profile')\n\nconst emptyImage = 'data:image/png;base64,'\n\nconst useStyles = makeStyles((theme) => ({\n  banner: {\n    paddingTop: '33.25%' // approximately 200px height\n  },\n  avatar: {\n    position: 'absolute',\n    // make avatar 25% of the middle col\n    width: theme.sav3.layout.columns.middle.width.md / 4,\n    height: theme.sav3.layout.columns.middle.width.md / 4,\n    marginTop: theme.sav3.layout.columns.middle.width.md / -8,\n    marginLeft: theme.spacing(2),\n    borderWidth: theme.spacing(0.5),\n    borderStyle: 'solid',\n    borderColor: theme.palette.background.default,\n    [theme.breakpoints.down(theme.sav3.layout.columns.middle.width.md)]: {\n      width: '25vw',\n      height: '25vw',\n      marginTop: '-12.5vw',\n      borderWidth: theme.spacing(0.25)\n    }\n  },\n  displayName: {\n    wordBreak: 'break-all'\n  }\n}))\n\nfunction Profile ({userCid} = {}) {\n  const ownCid = useOwnUserCid()\n  const classes = useStyles()\n  const profile = useUserProfile(userCid)\n  const userPostCids = useUserPostCids(userCid)\n  const [loadedPostCount, setLoadedPostCount] = useState(10)\n  const next = () => setLoadedPostCount((loadedPostCount) => loadedPostCount + 10)\n\n  // ordered posts with profile\n  const postsObject = usePosts(userPostCids)\n  const posts = Object.values(postsObject).sort((a, b) => b.timestamp - a.timestamp)\n  for (const post of posts) {\n    post.profile = profile\n  }\n  const loadedPosts = [...posts]\n  if (loadedPosts.length > loadedPostCount) {\n    loadedPosts.length = loadedPostCount\n  }\n  const hasMore = posts.length > loadedPosts.length\n\n  debug({ownCid, userCid, posts, profile})\n\n  let button\n  if (userCid === ownCid) {\n    button = <EditProfileButton profile={profile} />\n  }\n  // dont show button if dont know own cid yet\n  else if (ownCid) {\n    button = <FollowButton userCid={userCid} />\n  }\n\n  let description = profile.description || ''\n  if (description && description.length > 140) {\n    description = description.substring(0, 140)\n  }\n\n  return (\n    <div className={classes.root}>\n      <CardMedia className={classes.banner} image={(profile.bannerUrl && forceHttps(profile.bannerUrl)) || emptyImage} />\n      <Avatar src={profile.thumbnailUrl && forceHttps(profile.thumbnailUrl)} className={classes.avatar} />\n      <Box p={2} pb={0} display='flex' flexDirection='row-reverse'>\n        {button}\n        <MoreMenuButton userCid={userCid} />\n      </Box>\n      <CardHeader className={classes.displayName} pb={0} title={profile.displayName} subheader={userCid} />\n      <Box p={2} pt={0}>\n        <Description description={description} />\n      </Box>\n      <Divider />\n      <PostsFeed posts={loadedPosts} next={next} hasMore={hasMore} />\n    </div>\n  )\n}\n\nProfile.propTypes = {\n  userCid: PropTypes.string.isRequired\n}\n\nfunction EditProfileButton ({profile}) {\n  const t = useTranslation()\n  const [openEditProfileModal, setOpenEditProfileModal] = useState(false)\n  return (\n    <div>\n      <Button variant='outlined' size='large' color='primary' onClick={() => setOpenEditProfileModal(true)}>\n        {t['Edit profile']()}\n      </Button>\n      <EditProfileModal previousProfile={profile} open={openEditProfileModal} onClose={() => setOpenEditProfileModal(false)} />\n    </div>\n  )\n}\n\nfunction FollowButton ({userCid} = {}) {\n  const t = useTranslation()\n  const [isFollowing, setIsFollowing] = useIsFollowing(userCid)\n\n  const follow = (value) => {\n    // still show button even if cid hasn't loaded yet but don't follow\n    if (!userCid) {\n      return\n    }\n    setIsFollowing(value)\n  }\n\n  let followButton = (\n    <Button variant='outlined' size='large' color='primary' onClick={() => follow(true)}>\n      {t.Follow()}\n    </Button>\n  )\n  if (isFollowing) {\n    followButton = (\n      <Button variant='outlined' size='large' color='primary' onClick={() => follow(false)}>\n        {t.Unfollow()}\n      </Button>\n    )\n  }\n  return followButton\n}\n\nFollowButton.propTypes = {\n  userCid: PropTypes.string\n}\n\nconst forceHttps = (link) => {\n  assert(typeof link === 'string', `forceHttps link '${link}' not a string`)\n  link = link.trim()\n  link = link.replace(/^http:\\/\\//, 'https://')\n  return link\n}\n\nexport default Profile\n","import Box from '@material-ui/core/Box'\nimport useUserProfile from 'src/hooks/use-user-profile'\nimport TopBar from 'src/components/top-bar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\nimport ArrowBack from '@material-ui/icons/ArrowBack'\nimport {useHistory, useParams} from 'react-router-dom'\nimport useOwnUserCid from 'src/hooks/use-own-user-cid'\nimport ProfileComponent from './components/profile'\nimport useTranslation from 'src/translations/use-translation'\nimport urlUtils from 'src/lib/utils/url'\nimport Debug from 'debug'\nconst debug = Debug('sav3:views:profile')\n\nfunction Profile () {\n  const {encodedCid} = useParams()\n  const urlIsExpired = encodedCid && urlUtils.encodedCidIsExpired(encodedCid)\n  let urlUserCid\n  if (!urlIsExpired && encodedCid) {\n    urlUserCid = urlUtils.decodeCid(encodedCid)\n  }\n\n  const isOwnProfile = !encodedCid\n  const ownCid = useOwnUserCid()\n\n  let userCid\n  if (isOwnProfile) {\n    userCid = ownCid\n  }\n  else {\n    userCid = urlUserCid\n  }\n\n  const profile = useUserProfile(userCid)\n  const history = useHistory()\n  const t = useTranslation()\n\n  debug({userCid, urlUserCid, urlIsExpired, isOwnProfile})\n\n  return (\n    <div>\n      <TopBar>\n        <Box pr={1}>\n          <IconButton onClick={() => history.goBack()}>\n            <ArrowBack />\n          </IconButton>\n        </Box>\n        <Typography noWrap variant='h6'>\n          {profile.displayName || (isOwnProfile && t['Edit profile']())}\n        </Typography>\n      </TopBar>\n      {urlIsExpired && (\n        <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n          <Typography variant='body1'>{t['URL expired']() + '.'}</Typography>\n        </Box>\n      )}\n      {!urlIsExpired && <ProfileComponent userCid={userCid} />}\n    </div>\n  )\n}\n\nexport default Profile\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\n\nconst useOwnPeerCid = () => {\n  const [ownPeerCid, setOwnPeerCid] = useState()\n\n  useEffect(() => {\n    ;(async () => {\n      const ownPeerCid = await sav3Ipfs.getOwnPeerCid()\n      setOwnPeerCid(ownPeerCid)\n    })()\n  }, [])\n\n  return ownPeerCid\n}\n\nexport default useOwnPeerCid\n","import {makeStyles} from '@material-ui/core/styles'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport BarChartIcon from '@material-ui/icons/BarChart'\nimport AccountCircle from '@material-ui/icons/AccountCircle'\nimport GroupIcon from '@material-ui/icons/Group'\nimport {Link as RouterLink} from 'react-router-dom'\nimport useTranslation from 'src/translations/use-translation'\nimport ThemeSwitcher from 'src/components/theme-switcher'\nimport TranslationSwitcher from 'src/components/translation-switcher'\n\nconst useStyles = makeStyles((theme) => ({\n  text: {},\n  root: {\n    width: theme.sav3.drawerMenu.width\n  }\n}))\n\nfunction HomeMenu () {\n  const classes = useStyles()\n  const t = useTranslation()\n\n  return (\n    <div className={classes.root}>\n      <List>\n        <ListItem button component={RouterLink} to='/following'>\n          <ListItemIcon>\n            <GroupIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Following()} className={classes.text} />\n        </ListItem>\n        <ListItem button component={RouterLink} to='/stats'>\n          <ListItemIcon>\n            <BarChartIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Stats()} className={classes.text} />\n        </ListItem>\n        {/* temporarily added to bottom menu\n        <ListItem button component={RouterLink} to='/peers'>\n          <ListItemIcon>\n            <PeersIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Peers()} className={classes.text} />\n        </ListItem>\n        <ListItem button component={RouterLink} to='/stats'>\n          <ListItemIcon>\n            <BarChartIcon fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Stats()} className={classes.text} />\n        </ListItem>\n        */}\n        <ListItem button component={RouterLink} to='/profile'>\n          <ListItemIcon>\n            <AccountCircle fontSize='large' />\n          </ListItemIcon>\n          <ListItemText primary={t.Profile()} className={classes.text} />\n        </ListItem>\n        <ListItem>\n          <ThemeSwitcher />\n          <TranslationSwitcher />\n        </ListItem>\n      </List>\n    </div>\n  )\n}\n\nexport default HomeMenu\n","import {useState} from 'react'\nimport Avatar from '@material-ui/core/Avatar'\nimport useUserProfile from 'src/hooks/use-user-profile'\nimport IconButton from '@material-ui/core/IconButton'\nimport useOwnPeerCid from 'src/hooks/use-own-peer-cid'\nimport {makeStyles} from '@material-ui/core/styles'\nimport Drawer from '@material-ui/core/Drawer'\nimport Menu from './index'\n\nconst useStyles = makeStyles((theme) => ({\n  avatar: {\n    width: theme.sav3.topBar.height / 1.75,\n    height: theme.sav3.topBar.height / 1.75\n  }\n}))\n\nfunction AvatarDrawerMenuButton () {\n  const userCid = useOwnPeerCid()\n  const classes = useStyles()\n  const profile = useUserProfile(userCid)\n  const [drawerOpen, setDrawerOpen] = useState(false)\n\n  return (\n    <div>\n      <IconButton style={{backgroundColor: 'transparent'}} disableRipple disableFocusRipple onClick={() => setDrawerOpen(true)}>\n        <Avatar src={profile.thumbnailUrl} className={classes.avatar} />\n      </IconButton>\n      <Drawer achor='left' elevation={2} open={drawerOpen} onClose={() => setDrawerOpen(false)}>\n        <Menu />\n      </Drawer>\n    </div>\n  )\n}\n\nexport default AvatarDrawerMenuButton\n","import {useState} from 'react'\nimport Button from '@material-ui/core/Button'\nimport TextField from '@material-ui/core/TextField'\nimport useTranslation from 'src/translations/use-translation'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport Alert from '@material-ui/lab/Alert'\nimport {makeStyles, useTheme} from '@material-ui/core/styles'\nimport Box from '@material-ui/core/Box'\nimport Divider from '@material-ui/core/Divider'\nimport useUserProfile from 'src/hooks/use-user-profile'\nimport useOwnUserCid from 'src/hooks/use-own-user-cid'\nimport Avatar from '@material-ui/core/Avatar'\n\nconst useStyles = makeStyles((theme) => ({\n  errorMessage: {\n    overflow: 'hidden'\n  },\n  content: {\n    '& textarea': {\n      overflow: 'hidden'\n    },\n    // remove text input variant borders\n    '& fieldset': {\n      border: 'none'\n    },\n    '& .MuiInputBase-root': {\n      paddingLeft: 0,\n      paddingRight: 0\n    },\n    marginBottom: theme.spacing(1)\n  },\n  contentInput: {\n    paddingTop: 0,\n    paddingBottom: 0\n  },\n  avatar: {\n    // slightly higher placement than the user name seems more pleasing\n    marginTop: theme.spacing(-0.25),\n    width: theme.spacing(6),\n    height: theme.spacing(6),\n    // borders\n    borderWidth: theme.sav3.borderWidth,\n    borderStyle: 'solid',\n    borderColor: theme.sav3.borderColor\n  }\n}))\n\nfunction PublishPostForm () {\n  const t = useTranslation()\n  const classes = useStyles()\n  const theme = useTheme()\n  const userCid = useOwnUserCid()\n  const profile = useUserProfile(userCid)\n\n  const [content, setContent] = useState('')\n  const [errorMessage, setErrorMessage] = useState()\n\n  const handleChange = (event) => {\n    let content = event.target.value\n    try {\n      if (content.length > 140) {\n        content = content.subtring(0, 140)\n      }\n      setContent(content)\n    }\n    catch (e) {}\n  }\n\n  const handlePublish = async () => {\n    try {\n      await sav3Ipfs.publishPost({content})\n      setErrorMessage(null)\n      setContent('')\n    }\n    catch (e) {\n      setErrorMessage(e.message)\n    }\n  }\n\n  const modalActions = (\n    <div>\n      <Box>\n        <Divider />\n      </Box>\n      <Box alignItems='center' display='flex' height={theme.sav3.topBar.height}>\n        <Box flexGrow={1}></Box>\n        <Button disableElevation variant='contained' onClick={handlePublish} color='primary'>\n          SAV3\n        </Button>\n      </Box>\n    </div>\n  )\n\n  return (\n    <Box px={2} display='flex'>\n      {/* left col avatar */}\n      <Box pr={1.5} py={1.5}>\n        <Avatar src={profile.thumbnailUrl} className={classes.avatar} />\n      </Box>\n\n      <Box pt={1} width='100%'>\n        <TextField className={classes.content} onChange={handleChange} margin='dense' id='content' placeholder={t['Uncensorable content']()} fullWidth multiline variant='outlined' value={content} />\n        {errorMessage && (\n          <Box py={1}>\n            <Alert classes={{message: classes.errorMessage}} severity='error'>\n              {errorMessage}\n            </Alert>\n          </Box>\n        )}\n\n        {modalActions}\n      </Box>\n    </Box>\n  )\n}\n\nPublishPostForm.propTypes = {}\n\nexport default PublishPostForm\n","import {useContext} from 'react'\nimport {FollowingContext} from './following-provider'\n\nconst useFollowing = () => {\n  const {following, setAllFollowing} = useContext(FollowingContext)\n  const _following = Object.keys(following).filter((userCid) => !!following[userCid])\n  return [_following, setAllFollowing]\n}\n\nexport default useFollowing\n","import memoize from 'p-memoize'\n\nconst createLocalStorageCache = (func) => {\n  const localStorageKey = func.toString()\n  const cache = {\n    has: (key) => {\n      return !!localStorage.getItem(`${localStorageKey}-${key}`)\n    },\n    get: (key) => {\n      return JSON.parse(localStorage.getItem(`${localStorageKey}-${key}`))\n    },\n    set: (key, value) => {\n      ;(async () => {\n        value.data = await value.data\n        localStorage.setItem(`${localStorageKey}-${key}`, JSON.stringify(value))\n      })()\n    },\n    delete: (key) => {\n      localStorage.removeItem(`${localStorageKey}-${key}`)\n    },\n    clear: () => {\n      throw Error('localStorageMemoize.clear() not implemented')\n    }\n  }\n  return cache\n}\n\nconst localStorageMemoize = (func, options = {}) => {\n  const cache = createLocalStorageCache(func)\n  return memoize(func, {...options, cache})\n}\n\nexport default localStorageMemoize\n","import localStorageMemoize from 'src/lib/utils/local-storage-memoize'\nimport config from 'src/config'\nimport assert from 'assert'\nimport isIpfs from 'is-ipfs'\n\nexport const getBootstrapUsersCids = async () => {\n  try {\n    const cids = await fetchBootstrapUsersCidsFromGoogleSheet()\n    return cids\n  }\n  catch (e) {\n    console.error(e)\n    return []\n  }\n}\n\nconst _fetchBootstrapUsersCidsFromGoogleSheet = async () => {\n  const googleSheetId = config.bootstrapUsersGoogleSheetId\n  assert(googleSheetId && typeof googleSheetId === 'string', `fetchBootstrapUsersCidsFromGoogleSheet invalid google sheet id '${googleSheetId}'`)\n  let res\n  const bootstrapUsers = []\n  try {\n    res = await fetch(`https://docs.google.com/spreadsheets/d/${googleSheetId}/export?format=csv`)\n    res = await res.text()\n    res = res.split('\\n')\n    for (const userCid of res) {\n      if (isIpfs.cid(userCid.trim())) {\n        bootstrapUsers.push(userCid.trim())\n      }\n    }\n  }\n  catch (e) {\n    throw Error(`failed fetching bootstrap users from google sheet '${googleSheetId}' response '${res}': ${e.message}`)\n  }\n  return bootstrapUsers\n}\nconst oneHour = 1000 * 60 * 60\nconst fetchBootstrapUsersCidsFromGoogleSheet = localStorageMemoize(_fetchBootstrapUsersCidsFromGoogleSheet, {maxAge: oneHour})\n\nexport default {\n  getBootstrapUsersCids\n}\n","import {useEffect, useState} from 'react'\nimport bootstrapUsersUtils from 'src/lib/sav3-ipfs/utils/bootstrap-users'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:following:use-bootstrap-users-cids')\n\nconst useBootstrapUsersCids = () => {\n  const [bootstrapUsersCids, setBootstrapUsersCids] = useState([])\n  debug({bootstrapUsersCids})\n\n  useEffect(() => {\n    ;(async () => {\n      const bootstrapUsersCids = await bootstrapUsersUtils.getBootstrapUsersCids()\n      setBootstrapUsersCids(bootstrapUsersCids)\n    })()\n  }, [])\n\n  return bootstrapUsersCids\n}\n\nexport default useBootstrapUsersCids\n","import {useState, useEffect} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-users-following')\n\nconst usersFollowingCache = {}\n\nconst useUsersFollowing = (userCids) => {\n  assert(Array.isArray(userCids), `invalid userCids '${JSON.stringify(userCids)}'`)\n  // remove duplicates\n  const uniqueUserCids = new Set(userCids)\n  const userCidsString = JSON.stringify([...uniqueUserCids])\n  const [usersFollowing, setUsersFollowing] = useState([])\n\n  debug({userCids, usersFollowing})\n\n  useEffect(() => {\n    // note: dont reset back to empty array on user cids change\n    // because it doesn't really affect user experience\n\n    for (const userCid of uniqueUserCids) {\n      const userFollowing = usersFollowingCache[userCid]\n      if (userFollowing) {\n        setUsersFollowing((previousUsersFollowing) => addNewUsersFollowing(previousUsersFollowing, userFollowing))\n      }\n      else {\n        sav3Ipfs.getUserFollowing(userCid).then((userFollowing) => {\n          usersFollowingCache[userCid] = userFollowing\n          setUsersFollowing((previousUsersFollowing) => addNewUsersFollowing(previousUsersFollowing, userFollowing))\n        })\n      }\n    }\n  }, [userCidsString])\n\n  return usersFollowing\n}\n\nconst addNewUsersFollowing = (previousUsersFollowing, newUsersFollowing) => {\n  previousUsersFollowing = new Set(previousUsersFollowing)\n  for (const userCid of newUsersFollowing) {\n    previousUsersFollowing.add(userCid)\n  }\n  return [...previousUsersFollowing]\n}\n\nexport default useUsersFollowing\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport usePrevious from 'src/hooks/utils/use-previous'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-users-ipns-contents')\n\nconst useUsersIpnsContents = (ipnsPaths) => {\n  assert(Array.isArray(ipnsPaths), `invalid ipnsPaths '${JSON.stringify(ipnsPaths)}'`)\n  for (const ipnsPath of ipnsPaths) {\n    assert(ipnsPath && typeof ipnsPath === 'string', `invalid ipnsPaths '${JSON.stringify(ipnsPaths)}' contains non string`)\n  }\n\n  const [usersIpnsContents, setUsersIpnsContents] = useState(getDefaultUsersIpnsContents(ipnsPaths))\n  const uniqueIpnsPaths = new Set(ipnsPaths)\n  const previousUniqueIpnsPaths = usePrevious(uniqueIpnsPaths)\n\n  // if remount, only subscribe to not yet subscribed\n  const unsubscribedIpnsPaths = []\n  for (const ipnsPath of uniqueIpnsPaths) {\n    if (!previousUniqueIpnsPaths || !previousUniqueIpnsPaths.has(ipnsPath)) {\n      unsubscribedIpnsPaths.push(ipnsPath)\n    }\n  }\n\n  debug({ipnsPaths, usersIpnsContents, unsubscribedIpnsPaths})\n\n  // if remount, delete removed ipns paths, and set new empty ipns paths contents\n  const updateIpnsContents = () => {\n    const newEmptyIpnsContents = []\n    const removedIpnsContents = []\n\n    // find new empty ipns paths contents\n    for (const ipnsPath of ipnsPaths) {\n      if (!usersIpnsContents[ipnsPath]) {\n        newEmptyIpnsContents.push(ipnsPath)\n      }\n    }\n\n    // find removed ipns paths\n    for (const ipnsPath in usersIpnsContents) {\n      if (!uniqueIpnsPaths.has(ipnsPath)) {\n        removedIpnsContents.push(ipnsPath)\n      }\n    }\n\n    // if found any updates, set them\n    if (newEmptyIpnsContents.length || removedIpnsContents.length) {\n      setUsersIpnsContents((previousUsersIpnsContents) => {\n        const newUsersIpnsContents = {...previousUsersIpnsContents}\n        for (const missingDefaultIpnsContent of newEmptyIpnsContents) {\n          if (!newUsersIpnsContents[missingDefaultIpnsContent]) {\n            newUsersIpnsContents[missingDefaultIpnsContent] = {}\n          }\n        }\n        for (const removedIpnsContent of removedIpnsContents) {\n          delete newUsersIpnsContents[removedIpnsContent]\n        }\n        return newUsersIpnsContents\n      })\n    }\n  }\n\n  useEffect(() => {\n    updateIpnsContents()\n\n    if (!unsubscribedIpnsPaths.length) {\n      return\n    }\n\n    // subscribe to future published ipns paths\n    const onPublish = async (newIpnsPath, ipnsValue) => {\n      if (!uniqueIpnsPaths.has(newIpnsPath)) {\n        // publish event is a different user\n        return\n      }\n\n      // update usersIpnsContents state asynchronously as new ipfs files arrive\n      const ipnsContent = await sav3Ipfs.getUserIpnsContent(ipnsValue)\n      setUsersIpnsContents((previousUsersIpnsContents) => ({\n        ...previousUsersIpnsContents,\n        [newIpnsPath]: ipnsContent\n      }))\n    }\n    sav3Ipfs.on('publish', onPublish)\n\n    // get the current ipns paths once\n    ;(async () => {\n      const ipnsValues = await sav3Ipfs.subscribeToIpnsPaths(unsubscribedIpnsPaths)\n      for (const [i, ipnsValue] of ipnsValues.entries()) {\n        if (!ipnsValue) {\n          // user has not published anything yet\n          continue\n        }\n\n        // update usersIpnsContent state asynchronously as new ipfs files arrive\n        const ipnsPath = unsubscribedIpnsPaths[i]\n        sav3Ipfs.getUserIpnsContent(ipnsValue).then((ipnsContent) => {\n          setUsersIpnsContents((previousUsersIpnsContents) => ({\n            ...previousUsersIpnsContents,\n            [ipnsPath]: ipnsContent\n          }))\n        })\n      }\n    })()\n\n    // unsubscribe after component unmounts\n    return () => {\n      sav3Ipfs.off('publish', onPublish)\n    }\n  }, [JSON.stringify(ipnsPaths)])\n\n  return usersIpnsContents\n}\n\nconst getDefaultUsersIpnsContents = (ipnsPaths) => {\n  const defaultUsersIpnsContents = {}\n  for (const ipnsPath of ipnsPaths) {\n    defaultUsersIpnsContents[ipnsPath] = {}\n  }\n  return defaultUsersIpnsContents\n}\n\nexport default useUsersIpnsContents\n","import {useEffect, useState} from 'react'\nimport usePrevious from 'src/hooks/utils/use-previous'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport useUsersIpnsContents from 'src/hooks/use-users-ipns-contents'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-users-post-cids')\n\nconst useUsersPostCids = (userCids) => {\n  assert(Array.isArray(userCids), `invalid userCids '${JSON.stringify(userCids)}'`)\n  const usersIpnsContents = useUsersIpnsContents(userCids)\n\n  const uniqueUserCids = new Set(userCids)\n  const [usersPostCids, setUsersPostCids] = useState(getDefaultUsersPostCids(userCids))\n  const previousUsersIpnsContents = usePrevious(usersIpnsContents)\n\n  debug({userCids, usersIpnsContents, previousUsersIpnsContents, usersPostCids})\n\n  // if remount, delete removed user cids, and set new empty user post cids\n  const updatePostCids = () => {\n    const newEmptyPostCids = []\n    const removedPostCids = []\n\n    // find new empty user post cids\n    for (const userCid of userCids) {\n      if (!usersPostCids[userCid]) {\n        newEmptyPostCids.push(userCid)\n      }\n    }\n\n    // find removed user cids\n    for (const userCid in usersPostCids) {\n      if (!uniqueUserCids.has(userCid)) {\n        removedPostCids.push(userCid)\n      }\n    }\n\n    // if found any updates, set them\n    if (newEmptyPostCids.length || removedPostCids.length) {\n      setUsersPostCids((previousUsersPostCids) => {\n        const newUsersPostCids = {...previousUsersPostCids}\n        for (const missingDefaultIpnsContent of newEmptyPostCids) {\n          if (!newUsersPostCids[missingDefaultIpnsContent]) {\n            newUsersPostCids[missingDefaultIpnsContent] = []\n          }\n        }\n        for (const removedIpnsContent of removedPostCids) {\n          delete newUsersPostCids[removedIpnsContent]\n        }\n        return newUsersPostCids\n      })\n    }\n  }\n\n  useEffect(() => {\n    updatePostCids()\n\n    for (const userCid in usersIpnsContents) {\n      const lastPostCid = usersIpnsContents[userCid] && usersIpnsContents[userCid].lastPostCid\n      const previousLastPostCid = previousUsersIpnsContents && previousUsersIpnsContents[userCid] && previousUsersIpnsContents[userCid].lastPostCid\n      if (!lastPostCid || lastPostCid === previousLastPostCid) {\n        continue\n      }\n\n      let limit = 20\n\n      ;(async () => {\n        for await (const postCid of sav3Ipfs.getPreviousPostCids(lastPostCid)) {\n          // note: don't stop on unmount or it will cut off new post cids from\n\n          // if lastPostCid changes and triggers refresh somehow (should not happen)\n          if (usersPostCids[userCid].includes(postCid)) {\n            continue\n          }\n\n          setUsersPostCids((previousUsersPostCids) => {\n            previousUsersPostCids = JSON.parse(JSON.stringify(previousUsersPostCids))\n            previousUsersPostCids[userCid] = [...previousUsersPostCids[userCid], postCid]\n            return previousUsersPostCids\n          })\n\n          if (!limit--) {\n            return\n          }\n        }\n      })()\n    }\n  }, [JSON.stringify(usersIpnsContents)])\n\n  return usersPostCids\n}\n\nconst getDefaultUsersPostCids = (userCids) => {\n  const defaultUsersPostCids = {}\n  for (const userCid of userCids) {\n    defaultUsersPostCids[userCid] = []\n  }\n  return defaultUsersPostCids\n}\n\nexport default useUsersPostCids\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport useUsersIpnsContents from 'src/hooks/use-users-ipns-contents'\nimport usePrevious from 'src/hooks/utils/use-previous'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-users-profiles')\n\nconst useUsersProfiles = (userCids) => {\n  assert(Array.isArray(userCids), `invalid userCids '${JSON.stringify(userCids)}'`)\n  const defaultUserProfiles = {}\n  const [usersProfiles, setUsersProfiles] = useState(defaultUserProfiles)\n  const usersIpnsContents = useUsersIpnsContents(userCids)\n  const profileCids = {}\n  for (const userCid in usersIpnsContents) {\n    profileCids[userCid] = usersIpnsContents[userCid].profileCid\n  }\n  const previousProfileCids = usePrevious(profileCids)\n  debug({usersIpnsContents, userCids, profileCids, previousProfileCids, usersProfiles})\n\n  const getUserProfileIsPending = (userCid) => {\n    return (\n      previousProfileCids &&\n      previousProfileCids[userCid] &&\n      previousProfileCids[userCid].profileCid &&\n      profileCids[userCid] &&\n      profileCids[userCid].profileCid === previousProfileCids[userCid].profileCid\n    )\n  }\n\n  useEffect(() => {\n    // dont reset to default on profile cids change because\n    // even if extra profiles are kept it doesn't affect\n    // any functionalities yet\n\n    for (const userCid in profileCids) {\n      const profileCid = profileCids[userCid]\n      if (!profileCid || typeof profileCid !== 'string') {\n        continue\n      }\n      if (getUserProfileIsPending(userCid)) {\n        continue\n      }\n\n      sav3Ipfs.getUserProfile(profileCid).then((userProfile) => {\n        setUsersProfiles((previousUsersProfiles) => ({\n          ...previousUsersProfiles,\n          [userCid]: userProfile\n        }))\n      })\n    }\n  }, [JSON.stringify(profileCids)])\n\n  return usersProfiles\n}\n\nexport default useUsersProfiles\n","import {createContext, useState, useEffect} from 'react'\nimport usePrevious from 'src/hooks/utils/use-previous'\nimport useFollowing from 'src/hooks/following/use-following'\nimport useBootstrapUsersCids from 'src/hooks/following/use-bootstrap-users-cids'\nimport useOwnUserCid from 'src/hooks/use-own-user-cid'\nimport useUsersFollowing from 'src/hooks/use-users-following'\nimport useUsersPostCids from 'src/hooks/use-users-post-cids'\nimport useUsersProfiles from 'src/hooks/use-users-profiles'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:feed:feed-provider')\n\nexport const FeedContext = createContext()\n\nconst FeedProvider = (props) => {\n  // set posts once on load, and refresh every 5min\n  const [posts, setPosts] = useState({})\n\n  const ownCid = useOwnUserCid()\n  const [followingCids] = useFollowing()\n  const bootstrapUsersCids = useBootstrapUsersCids()\n  const followingOfFollowingCids = useUsersFollowing([...followingCids, ...bootstrapUsersCids])\n\n  const uniqueUserCids = new Set([...followingCids, ...bootstrapUsersCids, ...followingOfFollowingCids])\n  if (ownCid) {\n    uniqueUserCids.add(ownCid)\n  }\n  const userCids = [...uniqueUserCids]\n  const usersPostCids = useUsersPostCids(userCids)\n  const uniquePostCids = usersPostCidsToUniquePostCids(usersPostCids)\n  const previousUniquePostCids = usePrevious(uniquePostCids)\n  const usersPostCidsString = JSON.stringify(usersPostCids)\n  const profiles = useUsersProfiles(userCids)\n\n  const feedPostCids = getFeedCids(usersPostCids, followingCids)\n  const homePostCids = getFeedCids(usersPostCids, userCids)\n\n  const getAndSetPost = async (postCid) => {\n    const post = await sav3Ipfs.getPost(postCid)\n    setPosts((previousPosts) => ({\n      ...previousPosts,\n      [postCid]: post\n    }))\n  }\n\n  debug({ownCid, followingCids, bootstrapUsersCids, followingOfFollowingCids, usersPostCids, posts, profiles, feedPostCids, homePostCids})\n\n  // get users posts\n  useEffect(() => {\n    for (const userCid in usersPostCids) {\n      for (const postCid of usersPostCids[userCid]) {\n        if (!previousUniquePostCids || !previousUniquePostCids.has(postCid)) {\n          getAndSetPost(postCid)\n        }\n      }\n    }\n  }, [usersPostCidsString])\n\n  const contextValue = {\n    posts,\n    profiles,\n    feedPostCids,\n    homePostCids\n  }\n\n  const {children} = props\n  return <FeedContext.Provider value={contextValue}>{children}</FeedContext.Provider>\n}\n\nconst getFeedCids = (usersPostCids, userCids) => {\n  const feedCids = []\n  for (const userCid of userCids) {\n    if (!usersPostCids[userCid]) {\n      continue\n    }\n    for (const postCid of usersPostCids[userCid]) {\n      feedCids.push(postCid)\n    }\n  }\n  return feedCids\n}\n\nconst usersPostCidsToUniquePostCids = (usersPostCids) => {\n  const uniquePostCids = new Set()\n  for (const userCid in usersPostCids) {\n    for (const postCid of usersPostCids[userCid]) {\n      uniquePostCids.add(postCid)\n    }\n  }\n  return uniquePostCids\n}\n\nexport default FeedProvider\n","import {useContext, useState, useEffect} from 'react'\nimport {FeedContext} from './feed-provider'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:feed:use-home-posts')\n\nconst postsPerPage = 10\n\nconst useHomePosts = () => {\n  const {posts, profiles, homePostCids} = useContext(FeedContext)\n  const [postCount, setPostCount] = useState(postsPerPage)\n  const [homePosts, setHomePosts] = useState([])\n\n  const allHomePosts = []\n  for (const homePostCid of homePostCids) {\n    if (!posts[homePostCid]) {\n      continue\n    }\n    allHomePosts.push(posts[homePostCid])\n  }\n\n  // set home posts every time new posts are added to context\n  useEffect(() => {\n    /* algo\n      if home posts length is greater or equal to post count, do nothing\n      if home posts length is greater or equal to all posts length, do nothing\n      else\n        - sort by timestamp\n        - fill until full or run out of posts, make sure to not add posts already added\n    */\n\n    // home posts is already full\n    if (homePosts.length >= postCount) {\n      return\n    }\n    // all posts has no new posts\n    if (allHomePosts.length <= homePosts.length) {\n      return\n    }\n\n    const postsNotAddedYet = allHomePosts.filter((post) => {\n      for (const homePost of homePosts) {\n        if (homePost.cid === post.cid) {\n          return false\n        }\n      }\n      return true\n    })\n    const postsNotAddedYetSortedByTimestamp = postsNotAddedYet.sort((a, b) => b.timestamp - a.timestamp)\n\n    setHomePosts((previousHomePosts) => {\n      const nextHomePosts = JSON.parse(JSON.stringify(previousHomePosts))\n      for (const post of postsNotAddedYetSortedByTimestamp) {\n        if (nextHomePosts.length >= postCount) {\n          break\n        }\n\n        nextHomePosts.push(post)\n      }\n\n      // set profiles\n      for (const nextHomePost of nextHomePosts) {\n        nextHomePost.profile = profiles[nextHomePost.userCid] || {}\n      }\n\n      return nextHomePosts\n    })\n  }, [postCount, JSON.stringify(allHomePosts), JSON.stringify(profiles)])\n\n  // load next posts while scrolling\n  const next = () => {\n    setPostCount((previousPostCount) => previousPostCount + postsPerPage)\n  }\n\n  // go back to page 1, undo all scrolling\n  const reset = () => {\n    setPostCount(postsPerPage)\n    setHomePosts([])\n  }\n\n  // has more posts that can be loaded from scrolling\n  const hasMore = allHomePosts.length > homePosts.length\n\n  debug({homePosts, postCount, posts, hasMore})\n\n  return {posts: homePosts, next, hasMore, reset}\n}\n\nexport default useHomePosts\n","import Box from '@material-ui/core/Box'\nimport TopBar from 'src/components/top-bar'\nimport Typography from '@material-ui/core/Typography'\nimport {useTheme} from '@material-ui/core/styles'\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\nimport AvatarDrawerMenuButton from 'src/components/menus/drawer/avatar-button'\nimport Feed from 'src/components/feeds/posts'\nimport PublishPostForm from 'src/components/publish-post/form'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport useTranslation from 'src/translations/use-translation'\nimport useHomePosts from 'src/hooks/feed/use-home-posts'\nimport Divider from '@material-ui/core/Divider'\nimport Debug from 'debug'\nconst debug = Debug('sav3:views:home')\n\nfunction Home () {\n  const theme = useTheme()\n  const fullScreen = useMediaQuery(theme.breakpoints.down('xs'))\n  const t = useTranslation()\n  const {posts, next, hasMore} = useHomePosts()\n  debug({posts})\n\n  let feed = <Feed posts={posts} next={next} hasMore={hasMore} />\n  if (!posts.length) {\n    feed = (\n      <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n        <CircularProgress size={24} />\n        <Box p={0.5} />\n        <Typography variant='body1'>{t['Connecting to peers']() + '...'}</Typography>\n      </Box>\n    )\n  }\n\n  return (\n    <div>\n      <TopBar>\n        {fullScreen && (\n          <Box pl={2} pr={1}>\n            <AvatarDrawerMenuButton />\n          </Box>\n        )}\n        <Box pl={2}>\n          <Typography noWrap variant='h6'>\n            {t.Home()}\n          </Typography>\n        </Box>\n      </TopBar>\n      {!fullScreen && (\n        <div>\n          <Box pb={1}>\n            <PublishPostForm />\n            <Divider />\n          </Box>\n          <Divider />\n        </div>\n      )}\n      {feed}\n    </div>\n  )\n}\n\nexport default Home\n","import {useEffect, useState} from 'react'\nimport followManager from 'src/lib/follow-manager'\n\nconst useFollowingOnce = () => {\n  const [following, setFollowing] = useState([])\n\n  useEffect(() => {\n    ;(async () => {\n      const following = await followManager.getAllFollowing()\n      setFollowing(following)\n    })()\n  }, [])\n\n  return following\n}\n\nexport default useFollowingOnce\n","import {useContext, useState, useEffect} from 'react'\nimport {FeedContext} from './feed-provider'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:feed:use-feed-posts')\n\nconst postsPerPage = 10\n\nconst useFeedPosts = () => {\n  const {posts, profiles, feedPostCids} = useContext(FeedContext)\n  const [postCount, setPostCount] = useState(postsPerPage)\n  const [feedPosts, setFeedPosts] = useState([])\n\n  const allFeedPosts = []\n  for (const feedPostCid of feedPostCids) {\n    if (!posts[feedPostCid]) {\n      continue\n    }\n    allFeedPosts.push(posts[feedPostCid])\n  }\n\n  // set feed posts every time new posts are added to context\n  useEffect(() => {\n    /* algo\n      if feed posts length is greater or equal to post count, do nothing\n      if feed posts length is greater or equal to all posts length, do nothing\n      else\n        - sort by timestamp\n        - fill until full or run out of posts, make sure to not add posts already added\n    */\n\n    // feed posts is already full\n    if (feedPosts.length >= postCount) {\n      return\n    }\n    // all posts has no new posts\n    if (allFeedPosts.length <= feedPosts.length) {\n      return\n    }\n\n    const postsNotAddedYet = allFeedPosts.filter((post) => {\n      for (const feedPost of feedPosts) {\n        if (feedPost.cid === post.cid) {\n          return false\n        }\n      }\n      return true\n    })\n    const postsNotAddedYetSortedByTimestamp = postsNotAddedYet.sort((a, b) => b.timestamp - a.timestamp)\n\n    setFeedPosts((previousFeedPosts) => {\n      const nextFeedPosts = JSON.parse(JSON.stringify(previousFeedPosts))\n      for (const post of postsNotAddedYetSortedByTimestamp) {\n        if (nextFeedPosts.length >= postCount) {\n          break\n        }\n\n        nextFeedPosts.push(post)\n      }\n\n      // set profiles\n      for (const nextFeedPost of nextFeedPosts) {\n        nextFeedPost.profile = profiles[nextFeedPost.userCid] || {}\n      }\n\n      return nextFeedPosts\n    })\n  }, [postCount, JSON.stringify(allFeedPosts), JSON.stringify(profiles)])\n\n  // load next posts while scrolling\n  const next = () => {\n    setPostCount((previousPostCount) => previousPostCount + postsPerPage)\n  }\n\n  // go back to page 1, undo all scrolling\n  const reset = () => {\n    setPostCount(postsPerPage)\n    setFeedPosts([])\n  }\n\n  // has more posts that can be loaded from scrolling\n  const hasMore = allFeedPosts.length > feedPosts.length\n\n  debug({feedPosts, postCount, posts, hasMore})\n\n  return {posts: feedPosts, next, hasMore, reset}\n}\n\nexport default useFeedPosts\n","import Box from '@material-ui/core/Box'\nimport TopBar from 'src/components/top-bar'\nimport Typography from '@material-ui/core/Typography'\nimport {useTheme} from '@material-ui/core/styles'\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\nimport AvatarDrawerMenuButton from 'src/components/menus/drawer/avatar-button'\nimport PostsFeed from 'src/components/feeds/posts'\nimport useFollowingOnce from 'src/hooks/following/use-following-once'\nimport PublishPostForm from 'src/components/publish-post/form'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport useTranslation from 'src/translations/use-translation'\nimport useFeedPosts from 'src/hooks/feed/use-feed-posts'\nimport Divider from '@material-ui/core/Divider'\nimport Debug from 'debug'\nconst debug = Debug('sav3:views:feed')\n\nfunction Feed () {\n  const theme = useTheme()\n  const fullScreen = useMediaQuery(theme.breakpoints.down('xs'))\n  const t = useTranslation()\n  const followingCids = useFollowingOnce()\n  const {posts, next, hasMore} = useFeedPosts()\n  debug({posts})\n\n  let feed = <PostsFeed posts={posts} next={next} hasMore={hasMore} />\n  if (!posts.length) {\n    feed = (\n      <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n        <CircularProgress size={24} />\n        <Box p={0.5} />\n        <Typography variant='body1'>{t['Connecting to peers']() + '...'}</Typography>\n      </Box>\n    )\n  }\n\n  // less than 2 to include own cid\n  if (!posts.length && !followingCids.length) {\n    feed = (\n      <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n        <Typography variant='body1'>{t['Not following anyone']() + '...'}</Typography>\n      </Box>\n    )\n  }\n\n  return (\n    <div>\n      <TopBar>\n        {fullScreen && (\n          <Box pl={2} pr={1}>\n            <AvatarDrawerMenuButton />\n          </Box>\n        )}\n        <Box pl={2}>\n          <Typography noWrap variant='h6'>\n            {t.Feed()}\n          </Typography>\n        </Box>\n      </TopBar>\n      {!fullScreen && (\n        <div>\n          <Box pb={1}>\n            <PublishPostForm />\n            <Divider />\n          </Box>\n          <Divider />\n        </div>\n      )}\n      {feed}\n    </div>\n  )\n}\n\nexport default Feed\n","import {useState} from 'react'\nimport Box from '@material-ui/core/Box'\nimport TopBar from 'src/components/top-bar'\nimport {useTheme, makeStyles} from '@material-ui/core/styles'\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\nimport AvatarDrawerMenuButton from 'src/components/menus/drawer/avatar-button'\nimport SearchIcon from '@material-ui/icons/Search'\nimport TextField from '@material-ui/core/TextField'\nimport InputAdornment from '@material-ui/core/InputAdornment'\nimport useTranslation from 'src/translations/use-translation'\nimport Profile from 'src/views/profile/components/profile'\nimport isIpfs from 'is-ipfs'\n\nconst useStyles = makeStyles((theme) => ({\n  search: {\n    height: theme.sav3.topBar.height / 1.5,\n    '& fieldset': {\n      border: 'none',\n      backgroundColor: theme.palette.divider\n    }\n  }\n}))\n\nfunction Search () {\n  const classes = useStyles()\n  const theme = useTheme()\n  const fullScreen = useMediaQuery(theme.breakpoints.down('xs'))\n  const [userCid, setUserCid] = useState('')\n  const t = useTranslation()\n\n  const handleChange = (event) => {\n    let userCid = event.target.value\n    try {\n      userCid = userCid.trim()\n      setUserCid(userCid)\n    }\n    catch (e) {}\n  }\n\n  return (\n    <div>\n      <TopBar>\n        <Box pl={fullScreen ? 2 : 4}>\n          {fullScreen && (\n            <Box pr={0.5}>\n              <AvatarDrawerMenuButton />\n            </Box>\n          )}\n        </Box>\n        <Box width='100%' pl={0} pr={4}>\n          <TextField\n            onChange={handleChange}\n            InputProps={{\n              spellCheck: false,\n              classes: {root: classes.search},\n              startAdornment: (\n                <Box pr={1}>\n                  <InputAdornment position='start'>\n                    <SearchIcon />\n                  </InputAdornment>\n                </Box>\n              )\n            }}\n            variant='outlined'\n            fullWidth\n            placeholder={t['Search user ID']()}\n            value={userCid}\n          />\n        </Box>\n      </TopBar>\n      {isIpfs.cid(userCid) && <Profile userCid={userCid} />}\n    </div>\n  )\n}\n\nexport default Search\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\n\n// TODO: convert to useInterval\n\nconst usePeersCids = () => {\n  const [peerCids, setPeersCids] = useState([])\n  const [pollCount, setPollCount] = useState(0)\n\n  const pollTime = 2000 // if too fast will break the peer posts demo\n  useEffect(() => {\n    // eslint-disable-next-line no-unused-vars\n    const interval = setInterval(() => {\n      setPollCount(pollCount + 1)\n    }, pollTime)\n\n    // return () => clearInterval(interval)\n  }, [])\n\n  useEffect(() => {\n    ;(async () => {\n      const peerCids = await sav3Ipfs.getPeersCids()\n      setPeersCids(peerCids)\n    })()\n  }, [pollCount])\n\n  return peerCids\n}\n\nexport default usePeersCids\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport useUsersIpnsContents from 'src/hooks/use-users-ipns-contents'\nimport useUsersProfiles from 'src/hooks/use-users-profiles'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-users-posts')\n\n// don't use this hook it's synchronous and slow\n// currently used for the temporary connected peers posts page\n\nconst useUsersPosts = (userCids) => {\n  assert(Array.isArray(userCids), `invalid userCids '${JSON.stringify(userCids)}'`)\n  const defaultUsersPosts = []\n  const [usersPosts, setUsersPosts] = useState(defaultUsersPosts)\n  const usersIpnsContents = useUsersIpnsContents(userCids)\n  const profiles = useUsersProfiles(userCids)\n  const lastPostCids = []\n  for (const userCid in usersIpnsContents) {\n    lastPostCids.push(usersIpnsContents[userCid].lastPostCid)\n  }\n\n  debug({usersIpnsContents, userCids, lastPostCids, usersPosts, profiles})\n\n  useEffect(() => {\n    if (!lastPostCids.length) {\n      if (usersPosts.length) {\n        setUsersPosts([])\n      }\n      return\n    }\n    for (const lastPostCid of lastPostCids) {\n      if (!lastPostCid || typeof lastPostCid !== 'string') {\n        // user hasn't posted yet\n        continue\n      }\n\n      sav3Ipfs.getUserPostsFromLastPostCid(lastPostCid).then((userPosts) => {\n        const posts = {}\n        for (const userPost of userPosts) {\n          userPost.profile = profiles[userPost.userCid] || {}\n          posts[userPost.cid] = userPost\n        }\n\n        setUsersPosts((previousUsersPosts) => ({\n          ...previousUsersPosts,\n          ...posts\n        }))\n      })\n    }\n  }, [JSON.stringify(lastPostCids), JSON.stringify(profiles)])\n\n  return usersPosts\n}\n\nexport default useUsersPosts\n","import Box from '@material-ui/core/Box'\nimport TopBar from 'src/components/top-bar'\nimport {useTheme} from '@material-ui/core/styles'\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\nimport useTranslation from 'src/translations/use-translation'\nimport IconButton from '@material-ui/core/IconButton'\nimport Divider from '@material-ui/core/Divider'\nimport {useHistory} from 'react-router-dom'\nimport ArrowBack from '@material-ui/icons/ArrowBack'\nimport Typography from '@material-ui/core/Typography'\nimport Feed from 'src/components/feeds/posts'\nimport usePeersCids from 'src/hooks/use-peers-cids'\nimport useUsersPosts from 'src/hooks/use-users-posts'\nimport PublishPostForm from 'src/components/publish-post/form'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport useOwnUserCid from 'src/hooks/use-own-user-cid'\nimport Debug from 'debug'\nconst debug = Debug('sav3:views:peers')\n\nfunction Peers () {\n  const theme = useTheme()\n  const fullScreen = useMediaQuery(theme.breakpoints.down('xs'))\n  const t = useTranslation()\n  const history = useHistory()\n\n  let peersCids = usePeersCids()\n  const ownCid = useOwnUserCid()\n  if (ownCid) {\n    peersCids = [ownCid, ...peersCids]\n  }\n  const postsObject = useUsersPosts(peersCids)\n  const posts = []\n  for (const postCid in postsObject) {\n    posts.push(postsObject[postCid])\n  }\n  debug({peersCids, posts, postsObject})\n\n  let feed = <Feed posts={posts} />\n  if (!posts.length) {\n    feed = (\n      <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n        <CircularProgress size={24} />\n        <Box p={0.5} />\n        <Typography variant='body1'>{t['Connecting to peers']() + '...'}</Typography>\n      </Box>\n    )\n  }\n\n  return (\n    <div>\n      <TopBar>\n        <Box pr={1}>\n          <IconButton onClick={() => history.goBack()}>\n            <ArrowBack />\n          </IconButton>\n        </Box>\n        <Typography noWrap variant='h6'>\n          {t['Connected peers posts']()}\n        </Typography>\n      </TopBar>\n      {!fullScreen && (\n        <div>\n          <Box pb={1}>\n            <PublishPostForm />\n            <Divider />\n          </Box>\n          <Divider />\n        </div>\n      )}\n      {feed}\n    </div>\n  )\n}\n\nexport default Peers\n","import assert from 'assert'\nimport IdbLru from 'src/lib/utils/idb-lru'\n\nconst getIsoCountryCodeFromIpAttempts = new Set()\nconst ipIsoCountryCodeCache = IdbLru({\n  name: 'ipIsoCountryCodeCache',\n  maxSize: 2000\n})\n\n/**\n * return iso country code if cached, if not attempt to cache it\n *\n * @param {string} ip\n * @returns {Promise<string>} country iso code\n */\nexport const getIsoCountryCodeFromIpCached = async (ip) => {\n  const isoCountryCode = await ipIsoCountryCodeCache.get(ip)\n  if (isoCountryCode) {\n    return isoCountryCode\n  }\n\n  if (!getIsoCountryCodeFromIpAttempts.has(ip)) {\n    getIsoCountryCodeFromIpAttempts.add(ip)\n    getIsoCountryCodeFromIp(ip)\n      .then((isoCountryCode) => ipIsoCountryCodeCache.set(ip, isoCountryCode))\n      .catch((e) => console.error(e))\n  }\n\n  throw Error(`iso country code for ip '${ip}' not cached yet`)\n}\n\n/**\n * @param {string} ip\n * @returns {Promise<string>} country iso code\n */\nexport const getIsoCountryCodeFromIp = async (ip) => {\n  assert(typeof ip === 'string', `invalid ip '${ip}' not a string`)\n\n  const apiUrl = `https://ipapi.co/${ip}/country/`\n  let isoCountryCode, res\n  try {\n    res = await fetch(apiUrl)\n    res = await res.text()\n    isoCountryCode = res.trim().toUpperCase()\n    assertIsIsoCountryCode(isoCountryCode)\n  }\n  catch (e) {\n    e.message = `failed getting country iso code from '${apiUrl}' response '${res}': ${e.message}`\n    throw e\n  }\n  return isoCountryCode\n}\n\n/**\n * @param {string[]} ips\n * @returns {Promise<string[]>} country iso codes\n */\nexport const getIsoCountryCodesFromIps = (ips) => {\n  const promises = []\n  for (const ip of ips) {\n    promises.push(getIsoCountryCodeFromIp(ip))\n  }\n  return Promise.all(promises)\n}\n\n/**\n * @param {string} isoCountryCode\n * @returns {string} country flag emoji\n */\nexport const isoCountryCodeToCountryFlagEmoji = (isoCountryCode) => {\n  assertIsIsoCountryCode(isoCountryCode)\n  // offset between uppercase ascii and regional indicator symbols\n  const charOffset = 127397\n  const chars = [...isoCountryCode.toUpperCase()].map((c) => c.charCodeAt() + charOffset)\n  return String.fromCodePoint(...chars)\n}\n\n/**\n * @param {string} isoCountryCode\n */\nconst assertIsIsoCountryCode = (isoCountryCode) => {\n  const countryCodeRegex = /^[a-z]{2}$/i\n  const isoCountryCodeType = typeof isoCountryCode\n  assert(countryCodeRegex.test(isoCountryCode), `isoCountryCode must be an ISO 3166-1 alpha-2 string, but got '${isoCountryCodeType === 'string' ? isoCountryCode : isoCountryCodeType}' instead`)\n}\n\nexport default {\n  getIsoCountryCodeFromIpCached,\n  getIsoCountryCodeFromIp,\n  getIsoCountryCodesFromIps,\n  isoCountryCodeToCountryFlagEmoji\n}\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport ipUtils from 'src/lib/utils/ip'\n\n// TODO: convert to useInterval\n\nconst usePeersStats = () => {\n  const [peersStats, setPeersStats] = useState([])\n  const [pollCount, setPollCount] = useState(0)\n\n  const pollTime = 5000 // if too fast will break the peer posts demo\n  useEffect(() => {\n    // eslint-disable-next-line no-unused-vars\n    const interval = setInterval(() => {\n      setPollCount(pollCount + 1)\n    }, pollTime)\n\n    // return () => clearInterval(interval)\n  }, [])\n\n  useEffect(() => {\n    ;(async () => {\n      const peersStats = await sav3Ipfs.getPeersStats()\n      for (const peersStat of peersStats) {\n        if (!peersStat.ip) {\n          continue\n        }\n        let isoCountryCode\n        try {\n          isoCountryCode = await ipUtils.getIsoCountryCodeFromIpCached(peersStat.ip)\n        }\n        catch (e) {\n          console.error(e)\n          continue\n        }\n        const countryFlagEmoji = ipUtils.isoCountryCodeToCountryFlagEmoji(isoCountryCode)\n\n        peersStat.isoCountryCode = isoCountryCode\n        peersStat.countryFlagEmoji = countryFlagEmoji\n      }\n      setPeersStats(peersStats)\n    })()\n  }, [pollCount])\n\n  return peersStats\n}\n\nexport default usePeersStats\n","import {makeStyles} from '@material-ui/core/styles'\nimport Avatar from '@material-ui/core/Avatar'\nimport Typography from '@material-ui/core/Typography'\nimport Box from '@material-ui/core/Box'\nimport prettyBytes from 'pretty-bytes'\n\nconst useStyles = makeStyles((theme) => ({\n  avatar: {\n    // slightly higher placement than the user name seems more pleasing\n    marginTop: theme.spacing(-0.25),\n    width: theme.spacing(6),\n    height: theme.spacing(6),\n    // borders\n    borderWidth: theme.sav3.borderWidth,\n    borderStyle: 'solid',\n    borderColor: theme.sav3.borderColor,\n    backgroundColor: theme.palette.background.default\n  },\n  userCid: {\n    wordBreak: 'break-all'\n  }\n}))\n\nfunction Peer ({peer} = {}) {\n  const classes = useStyles()\n\n  return (\n    <div>\n      <Box px={2} py={1.5} display='flex'>\n        {/* left col avatar */}\n        <Box pr={1.5}>\n          <Avatar className={classes.avatar}>{peer.countryFlagEmoji}</Avatar>\n        </Box>\n\n        {/* right col header + content + bottom actions */}\n        <Box width='100%'>\n          {/* header */}\n          <Box display='flex'>\n            <Box flexGrow={1}>\n              <Box display='flex'>\n                <Typography variant='subtitle2'>\n                  {peer.ip}:{peer.port}\n                </Typography>\n              </Box>\n              <Box>\n                <Typography variant='caption' color='textSecondary' className={classes.userCid}>\n                  {peer.peerCid}\n                </Typography>\n              </Box>\n            </Box>\n            {/* add some height so it looks better */}\n            <Box height={48} />\n          </Box>\n\n          {/* content */}\n          <Typography variant='body2'>\n            ⬆️{prettyBytes(peer.dataSent)}&nbsp;&nbsp;⬇️{prettyBytes(peer.dataReceived)}\n          </Typography>\n        </Box>\n      </Box>\n    </div>\n  )\n}\n\nexport default Peer\n","import Box from '@material-ui/core/Box'\nimport TopBar from 'src/components/top-bar'\nimport useTranslation from 'src/translations/use-translation'\nimport IconButton from '@material-ui/core/IconButton'\nimport Divider from '@material-ui/core/Divider'\nimport {useHistory} from 'react-router-dom'\nimport ArrowBack from '@material-ui/icons/ArrowBack'\nimport Typography from '@material-ui/core/Typography'\nimport usePeersStats from 'src/hooks/use-peers-stats'\nimport Peer from './components/peer'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport Debug from 'debug'\nconst debug = Debug('sav3:views:stats')\n\nfunction Stats () {\n  const t = useTranslation()\n  const history = useHistory()\n\n  const peers = usePeersStats()\n  debug({peers})\n\n  return (\n    <div>\n      <TopBar>\n        <Box pr={1}>\n          <IconButton onClick={() => history.goBack()}>\n            <ArrowBack />\n          </IconButton>\n        </Box>\n        <Typography noWrap variant='h6'>\n          {t['Connected peers stats']()}\n        </Typography>\n      </TopBar>\n      <Feed peers={peers} />\n    </div>\n  )\n}\n\nfunction Feed ({peers} = {}) {\n  const t = useTranslation()\n  if (!peers.length) {\n    return (\n      <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n        <CircularProgress size={24} />\n        <Box p={0.5} />\n        <Typography variant='body1'>{t['Connecting to peers']() + '...'}</Typography>\n      </Box>\n    )\n  }\n\n  const peerComponents = []\n\n  for (const peer of peers) {\n    peerComponents.push(<Peer peer={peer} key={peer.peerCid + peer.port} />)\n    peerComponents.push(<Divider key={peer.peerCid + peer.port + 'feed divider'} />)\n  }\n\n  return <div>{peerComponents}</div>\n}\n\nexport default Stats\n","import {makeStyles} from '@material-ui/core/styles'\nimport Avatar from '@material-ui/core/Avatar'\nimport Typography from '@material-ui/core/Typography'\nimport Box from '@material-ui/core/Box'\nimport assert from 'assert'\nimport useTranslation from 'src/translations/use-translation'\nimport Button from '@material-ui/core/Button'\nimport useIsFollowing from 'src/hooks/following/use-is-following'\nimport {Link as RouterLink} from 'react-router-dom'\nimport urlUtils from 'src/lib/utils/url'\n\nconst useStyles = makeStyles((theme) => ({\n  avatar: {\n    // slightly higher placement than the user name seems more pleasing\n    marginTop: theme.spacing(-0.25),\n    width: theme.spacing(6),\n    height: theme.spacing(6),\n    // borders\n    borderWidth: theme.sav3.borderWidth,\n    borderStyle: 'solid',\n    borderColor: theme.sav3.borderColor\n  },\n  userCid: {\n    wordBreak: 'break-all',\n    // remove added styles from link component\n    textDecoration: 'inherit'\n  },\n  displayName: {\n    // remove added styles from link component\n    color: 'inherit',\n    textDecoration: 'inherit'\n  }\n}))\n\n// same height as the 3 dots button of the post component\nconst buttonHeight = 48\n\nfunction User ({user} = {}) {\n  const classes = useStyles()\n  const t = useTranslation()\n  const [isFollowing, setIsFollowing] = useIsFollowing(user.cid)\n\n  let followButton = (\n    <Button variant='outlined' size='small' color='primary' onClick={() => setIsFollowing(true)}>\n      {t.Follow()}\n    </Button>\n  )\n  if (isFollowing) {\n    followButton = (\n      <Button variant='outlined' size='small' color='primary' onClick={() => setIsFollowing(false)}>\n        {t.Unfollow()}\n      </Button>\n    )\n  }\n\n  const encodedCid = urlUtils.encodeCid(user.cid)\n  const userProfileUrl = `/profile/${encodedCid}`\n\n  return (\n    <div>\n      <Box px={2} py={1.5} display='flex'>\n        {/* left col avatar */}\n        <Box pr={1.5}>\n          <Avatar component={RouterLink} to={userProfileUrl} src={user.thumbnailUrl && forceHttps(user.thumbnailUrl)} className={classes.avatar} />\n        </Box>\n\n        {/* right col header + content + bottom actions */}\n        <Box width='100%'>\n          {/* header */}\n          <Box display='flex'>\n            <Box flexGrow={1}>\n              <Box display='flex'>\n                <Typography className={classes.displayName} component={RouterLink} to={userProfileUrl} variant='subtitle2'>\n                  {user.displayName}\n                </Typography>\n              </Box>\n              <Box>\n                <Typography component={RouterLink} to={userProfileUrl} variant='caption' color='textSecondary' className={classes.userCid}>\n                  {user.cid}\n                </Typography>\n              </Box>\n            </Box>\n            <Box height={buttonHeight}>{followButton}</Box>\n          </Box>\n\n          {/* content */}\n          <Typography variant='body2'>{user.description}</Typography>\n        </Box>\n      </Box>\n    </div>\n  )\n}\n\nconst forceHttps = (link) => {\n  assert(typeof link === 'string', `forceHttps link '${link}' not a string`)\n  link = link.trim()\n  link = link.replace(/^http:\\/\\//, 'https://')\n  return link\n}\n\nexport default User\n","import React from 'react'\nimport User from './user'\nimport Divider from '@material-ui/core/Divider'\nimport PropTypes from 'prop-types'\n\nfunction UsersFeed ({users} = {}) {\n  const userComponents = []\n\n  for (const user of users) {\n    userComponents.push(<User user={user} key={user.cid} />)\n    userComponents.push(<Divider key={user.cid + 'feed divider'} />)\n  }\n\n  return <div>{userComponents}</div>\n}\n\nUsersFeed.propTypes = {\n  users: PropTypes.array.isRequired\n}\n\nexport default UsersFeed\n","import Box from '@material-ui/core/Box'\nimport TopBar from 'src/components/top-bar'\nimport useTranslation from 'src/translations/use-translation'\nimport IconButton from '@material-ui/core/IconButton'\nimport {useHistory} from 'react-router-dom'\nimport ArrowBack from '@material-ui/icons/ArrowBack'\nimport Typography from '@material-ui/core/Typography'\nimport useFollowingOnce from 'src/hooks/following/use-following-once'\nimport useUsersProfiles from 'src/hooks/use-users-profiles'\nimport UsersFeed from 'src/components/feeds/users'\nimport Debug from 'debug'\nconst debug = Debug('sav3:views:following')\n\nfunction Following () {\n  const t = useTranslation()\n  const history = useHistory()\n\n  const followingCids = useFollowingOnce()\n  const profiles = useUsersProfiles(followingCids)\n  const users = []\n  for (const userCid of followingCids) {\n    const user = profiles[userCid] || {}\n    user.cid = userCid\n    users.push(user)\n  }\n\n  let feed = <UsersFeed users={users} />\n  if (!users.length) {\n    feed = (\n      <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n        <Typography variant='body1'>{t['Not following anyone']() + '...'}</Typography>\n      </Box>\n    )\n  }\n\n  debug({followingCids, profiles, users})\n\n  return (\n    <div>\n      <TopBar>\n        <Box pr={1}>\n          <IconButton onClick={() => history.goBack()}>\n            <ArrowBack />\n          </IconButton>\n        </Box>\n        <Typography noWrap variant='h6'>\n          {t.Following()}\n        </Typography>\n      </TopBar>\n      {feed}\n    </div>\n  )\n}\n\nexport default Following\n","import {useState} from 'react'\nimport Button from '@material-ui/core/Button'\nimport TextField from '@material-ui/core/TextField'\nimport useTranslation from 'src/translations/use-translation'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport Alert from '@material-ui/lab/Alert'\nimport {makeStyles, useTheme} from '@material-ui/core/styles'\nimport Box from '@material-ui/core/Box'\nimport Divider from '@material-ui/core/Divider'\nimport useFollowing from 'src/hooks/following/use-following'\nimport followManager from 'src/lib/follow-manager'\n\nconst useStyles = makeStyles((theme) => ({\n  message: {\n    overflow: 'hidden'\n  },\n  data: {\n    '& textarea': {\n      fontFamily: 'Monospace',\n      minHeight: '10vh',\n      maxHeight: '40vh',\n      overflowY: 'scroll!important'\n    },\n    // remove text input variant borders\n    '& fieldset': {\n      border: 'none'\n    },\n    '& .MuiInputBase-root': {\n      paddingLeft: 0,\n      paddingRight: 0\n    },\n    marginBottom: theme.spacing(1)\n  }\n}))\n\nfunction ImportForm () {\n  const t = useTranslation()\n  const classes = useStyles()\n  const theme = useTheme()\n  const [, setFollowing] = useFollowing()\n\n  const [data, setData] = useState('')\n  const [errorMessage, setErrorMessage] = useState()\n  const [successMessage, setSuccessMessage] = useState()\n\n  const handleChange = (event) => {\n    const data = event.target.value\n    setData(data)\n  }\n\n  const handleFocus = (event) => {\n    // throws for unknown reason sometimes\n    try {\n      event.target.setSelectionRange(0, event.target.value.length)\n    }\n    catch (e) {}\n  }\n\n  const handleExport = async () => {\n    setData('Exporting...')\n    setErrorMessage(null)\n    setSuccessMessage(null)\n    try {\n      const following = await followManager.getAllFollowing()\n      const privateKey = await sav3Ipfs.getPrivateKey()\n      const data = JSON.stringify({privateKey, following})\n      setErrorMessage(null)\n      setData(data)\n    }\n    catch (e) {\n      setErrorMessage(e.message)\n    }\n    setSuccessMessage('Export successful. Copy paste your data somewhere safe.')\n  }\n\n  const handleImport = async () => {\n    setErrorMessage(null)\n    setSuccessMessage(null)\n    let dataObject\n\n    // validate json\n    try {\n      dataObject = JSON.parse(data)\n    }\n    catch (e) {\n      setErrorMessage(`Invalid JSON: ${e.message}`)\n      return\n    }\n\n    // validate confirm\n    const confirmMessage = 'Did you backup your data? Importing will irreversibly delete it. Click import again to confirm.'\n    if (errorMessage !== confirmMessage) {\n      setErrorMessage(confirmMessage)\n      return\n    }\n\n    // validate following\n    try {\n      // use follow manager to validate because setFollowing is a react hook that doesnt validate\n      await followManager.setAllFollowing(dataObject.following)\n      setFollowing(dataObject.following)\n    }\n    catch (e) {\n      setErrorMessage(`Invalid following: ${e.message}`)\n      return\n    }\n\n    // validate private key\n    try {\n      // use follow manager to validate because setFollowing is a react hook that doesnt validate\n      await followManager.setAllFollowing(dataObject.following)\n      setFollowing(dataObject.following)\n    }\n    catch (e) {\n      setErrorMessage(`Invalid privateKey: ${e.message}`)\n      return\n    }\n\n    setErrorMessage(null)\n    setSuccessMessage('Import successful.')\n  }\n\n  const modalActions = (\n    <div>\n      <Box>\n        <Divider />\n      </Box>\n      <Box alignItems='center' display='flex' height={theme.sav3.topBar.height}>\n        <Box flexGrow={1}></Box>\n        <Button disableElevation variant='contained' onClick={handleImport} color='primary'>\n          {t.Import()}\n        </Button>\n        <Box pr={0.5}></Box>\n        <Button disableElevation variant='contained' onClick={handleExport} color='primary'>\n          {t.Export()}\n        </Button>\n      </Box>\n    </div>\n  )\n\n  return (\n    <Box px={2} display='flex'>\n      <Box pt={0} width='100%'>\n        <TextField\n          onClick={handleFocus}\n          onFocus={handleFocus}\n          className={classes.data}\n          onChange={handleChange}\n          margin='dense'\n          id='data'\n          placeholder='Paste exported data here...'\n          fullWidth\n          multiline\n          variant='outlined'\n          value={data}\n        />\n        {errorMessage && (\n          <Box pb={1}>\n            <Alert classes={{message: classes.message}} severity='error'>\n              {errorMessage}\n            </Alert>\n          </Box>\n        )}\n        {successMessage && (\n          <Box pb={1}>\n            <Alert classes={{message: classes.message}} severity='success'>\n              {successMessage}\n            </Alert>\n          </Box>\n        )}\n        <Box pb={0} />\n        {modalActions}\n      </Box>\n    </Box>\n  )\n}\n\nexport default ImportForm\n","import Box from '@material-ui/core/Box'\nimport TopBar from 'src/components/top-bar'\nimport Typography from '@material-ui/core/Typography'\nimport {useTheme} from '@material-ui/core/styles'\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\nimport AvatarDrawerMenuButton from 'src/components/menus/drawer/avatar-button'\nimport ImportForm from './components/form'\nimport useTranslation from 'src/translations/use-translation'\n\nfunction Export () {\n  const theme = useTheme()\n  const fullScreen = useMediaQuery(theme.breakpoints.down('xs'))\n  const t = useTranslation()\n\n  return (\n    <div>\n      <TopBar>\n        {fullScreen && (\n          <Box pl={2} pr={1}>\n            <AvatarDrawerMenuButton />\n          </Box>\n        )}\n        <Box pl={2}>\n          <Typography noWrap variant='h6'>\n            {t.Import()} / {t.Export()}\n          </Typography>\n        </Box>\n      </TopBar>\n      <ImportForm />\n    </div>\n  )\n}\n\nexport default Export\n","import {useEffect, useState} from 'react'\nimport sav3Ipfs from 'src/lib/sav3-ipfs'\nimport assert from 'assert'\nimport usePosts from 'src/hooks/use-posts'\nimport usePostRepliesCids from 'src/hooks/use-post-replies-cids'\nimport Debug from 'debug'\nconst debug = Debug('sav3:hooks:use-post-with-replies')\n\nconst usePostWithReplies = (postCid) => {\n  assert(!postCid || typeof postCid === 'string', `invalid postCid '${JSON.stringify(postCid)}'`)\n  const [parentPost, setParentPost] = useState()\n  const repliesCids = usePostRepliesCids(parentPost && parentPost.cid)\n  const posts = usePosts(repliesCids)\n\n  // usePosts doesn't delete removed replies on repliesCids change\n  // but usePostRepliesCids does so must assign like below\n  const replies = {}\n  for (const replyCid of repliesCids) {\n    replies[replyCid] = posts[replyCid]\n  }\n\n  // set parent post once\n  useEffect(() => {\n    // reset on post cid change\n    if (parentPost) {\n      setParentPost()\n    }\n    if (!postCid || typeof postCid !== 'string') {\n      return\n    }\n    ;(async () => {\n      const post = await sav3Ipfs.getPost(postCid)\n      let parentPost = post\n      if (post.parentPostCid) {\n        parentPost = await sav3Ipfs.getPost(post.parentPostCid)\n      }\n      setParentPost(parentPost)\n    })()\n  }, [postCid])\n\n  debug({parentPost, repliesCids, replies})\n\n  if (!parentPost) {\n    return\n  }\n\n  return {...parentPost, replies}\n}\n\nexport default usePostWithReplies\n","import Box from '@material-ui/core/Box'\nimport useUsersProfiles from 'src/hooks/use-users-profiles'\nimport TopBar from 'src/components/top-bar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\nimport ArrowBack from '@material-ui/icons/ArrowBack'\nimport {useHistory, useParams} from 'react-router-dom'\nimport usePostWithReplies from 'src/hooks/use-post-with-replies'\nimport useTranslation from 'src/translations/use-translation'\nimport Feed from 'src/components/feeds/posts'\nimport urlUtils from 'src/lib/utils/url'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport Debug from 'debug'\nconst debug = Debug('sav3:views:post')\n\nfunction Post () {\n  const {encodedCid} = useParams()\n  const urlIsExpired = encodedCid && urlUtils.encodedCidIsExpired(encodedCid)\n  let postCid\n  if (!urlIsExpired && encodedCid) {\n    postCid = urlUtils.decodeCid(encodedCid)\n  }\n\n  const postWithReplies = usePostWithReplies(postCid)\n\n  const history = useHistory()\n  const t = useTranslation()\n\n  // get posts\n  const posts = []\n  if (postWithReplies) {\n    posts.push(postWithReplies)\n    for (const i in postWithReplies.replies) {\n      posts.push(postWithReplies.replies[i])\n    }\n  }\n\n  // get profiles\n  const userCids = new Set()\n  for (const post of posts) {\n    userCids.add(post.userCid)\n  }\n  const profiles = useUsersProfiles([...userCids])\n\n  // add profiles to posts\n  for (const post of posts) {\n    post.profile = profiles[post.userCid] || {}\n  }\n\n  let feed = <Feed posts={posts} />\n  if (!posts.length) {\n    feed = (\n      <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n        <CircularProgress size={24} />\n        <Box p={0.5} />\n        <Typography variant='body1'>{t['Connecting to peers']() + '...'}</Typography>\n      </Box>\n    )\n  }\n  if (urlIsExpired) {\n    feed = (\n      <Box width='100%' py={4} display='flex' justifyContent='center' alignItems='center'>\n        <Typography variant='body1'>{t['URL expired']() + '.'}</Typography>\n      </Box>\n    )\n  }\n\n  debug({postCid, postWithReplies, posts})\n\n  return (\n    <div>\n      <TopBar>\n        <Box pr={1}>\n          <IconButton onClick={() => history.goBack()}>\n            <ArrowBack />\n          </IconButton>\n        </Box>\n        <Typography noWrap variant='h6'>\n          {t.Post()}\n        </Typography>\n      </TopBar>\n      {feed}\n    </div>\n  )\n}\n\nexport default Post\n","import {Switch, Route} from 'react-router-dom'\nimport Grid from '@material-ui/core/Grid'\nimport {makeStyles, useTheme} from '@material-ui/core/styles'\nimport LeftMenu from 'src/components/menus/left'\nimport BottomMenu from 'src/components/menus/bottom'\n\n// components\nimport ThemeSwitcher from 'src/components/theme-switcher'\nimport TranslationSwitcher from 'src/components/translation-switcher'\n\n// routes\nimport Profile from 'src/views/profile'\nimport Home from 'src/views/home'\nimport Feed from 'src/views/feed'\nimport Search from 'src/views/search'\nimport Peers from 'src/views/peers'\nimport Stats from 'src/views/stats'\nimport Following from 'src/views/following'\nimport Export from 'src/views/export'\nimport Post from 'src/views/post'\n\nconst useStyles = makeStyles((theme) => ({\n  leftColumn: {\n    overflow: 'hidden',\n    [theme.breakpoints.down('xs')]: {\n      display: 'none'\n    },\n    [theme.breakpoints.down('md')]: {\n      width: theme.sav3.layout.columns.left.width.xs\n    },\n    [theme.breakpoints.down('lg')]: {\n      width: theme.sav3.layout.columns.left.width.xs\n    },\n    [theme.breakpoints.up('lg')]: {\n      width: theme.sav3.layout.columns.left.width.md\n    }\n  },\n  middleColumn: {\n    overflow: 'hidden',\n    [theme.breakpoints.down('xs')]: {\n      width: '100%'\n    },\n    [theme.breakpoints.up('xs')]: {\n      width: theme.sav3.layout.columns.middle.width.md\n    },\n    // borders\n    borderLeftWidth: theme.sav3.borderWidth,\n    borderRightWidth: theme.sav3.borderWidth,\n    borderTopWidth: 0,\n    borderBottomWidth: 0,\n    borderStyle: 'solid',\n    borderColor: theme.sav3.borderColor\n  },\n  rightColumn: {\n    overflow: 'hidden',\n    [theme.breakpoints.down('sm')]: {\n      display: 'none'\n    },\n    [theme.breakpoints.down('lg')]: {\n      width: theme.sav3.layout.columns.right.width.md,\n      paddingLeft: theme.spacing(3),\n      paddingRight: theme.spacing(3)\n    },\n    [theme.breakpoints.up('lg')]: {\n      width: theme.sav3.layout.columns.right.width.lg,\n      paddingLeft: theme.spacing(4),\n      paddingRight: theme.spacing(4)\n    }\n  },\n  bottomMenu: {\n    [theme.breakpoints.up('sm')]: {\n      display: 'none'\n    }\n  },\n  appBar: {\n    backgroundColor: theme.palette.background.default\n  }\n}))\n\nfunction App () {\n  const classes = useStyles()\n  const theme = useTheme()\n  window.theme = theme\n\n  return (\n    <div>\n      <Grid container justify='center'>\n        <Grid item className={classes.leftColumn}>\n          <LeftMenu />\n        </Grid>\n        <Grid item className={classes.middleColumn}>\n          <Switch>\n            <Route path='/' exact>\n              <Home />\n            </Route>\n            <Route path='/feed' exact>\n              <Feed />\n            </Route>\n            <Route path='/profile/:encodedCid?' exact>\n              <Profile />\n            </Route>\n            <Route path='/search' exact>\n              <Search />\n            </Route>\n            <Route path='/peers' exact>\n              <Peers />\n            </Route>\n            <Route path='/stats' exact>\n              <Stats />\n            </Route>\n            <Route path='/following' exact>\n              <Following />\n            </Route>\n            <Route path='/export' exact>\n              <Export />\n            </Route>\n            <Route path='/post/:encodedCid' exact>\n              <Post />\n            </Route>\n          </Switch>\n        </Grid>\n        <Grid item className={classes.rightColumn}>\n          <ThemeSwitcher />\n          <TranslationSwitcher />\n        </Grid>\n      </Grid>\n      <BottomMenu className={classes.bottomMenu} />\n    </div>\n  )\n}\n\nexport default App\n","const reportWebVitals = (onPerfEntry) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({getCLS, getFID, getFCP, getLCP, getTTFB}) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './app'\nimport reportWebVitals from './report-web-vitals'\nimport {HashRouter} from 'react-router-dom'\nimport FollowingProvider from 'src/hooks/following/following-provider'\nimport FeedProvider from 'src/hooks/feed/feed-provider'\nimport LanguageCodeProvider from 'src/translations/language-code-provider'\nimport ThemeProvider from 'src/themes/theme-provider'\nimport CssBaseline from '@material-ui/core/CssBaseline'\n\nReactDOM.render(\n  <HashRouter>\n    <ThemeProvider>\n      <LanguageCodeProvider>\n        <FollowingProvider>\n          <FeedProvider>\n            <CssBaseline />\n            <App />\n          </FeedProvider>\n        </FollowingProvider>\n      </LanguageCodeProvider>\n    </ThemeProvider>\n  </HashRouter>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n","import assert from 'assert'\nimport WebSocketClient from 'socket.io-client'\nimport EventEmitter from 'events'\nimport crypto from 'libp2p-crypto'\nimport ipns from 'ipns'\nimport delay from 'delay'\nimport uint8ArrayToString from 'uint8arrays/to-string'\nimport PeerId from 'peer-id'\nimport isIpfs from 'is-ipfs'\nimport QuickLRU from 'quick-lru'\nimport config from 'src/config'\nimport Debug from 'debug'\nconst debug = Debug('sav3:sav3-ipfs:ipns-client')\n\nclass IpnsClient extends EventEmitter {\n  constructor ({ipfs} = {}) {\n    super()\n    assert(ipfs && typeof ipfs === 'object')\n    this.ipfs = ipfs\n    this.privateKey = null\n    this.webSocketClient = null\n    this.peerCid = null\n    this.url = config.ipnsServer\n    this.subscriptionIpnsValueCache = new QuickLRU({maxSize: 10000})\n\n    this.start()\n  }\n\n  async start () {\n    assert(this.webSocketClient === null)\n    this.webSocketClient = WebSocketClient(this.url)\n    const encryptedPrivateKeyString = await this.ipfs.key.export('self', 'password')\n    this.privateKey = await crypto.keys.import(encryptedPrivateKeyString, 'password')\n    this.peerCid = (await this.ipfs.id()).id\n\n    // subscribe to new publishes\n    this.webSocketClient.on('publish', async (ipnsPath, ipnsRecord) => {\n      const ipnsValue = await getIpnsValueFromIpnsRecord(ipnsPath, ipnsRecord)\n      this.subscriptionIpnsValueCache.set(ipnsPath, ipnsValue)\n      this.emit('publish', ipnsPath, ipnsValue)\n    })\n  }\n\n  async stop () {\n    await this.webSocketClient.close()\n    this.webSocketClient = null\n  }\n\n  isReady () {\n    return this.webSocketClient && this.privateKey\n  }\n\n  async waitForReady () {\n    if (this.isReady()) {\n      return\n    }\n    await delay(10)\n    await this.waitForReady()\n  }\n\n  async subscribe (ipnsPaths) {\n    validateIpnsPaths(ipnsPaths)\n    await this.waitForReady()\n\n    // cache ipns values to call ipnsClient.subscribe\n    // multiple times without wasting websocket calls\n    let allResultsAreCached = true\n    const cachedIpnsValues = []\n    for (const ipnsPath of ipnsPaths) {\n      const cachedIpnsValue = this.subscriptionIpnsValueCache.get(ipnsPath)\n      cachedIpnsValues.push(cachedIpnsValue)\n      if (!cachedIpnsValue) {\n        allResultsAreCached = false\n      }\n    }\n    // if all values are cached, it must necessarily mean\n    // all ipns paths are already subscribed to\n    if (allResultsAreCached) {\n      debug('subscribe', {allResultsAreCached, ipnsPaths, cachedIpnsValues})\n      return cachedIpnsValues\n    }\n\n    const ipnsRecords = await new Promise((resolve) => this.webSocketClient.emit('subscribe', ipnsPaths, resolve))\n    const ipnsValues = await getIpnsValuesFromIpnsRecords(ipnsPaths, ipnsRecords)\n\n    // cache inital values received from subscribe\n    // future values are cached in webSocketClient.on('publish')\n    for (const i in ipnsPaths) {\n      this.subscriptionIpnsValueCache.set(ipnsPaths[i], ipnsValues[i])\n    }\n\n    debug('subscribe', {allResultsAreCached, ipnsPaths, ipnsValues})\n    return ipnsValues\n  }\n\n  async getRecords (ipnsPaths) {\n    validateIpnsPaths(ipnsPaths)\n    await this.waitForReady()\n    const ipnsRecords = await new Promise((resolve) => this.webSocketClient.emit('resolve', ipnsPaths, resolve))\n    const unmarshalled = await getUnmarshalledIpnsRecords(ipnsPaths, ipnsRecords)\n    return unmarshalled\n  }\n\n  async unsubscribe (ipnsPaths) {\n    validateIpnsPaths(ipnsPaths)\n    await this.waitForReady()\n\n    // delete values from cache or resubscribing will\n    // never get new data\n    for (const ipnsPath of ipnsPaths) {\n      this.subscriptionIpnsValueCache.delete(ipnsPath)\n    }\n    await this.webSocketClient.emit('unsubscribe', ipnsPaths)\n  }\n\n  async publish ({value, sequence} = {}) {\n    assert(typeof value === 'string')\n    assert(typeof sequence === 'number')\n    await this.waitForReady()\n\n    // needs /ipfs/ prefix to ipfs.name.resolve correctly\n    if (!value.startsWith('/ipfs/')) {\n      value = `/ipfs/${value}`\n    }\n\n    const validity = 1000 * 60 * 60 * 24 * 365 * 10 // 10 years\n\n    const record = await ipns.create(this.privateKey, value, sequence, validity)\n    await ipns.embedPublicKey(this.privateKey.public, record) // required to verify marshalled record\n    const marshalledRecord = Buffer.from(ipns.marshal(record))\n\n    const ipnsPath = this.peerCid\n    await this.webSocketClient.emit('publish', ipnsPath, marshalledRecord)\n  }\n}\n\nconst validateIpnsPaths = (ipnsPaths) => {\n  assert(Array.isArray(ipnsPaths), `ipns paths '${JSON.stringify(ipnsPaths)}' not an array`)\n  for (const ipnsPath of ipnsPaths) {\n    assert(typeof ipnsPath === 'string', `ipns paths '${JSON.stringify(ipnsPaths)}' contains non string '${ipnsPath}'`)\n  }\n}\n\nconst getIpnsValuesFromIpnsRecords = async (ipnsPaths, ipnsRecords) => {\n  assert(Array.isArray(ipnsPaths))\n  assert(Array.isArray(ipnsRecords))\n\n  const ipnsValues = []\n\n  for (const i in ipnsPaths) {\n    // possible to receive null from ipns server if record is not set\n    if (ipnsRecords[i] === null) {\n      ipnsValues.push(null)\n      continue\n    }\n    ipnsValues.push(await getIpnsValueFromIpnsRecord(ipnsPaths[i], ipnsRecords[i]))\n  }\n\n  return ipnsValues\n}\n\nconst getIpnsValueFromIpnsRecord = async (ipnsPath, marshalledIpnsRecord) => {\n  assert(typeof ipnsPath === 'string')\n  marshalledIpnsRecord = new Uint8Array(marshalledIpnsRecord)\n\n  // validate ipns record is signed by embedded public key\n  const ipnsRecord = ipns.unmarshal(marshalledIpnsRecord)\n  const publicKey = ipns.extractPublicKey({}, ipnsRecord)\n  await ipns.validate(publicKey, ipnsRecord)\n\n  // validate ipns path is the embedded public key\n  // in case malicious user tries to submit old ipns record\n  const peerCid = await PeerId.createFromPubKey(publicKey.bytes)\n  assert(peerCid.equals(PeerId.createFromB58String(ipnsPath)))\n\n  const ipnsValue = uint8ArrayToString(ipnsRecord.value)\n  // validate value is a valid cid and nothing weird\n  assert(isIpfs.cid(ipnsValue.replace(/^\\/ipfs\\//, '')))\n  return ipnsValue\n}\n\nconst getUnmarshalledIpnsRecords = async (ipnsPaths, ipnsRecords) => {\n  assert(Array.isArray(ipnsPaths))\n  assert(Array.isArray(ipnsRecords))\n\n  const unmarshalled = []\n\n  for (const i in ipnsPaths) {\n    // possible to receive null from ipns server if record is not set\n    if (ipnsRecords[i] === null) {\n      unmarshalled.push(null)\n      continue\n    }\n    unmarshalled.push(await getUnmarshalledIpnsRecord(ipnsPaths[i], ipnsRecords[i]))\n  }\n\n  return unmarshalled\n}\n\nconst getUnmarshalledIpnsRecord = async (ipnsPath, marshalledIpnsRecord) => {\n  assert(typeof ipnsPath === 'string')\n  marshalledIpnsRecord = new Uint8Array(marshalledIpnsRecord)\n\n  // validate ipns record is signed by embedded public key\n  const ipnsRecord = ipns.unmarshal(marshalledIpnsRecord)\n  const publicKey = ipns.extractPublicKey({}, ipnsRecord)\n  await ipns.validate(publicKey, ipnsRecord)\n\n  // validate ipns path is the embedded public key\n  // in case malicious user tries to submit old ipns record\n  const peerCid = await PeerId.createFromPubKey(publicKey.bytes)\n  assert(peerCid.equals(PeerId.createFromB58String(ipnsPath)))\n\n  const ipnsValue = uint8ArrayToString(ipnsRecord.value)\n  // validate value is a valid cid and nothing weird\n  assert(isIpfs.cid(ipnsValue.replace(/^\\/ipfs\\//, '')))\n\n  return ipnsRecord\n}\n\nwindow.IpnsClient = (...args) => new IpnsClient(...args)\nwindow.ipns = ipns\n\nexport default (...args) => new IpnsClient(...args)\n"],"sourceRoot":""}